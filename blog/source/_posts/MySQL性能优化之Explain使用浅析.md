---
title: MySQLæ€§èƒ½ä¼˜åŒ–ä¹‹Explainä½¿ç”¨æµ…æ
date: 2019-08-19 22:18:54
tags:
    - MySQL
categories:
    - æ•°æ®åº“
    - MySQL
---

å†™åœ¨å‰é¢: åœ¨è½¯ä»¶å¼€å‘ä¸­ï¼Œéµå¾ªç€ `first finish then perfect` çš„åŸåˆ™ã€‚å‰æœŸæˆ‘ä»¬å¾€å¾€ä¼šæ›´åŠ å…³æ³¨ç¨‹åºåŠŸèƒ½çš„å®ç°ï¼Œç¼–å†™çš„ `SQL` è¯­å¥ä¹Ÿå¤šä¸ºæ»¡è¶³ä¸šåŠ¡æ‰€éœ€çš„å¢åˆ æ”¹æŸ¥ã€‚å¦‚æœè¿æ°”è¿˜ä¸é”™ï¼Œä¸šåŠ¡åšèµ·æ¥äº†ï¼Œæ•°æ®é‡è¾¾åˆ°ä¸€å®šé‡çº§æ—¶ï¼Œæˆ‘ä»¬å‘ç°ä¸€ä¸ªè¯·æ±‚çš„å“åº”æ—¶é—´ä¼šè¶Šæ¥è¶Šéš¾ä»¥æ¥å—ï¼Œå…¶ä¸­æŸäº›ä¸å†åˆç†çš„ `SQL` å¾€å¾€ä¼šæˆä¸ºæ•´ä¸ªè¯·æ±‚å“åº”ä¸­æ€§èƒ½æ¶ˆè€—å¤§æˆ·ï¼Œç”šè‡³æˆä¸ºæ€§èƒ½ç“¶é¢ˆï¼Œé‚£ä¹ˆæ­¤æ—¶å¯¹ `SQL` è¯­å¥çš„ä¼˜åŒ–å°±æ˜¾å¾—æ ¼å¤–é‡è¦äº†ã€‚è¦ä¼˜åŒ– `SQL` å°±éœ€è¦å®šä½ `SQL` å­˜åœ¨çš„é—®é¢˜ã€‚`MySQL` æä¾›äº† `explain  + sql` å‘½ä»¤æ¥è·å– `SQL` è¯­å¥æ‰§è¡Œè®¡åˆ’çš„ä¿¡æ¯ï¼ŒåŒ…æ‹¬æœ‰å…³å¦‚ä½•è¿æ¥è¡¨ä»¥åŠä»¥ä½•ç§é¡ºåºè¿æ¥è¡¨ã€‚ä»¥ä¸‹ä¸º `explain` ä½¿ç”¨æµ…æï¼Œè®°å½•ğŸ“ä»¥ä¾¿ä»Šåç¿»é˜…ã€‚

å¤‡æ³¨: æ–‡ä¸­ç”¨åˆ°çš„sqlæ•°æ®æ¥è‡ª [employees.sql](https://github.com/inscode/inscode.github.io/blob/master/blog/source/static/myemployees.sql)

#### 1: explain èƒ½è·å–åˆ°é‚£äº›ä¿¡æ¯ï¼Ÿ

- è¡¨çš„è¯»å–é¡ºåº

- è¡¨æ•°æ®è¯»å–æ“ä½œï¼ˆ`select`ï¼‰çš„ç±»å‹

- é‚£äº›æ‰€æœ‰é˜”ä»¥è¢«ä½¿ç”¨

- é‚£äº›ç´¢å¼•å®é™…è¢«ä½¿ç”¨

- è¡¨ä¹‹é—´çš„å¼•ç”¨

- æ¯å¼ è¡¨æœ‰å¤šå°‘è¡Œè¢«ä¼˜åŒ–å™¨æŸ¥è¯¢

#### 2: explain çš„ä½¿ç”¨åŠå…¶å­—æ®µè¯´æ˜

```SQL
-- å¾—åˆ°çš„æ‰§è¡Œè®¡åˆ’å¦‚ä¸‹è¡¨
mysql> explain select * from employees;
+----+-------------+-----------+------------+------+---------------+------+---------+------+------+----------+-------+
| id | select_type | table     | partitions | type | possible_keys | key  | key_len | ref  | rows | filtered | Extra |
+----+-------------+-----------+------------+------+---------------+------+---------+------+------+----------+-------+
|  1 | SIMPLE      | employees | NULL       | ALL  | NULL          | NULL | NULL    | NULL |  107 |   100.00 | NULL  |
+----+-------------+-----------+------------+------+---------------+------+---------+------+------+----------+-------+
1 row in set, 1 warning (0.01 sec)
```
##### 2.1: id å­—æ®µ

**å«ä¹‰æˆ–ç”¨é€”**: select æŸ¥è¯¢çš„åºåˆ—å·ï¼ŒåŒ…å«ä¸€ç»„æ•°å­—ï¼Œè¡¨ç¤ºæŸ¥è¯¢ä¸­æ‰§è¡Œ select å­—å¥æˆ–æ˜¯æ“ä½œè¡¨çš„é¡ºåº

**id çš„ä¸‰ç§æƒ…å½¢**

- id ç›¸åŒï¼Œæ‰§è¡Œé¡ºåºè‡ªä¸Šè€Œä¸‹

    ```SQL
    -- æŸ¥è¯¢å‘˜å·¥åï¼Œéƒ¨é—¨å
    mysql> explain SELECT employees.employee_id,employees.last_name, departments.department_name
        -> from employees
        -> inner join departments
        -> on employees.department_id = departments.department_id;
    +----+-------------+-------------+------------+------+---------------+------------+---------+---------------------------------------+------+----------+-------+
    | id | select_type | table       | partitions | type | possible_keys | key        | key_len | ref                                   | rows | filtered | Extra |
    +----+-------------+-------------+------------+------+---------------+------------+---------+---------------------------------------+------+----------+-------+
    |  1 | SIMPLE      | departments | NULL       | ALL  | PRIMARY       | NULL       | NULL    | NULL                                  |   27 |   100.00 | NULL  |
    |  1 | SIMPLE      | employees   | NULL       | ref  | dept_id_fk    | dept_id_fk | 5       | myemployees.departments.department_id |    9 |   100.00 | NULL  |
    +----+-------------+-------------+------------+------+---------------+------------+---------+---------------------------------------+------+----------+-------+
    2 rows in set, 1 warning (0.00 sec)
    ```
    è¯´æ˜: è¡¨è¯»å–é¡ºåºæ˜¯å…ˆ `departments` å `departments`ã€‚

- id ä¸åŒï¼Œå¦‚æœæ˜¯å­æŸ¥è¯¢ï¼Œid çš„åºå·ä¼šé€’å¢ï¼Œid å€¼è¶Šå¤§å…¶ä¼˜å…ˆçº§è¶Šé«˜ï¼Œå°±è¶Šå…ˆè¢«æ‰§è¡Œã€‚

    ```SQL
    mysql> explain select * from employees where salary = (select max(salary) from employees);
    +----+-------------+-----------+------------+------+---------------+------+---------+------+------+----------+-------------+
    | id | select_type | table     | partitions | type | possible_keys | key  | key_len | ref  | rows | filtered | Extra       |
    +----+-------------+-----------+------------+------+---------------+------+---------+------+------+----------+-------------+
    |  1 | PRIMARY     | employees | NULL       | ALL  | NULL          | NULL | NULL    | NULL |  107 |    10.00 | Using where |
    |  2 | SUBQUERY    | employees | NULL       | ALL  | NULL          | NULL | NULL    | NULL |  107 |   100.00 | NULL        |
    +----+-------------+-----------+------------+------+---------------+------+---------+------+------+----------+-------------+
    2 rows in set, 1 warning (0.00 sec)
    ```
    è¯´æ˜: è¡¨æ‰§è¡Œé¡ºåºæ˜¯å…ˆæ‰§è¡Œ id ä¸º 2 çš„å­æŸ¥è¯¢åæ‰§è¡Œ id ä¸º 1 çš„ä¸»æŸ¥è¯¢ã€‚

- id ç›¸åŒä¸åŒï¼ŒåŒæ—¶å­˜åœ¨ï¼ˆâ“è¿™æ˜¯ä»€ä¹ˆé¬¼ğŸ‘»ï¼‰

    ```SQL
    mysql> æ²¡æ‰¾åˆ°ä¾‹å­ï¼Œä¸‹é¢å°±åªè¡¨ç¤ºä¸€ä¸‹äº†ğŸ˜‚ğŸ˜‚ğŸ˜‚(åªå…³æ³¨ id å°±è¡Œ)
    +----+-------------+-----------+------------+------+---------------+------+---------+------+------+----------+-------------+
    | id | select_type | table     | partitions | type | possible_keys | key  | key_len | ref  | rows | filtered | Extra       |
    +----+-------------+-----------+------------+------+---------------+------+---------+------+------+----------+-------------+
    |  1 | PRIMARY     | employees | NULL       | ALL  | NULL          | NULL | NULL    | NULL |  107 |    10.00 | Using where |
    |  1 | PRIMARY     | employees | NULL       | ALL  | NULL          | NULL | NULL    | NULL |  107 |   100.00 | NULL        |
    |  2 | SUBQUERY    | employees | NULL       | ALL  | NULL          | NULL | NULL    | NULL |  107 |   100.00 | NULL        |
    +----+-------------+-----------+------------+------+---------------+------+---------+------+------+----------+-------------+
    2 rows in set, 1 warning (0.00 sec)
    ```
    è¯´æ˜: id å­—æ®µä¸­æ•°å­—å¤§çš„å…ˆæ‰§è¡Œï¼Œå³æ˜¯ `2å…ˆæ‰§è¡Œ`ï¼Œç„¶åå­˜åœ¨ä¸¤ä¸ªè¯„ä»·çš„ 1ï¼ŒæŒ‰ `è‡ªä¸Šè€Œä¸‹çš„å…ˆåé¡ºåºæ‰§è¡Œ`ã€‚


##### 2.2: `select_type` å­—æ®µ    

**å«ä¹‰æˆ–ç”¨é€”**: è¡¨ç¤º `SELECT` çš„ç±»å‹ï¼Œä¸»è¦ç”¨äºåŒºåˆ« æ™®é€šæŸ¥è¯¢ã€è”åˆæŸ¥è¯¢ã€å­æŸ¥è¯¢ç­‰å¤æ‚æŸ¥è¯¢ã€‚å¸¸è§çš„å–å€¼å¦‚ä¸‹

    ```SQL
    -- 1  SIMPLE     ç®€å• select æŸ¥è¯¢ï¼Œä¸åŒ…å«å­æŸ¥è¯¢æˆ–è€…è¿æ¥æŸ¥è¯¢ï¼ˆunionï¼‰
    -- 2  PRIMARY    ä¸»æŸ¥è¯¢ï¼Œå³æ˜¯å¤–å±‚çš„æŸ¥è¯¢ï¼ˆæŸ¥è¯¢ä¸­åŒ…å«äº†å­æŸ¥è¯¢ï¼‰ï¼ŒPRIMARY æ˜¯æœ€ååŠ è½½çš„æŸ¥è¯¢
    -- 3  SUBQUERY   åœ¨ SELECT æˆ– where æŸ¥è¯¢åŒ…å«äº† å­æŸ¥è¯¢
    -- 4  DERIVED    åœ¨ From åˆ—è¡¨ä¸­åŒ…å«çš„å­æŸ¥è¯¢è¢«æ ‡è®°ä¸º DEVIRED(è¡ç”Ÿ)ã€‚MySQLä¼šé€’å½’æ‰§è¡Œè¿™äº›å­æŸ¥è¯¢ï¼ŒæŠŠç»“æœæ”¾åœ¨ä¸´æ—¶è¡¨ä¸­ï¼ˆä¼šå¢åŠ ç³»ç»Ÿæ¶ˆè€—ï¼‰
    -- 5  UNION      è‹¥ç¬¬äºŒä¸ª SELECT å‡ºç°åœ¨ UNION ä¹‹åï¼Œåˆ™æ ‡è®°ä¸º UNION; è‹¥ UNION åŒ…å«åœ¨ FROM å­—å¥çš„å­æŸ¥è¯¢ä¸­ï¼Œå¤–å±‚çš„ SELECT è¢«æ ‡è®° DEVIRED
    -- 6  UNION RESULT  ä¸¤ç§ UNION ç»“æœçš„åˆå¹¶

    mysql> explain select * from employees where email like '%a%' union select * from employees where department_id>90;
    +----+--------------+------------+------------+-------+---------------+------------+---------+------+------+----------+-----------------------+
    | id  | select_type  | table      | partitions | type  | possible_keys | key        | key_len | ref  | rows | filtered | Extra                 |
    +-----+--------------+------------+------------+-------+---------------+------------+---------+------+------+----------+-----------------------+
    |  1  | PRIMARY      | employees  | NULL       | ALL   | NULL          | NULL       | NULL    | NULL |  107 |    11.11 | Using where           |
    |  2  | UNION        | employees  | NULL       | range | dept_id_fk    | dept_id_fk | 5       | NULL |    8 |   100.00 | Using index condition |
    | NULL| UNION RESULT | <union1,2> | NULL       | ALL   | NULL          | NULL       | NULL    | NULL | NULL |     NULL | Using temporary       |
    +----+--------------+------------+------------+-------+---------------+------------+---------+------+------+----------+-----------------------+
    3 rows in set, 1 warning (0.00 sec)   
    ```

##### 2.3: `table` å­—æ®µ

**å«ä¹‰æˆ–ç”¨é€”**: è¾“å‡ºç»“æœé›†çš„è¡¨


---

æœªå®Œå¾…ç»­
