---
title: MySQLæ¶æ„ä½“ç³»åŠSQLæŸ¥è¯¢æ‰§è¡Œæµç¨‹åˆæ¢
date: 2019-08-17 11:25:22
tags:
    - MySQL
categories:
    - æ•°æ®åº“
    - MySQL
---

ç®€è¿°: è‡ªå·¥ä½œä»¥æ¥ï¼Œå¤§éƒ¨åˆ†çš„æ—¶é—´æ¥è§¦çš„å…³ç³»å‹éƒ½æ˜¯ `MySQL` æ•°æ®åº“ç³»ç»Ÿï¼Œä½†ä½¿ç”¨éƒ½æ¯”è¾ƒæµ…æ˜¾åŸºç¡€(`CRUD`)ã€‚æœ€è¿‘æ‰“ç®—é‡æ–°æ·±å…¥å­¦ä¹ ä¸‹ `MySQL`ï¼Œå®‰è£…çš„ç‰ˆæœ¬æ˜¯ `5.7.21`ï¼Œå­¦ä¹ è®°å½•äºæ­¤ï¼Œä¾¿æ—¥åæ¸©ä¹ æŸ¥çœ‹ã€‚

é¦–å…ˆæ¥çœ‹çœ‹ `MySQL` çš„æ¶æ„å›¾ï¼Œç„¶åä¾æ¬¡æ¥çœ‹çœ‹æ¯ä¸€éƒ¨åˆ†æ˜¯åšä»€ä¹ˆçš„ã€‚

<!--more-->

![](/images/blog/201908/3-MySQLä½“ç³»æ¶æ„å›¾.jpg)

#### 1ï¼šClient

`è¿æ¥å™¨ï¼ˆConnectorsï¼‰`ï¼Œä¹Ÿå°±æ˜¯é€šå¸¸æ‰€è¯´çš„ MySQL å®¢æˆ·ç«¯ã€‚ä¸åŒçš„ç¼–ç¨‹è¯­è¨€æä¾›äº†å¯¹åº”çš„ `API` ä¸ MySQL æœåŠ¡ç³»ç»Ÿè¿›è¡Œäº¤äº’é€šè®¯ã€‚


- é€šè¿‡ `show variables like '%connection%;` æ¥æŸ¥çœ‹ MySQl æœåŠ¡å™¨çš„è¿æ¥ä¿¡æ¯ã€‚é»˜è®¤æœ€å¤§è¿æ¥æ•°æ˜¯151ã€‚

```
mysql> show variables like '%connection%';
+--------------------------+-----------------+
| Variable_name            | Value           |
+--------------------------+-----------------+
| character_set_connection | utf8            |
| collation_connection     | utf8_general_ci |
| max_connections          | 151             |
| max_user_connections     | 0               |
+--------------------------+-----------------+
```

#### 2ï¼šMySQL Server

Server å±‚æ˜¯ MySQL æä¾›æœåŠ¡çš„æ ¸å¿ƒã€‚ä¸»è¦åˆ†ä¸ºä»¥ä¸‹å‡ ä¸ªæ¨¡å—ï¼ˆæŸ¥è¯¢ç¼“å­˜ `MySQL8.0` ç‰ˆæœ¬è¢«åˆ é™¤ï¼Œæ•…æ­¤ä¸åšè®°å½•ğŸ“ï¼‰

##### 2.1ï¼šConnection Poolï¼ˆè¿æ¥æ± ï¼‰

è¿æ¥æ± ä¸»è¦å®ç°ä»¥ä¸‹åŠŸèƒ½

###### 2.1.1ï¼šAuthenticationï¼ˆè¿›è¡Œèº«ä»½éªŒè¯ï¼‰**

`terminal` ä¸‹è¿æ¥å‘½ä»¤å¦‚ä¸‹ `mysql -u root -h localhost - p`ã€‚å¦‚æœç”¨æˆ·åå¯†ç è®¤è¯é€šè¿‡ï¼Œè¿æ¥å™¨ä¼šåˆ° `æƒé™è¡¨` é‡Œé¢æŸ¥å‡ºç”¨æˆ·æ‹¥æœ‰çš„æƒé™ã€‚ä¹‹åï¼Œè¿™ä¸ªè¿æ¥é‡Œé¢çš„æƒé™åˆ¤æ–­é€»è¾‘ï¼Œéƒ½å°†ä¾èµ–äºæ­¤æ—¶è¯»åˆ°çš„æƒé™ã€‚

ä¸€æ—¦ä¸€ä¸ªç”¨æˆ·æˆåŠŸå»ºç«‹è¿æ¥åï¼Œå³ä½¿ä½ ç”¨ç®¡ç†å‘˜è´¦å·å¯¹è¿™ä¸ªç”¨æˆ·çš„æƒé™åšäº†ä¿®æ”¹ï¼Œä¹Ÿä¸ä¼šå½±å“å·²ç»å­˜åœ¨è¿æ¥çš„æƒé™ã€‚ä¿®æ”¹å®Œæˆåï¼Œåªæœ‰å†æ–°å»ºçš„è¿æ¥æ‰ä¼šä½¿ç”¨æ–°çš„æƒé™è®¾ç½®ã€‚

è¿æ¥å®Œæˆåå¦‚æœæ²¡æœ‰ä½¿ç”¨ï¼Œè¯¥è¿æ¥å°±å¤„äº `Sleep` çŠ¶æ€ã€‚å¦‚æœè¶…è¿‡ MySQL æœåŠ¡å™¨é…ç½®çš„ `wait_time` å€¼ï¼Œå¯é€šè¿‡ `show variables like '%wait%';` æŸ¥çœ‹è¯¥å€¼ï¼Œé»˜è®¤æ˜¯ `28800` ç§’ï¼Œè¯¥è¿æ¥å°±ä¼šè¢«å›æ”¶ï¼Œä½¿ç”¨æ—¶å°±éœ€è¦é‡æ–°å»ºç«‹è¿æ¥äº†ã€‚

å¦‚æœå®¢æˆ·ç«¯æŒç»­æœ‰è¯·æ±‚ï¼Œåˆ™ä¸€ç›´ä½¿ç”¨åŒä¸€ä¸ªè¿æ¥ï¼Œåˆ™ç§°è¯¥è¿æ¥ä¸ºé•¿è¿æ¥ã€‚çŸ­è¿æ¥åˆ™æ˜¯æŒ‡æ¯æ¬¡æ‰§è¡Œå®Œå¾ˆå°‘çš„å‡ æ¬¡æŸ¥è¯¢å°±æ–­å¼€è¿æ¥ï¼Œä¸‹æ¬¡æŸ¥è¯¢å†é‡æ–°å»ºç«‹ä¸€ä¸ªã€‚ç”±äºå»ºç«‹è¿æ¥æ¯”è¾ƒå¤æ‚ï¼Œåº”å½“å‡å°‘è¿æ¥çš„æ“ä½œè€Œä½¿ç”¨é•¿è¿æ¥ã€‚ä½†æ˜¯è¿‡å¤šä½¿ç”¨é•¿è¿æ¥ä¼šä½¿å¾—å†…å­˜é£™å‡ï¼ˆå› ä¸º MySQL åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ä¸´æ—¶ä½¿ç”¨çš„å†…å­˜æ˜¯ç®¡ç†åœ¨è¿æ¥å¯¹è±¡é‡Œé¢çš„ã€‚è¿™äº›èµ„æºä¼šåœ¨è¿æ¥æ–­å¼€çš„æ—¶å€™æ‰é‡Šæ”¾ï¼‰å¯¼è‡´ MySQL å¼‚å¸¸é‡å¯ã€‚

**è§£å†³æ–¹æ¡ˆ1** ï¼šå®šæœŸæ–­å¼€é•¿è¿æ¥ã€‚ä½¿ç”¨ä¸€æ®µæ—¶é—´åæˆ–è€…ç¨‹åºé‡Œé¢åˆ¤æ–­æ‰§è¡Œè¿‡ä¸€ä¸ªå ç”¨å†…å­˜çš„å¤§æŸ¥è¯¢åï¼Œå®šæœŸæ–­å¼€è¿æ¥ï¼Œä¹‹åè¦æŸ¥è¯¢æ—¶å†é‡æ–°å»ºç«‹è¿æ¥ï¼›

**è§£å†³æ–¹æ¡ˆ2** ï¼šå¯¹äº MySQL 5.7 åŠåç»­ç‰ˆæœ¬ï¼Œå¯ä»¥åœ¨æ¯æ¬¡æ‰§è¡Œä¸€ä¸ªæ¯”è¾ƒå¤§çš„æ“ä½œåï¼Œé€šè¿‡æ‰§è¡Œ mysql_reset_connection æ¥é‡æ–°åˆå§‹åŒ–è¿æ¥èµ„æºã€‚è¿™ä¸ªè¿‡ç¨‹ä¸éœ€è¦é‡è¿å’Œé‡æ–°åšæƒé™éªŒè¯ï¼Œä½†æ˜¯ä¼šå°†è¿æ¥æ¢å¤åˆ°åˆšåˆšåˆ›å»ºå®Œæ—¶çš„çŠ¶æ€ã€‚

###### 2.1.2ï¼šThread Reuseï¼ˆçº¿ç¨‹é‡ç”¨ï¼‰

###### 2.1.3ï¼šConnection Limitsï¼ˆè¿æ¥é™åˆ¶)

###### 2.1.4ï¼šCheck Memory (å†…å­˜æ£€æµ‹)

###### 2.1.5ï¼šç¼“å­˜

æ¯ä¸ªå®¢æˆ·ç«¯è¿æ¥éƒ½ä¼šåœ¨æœåŠ¡å™¨è¿›ç¨‹ä¸­æ‹¥æœ‰ä¸€ä¸ªçº¿ç¨‹ï¼Œè¿™ä¸ªè¿æ¥çš„æŸ¥è¯¢åªä¼šåœ¨è¿™ä¸ªå•ç‹¬çš„çº¿ç¨‹ä¸­æ‰§è¡Œï¼Œè¯¥çº¿ç¨‹åªèƒ½è½®æµåœ¨æŸä¸ª `cpu` ä¸Šè¿è¡Œï¼ŒæœåŠ¡å™¨ä¼šè´Ÿè´£ç¼“å­˜çº¿ç¨‹ã€‚å› æ­¤ï¼Œä¸éœ€è¦ä¸ºæ¯ä¸€ä¸ªæ–°å»ºçš„è¿æ¥åˆ›å»ºæˆ–é”€æ¯çº¿ç¨‹ï¼Œæˆ–è€…ç›´æ¥ä½¿ç”¨çº¿ç¨‹æ± åŠŸèƒ½ï¼Œæ¥ç»´æŠ¤å¤§é‡çš„å¯ç”¨è¿æ¥ã€‚

---

##### 2.2ï¼šSQL Interfaceï¼ˆSQL æ¥å£ï¼‰

ç”¨äºæ‰§è¡Œ `DML`, `DDL`, å­˜å‚¨è¿‡ç¨‹, è§†å›¾, è§¦å‘å™¨ç­‰ã€‚æ¥æ”¶å®¢æˆ·ç«¯å‘æ¥çš„sqlè¯·æ±‚æŸ¥è¯¢ï¼Œå¹¶è¿”å›éœ€è¦æŸ¥è¯¢çš„ç»“æ„ã€‚

##### 2.3ï¼šParserï¼ˆè§£æå™¨ï¼‰

è§£æå™¨é€šè¿‡å…³é”®å­—å°†SQLè¯­å¥è¿›è¡Œè§£æï¼ˆ**è¯æ³•åˆ†æ + é¢„å‘åˆ†æ**ï¼‰ï¼Œå¹¶ç”Ÿæˆå¯¹åº”çš„æ•°æ®ç»“æ„ï¼ˆè§£ææ ‘ï¼‰ã€‚ç„¶åå¯¹å…¶è¿›è¡Œå„ç§ä¼˜åŒ–ï¼ŒåŒ…æ‹¬é‡å†™æŸ¥è¯¢ï¼Œå†³å®šæŸ¥è¯¢çš„è¯»å†™é¡ºåºï¼Œä»¥åŠé€‰æ‹©é¡»ä½¿ç”¨çš„ç´¢å¼•ç­‰ã€‚MySQLè§£æå™¨å°†ä½¿ç”¨MySQLè¯­æ³•è§„åˆ™éªŒè¯å’Œè§£ææŸ¥è¯¢ã€‚

é¢„å¤„ç†å™¨åˆ™æ ¹æ®ä¸€äº›MySQLè§„åˆ™è¿›è¡Œè¿›ä¸€æ­¥æ£€æŸ¥è§£æä¹¦æ˜¯å¦åˆæ³•ï¼Œä¾‹å¦‚æ£€æŸ¥æ•°æ®è¡¨å’Œæ•°æ®åˆ—æ˜¯å¦å­˜åœ¨ï¼Œè¿˜ä¼šè§£æåå­—å’Œåˆ«åï¼Œçœ‹çœ‹å®ƒä»¬æ˜¯å¦æœ‰æ­§ä¹‰ã€‚

##### 2.4ï¼šOptimizerï¼ˆä¼˜åŒ–å™¨ï¼‰

ä¼˜åŒ–å™¨ä¼šå°† `è§£ææ ‘` è½¬åŒ–æˆ `æ‰§è¡Œè®¡åˆ’`ã€‚ä¸€æ¡æŸ¥è¯¢å¯ä»¥æœ‰å¤šç§æ‰§è¡Œæ–¹æ³•ï¼Œæœ€åéƒ½æ˜¯è¿”å›ç›¸åŒç»“æœã€‚ä¼˜åŒ–å™¨çš„ä½œç”¨å°±æ˜¯ **æ‰¾åˆ°è¿™å…¶ä¸­æœ€å¥½çš„æ‰§è¡Œè®¡åˆ’**ã€‚ç”Ÿæˆæ‰§è¡Œè®¡åˆ’çš„è¿‡ç¨‹ä¼šæ¶ˆè€—è¾ƒå¤šçš„æ—¶é—´ï¼Œç‰¹åˆ«æ˜¯å­˜åœ¨è®¸å¤šå¯é€‰çš„æ‰§è¡Œè®¡åˆ’æ—¶ã€‚

å¦‚æœåœ¨ä¸€æ¡SQLè¯­å¥æ‰§è¡Œçš„è¿‡ç¨‹ä¸­å°†è¯¥è¯­å¥å¯¹åº”çš„æœ€ç»ˆæ‰§è¡Œè®¡åˆ’è¿›è¡Œç¼“å­˜ï¼Œå½“ç›¸ä¼¼çš„è¯­å¥å†æ¬¡è¢«è¾“å…¥æœåŠ¡å™¨æ—¶ï¼Œå°±å¯ä»¥ç›´æ¥ä½¿ç”¨å·²ç¼“å­˜çš„æ‰§è¡Œè®¡åˆ’ï¼Œä»è€Œè·³è¿‡SQLè¯­å¥ç”Ÿæˆæ‰§è¡Œè®¡åˆ’çš„æ•´ä¸ªè¿‡ç¨‹ï¼Œè¿›è€Œå¯ä»¥æé«˜è¯­å¥çš„æ‰§è¡Œé€Ÿåº¦ã€‚

egï¼šæ€ä¹ˆä½¿ç”¨ç´¢å¼•ï¼Œæ€ä¹ˆå¤„ç†è¡¨çš„ Join ä¼˜åŒ–å™¨å¤„ç†

> ä¾‹å¦‚ä¸€ä¸ªæ•°æ®è¡¨å»ºç«‹çš„ç»„åˆç´¢å¼• idx_table_c1c2c3c4, å½“æŸ¥è¯¢æ¡ä»¶ä¸º `where c3='c3' and c2='c2'  and c4='c4' and c1='c1';` æ—¶æŸ¥è¯¢ä¼˜åŒ–å™¨ä¼šè‡ªåŠ¨è°ƒæ•´å’Œä¼˜åŒ–ï¼Œæ­¤æ—¶ç­‰ä»·äº `where c1='c1' and c2='c2'  and c4='c4' and c3='c3';`ã€‚ä½†æ˜¯æœ€ä½³å®è·µæ˜¯æŒ‰ç…§ç´¢å¼•å»ºç«‹çš„é¡ºåºæ¥ä½¿ç”¨ï¼Œä»¥æ­¤æ¥å‡å°‘åº•å±‚ä¼˜åŒ–å™¨çš„å·¥ä½œé‡ã€‚

è§£æå™¨ï¼Œé¢„å¤„ç†å™¨ï¼Œä¼˜åŒ–å™¨å¤„ç†æµç¨‹ [å¦‚ä¸‹å›¾](https://zhuanlan.zhihu.com/p/61546435)

![](/images/blog/201908/4-MySQLè§£æå™¨å’Œä¼˜åŒ–å™¨.jpg)

[å›¾ç‰‡å¼•ç”¨è‡ª ç¨‹åºå‘˜å†å°å†°](https://zhuanlan.zhihu.com/p/61546435)

##### 2.5ï¼šExecutorï¼ˆæ‰§è¡Œå™¨ï¼‰

æ ¹æ® ä¼˜åŒ–å™¨ çš„æ‰§è¡Œè®¡åˆ’å»è°ƒç”¨å­˜å‚¨å¼•æ“ API æ¥å£è·å–æ•°æ®


#### 3ï¼šManagement Serveices & Utilitiesï¼ˆç³»ç»Ÿç®¡ç†å’Œæ§åˆ¶å·¥å…·ï¼‰

å¤‡ä»½ï¼Œå®‰å…¨æ¢å¤ï¼Œå¤åˆ¶ï¼Œé›†ç¾¤ï¼Œç®¡ç†ï¼Œé…ç½®ï¼Œè¿ç§»å’Œå…ƒæ•°æ®ã€‚


#### 4ï¼šPluggable Storage Enginesï¼ˆå¯æ’æ‹”çš„å­˜å‚¨å¼•æ“ï¼‰

- å­˜å‚¨å¼•æ“é’ˆå¯¹æ•°æ®è¡¨

#### 5ï¼šæ–‡ä»¶ç³»ç»Ÿï¼Œæ–‡ä»¶ï¼Œæ—¥å¿—


**è¡¥å……: ä¸€æ¡ SQL æŸ¥è¯¢è¯­å¥å„ä¸ªå…³é”®å­—è§£æçš„é¡ºåºè¿‡ç¨‹**

![SQL è¯­å¥è§£æè¿‡ç¨‹](/images/blog/201908/5-SQLè§£ææµç¨‹.jpg)

**è¡¥å……: ä½¿ç”¨show profile åˆ†æ SQL è¯­å¥æ‰§è¡Œæµç¨‹åŠå…¶è€—æ—¶æƒ…å†µ**

```SQL
mysql> show profiles;
+----------+------------+------------------------------------------------------------+
| Query_ID | Duration   | Query                                                      |
+----------+------------+------------------------------------------------------------+
|       36 | 6.57003650 | select * from employee                                     |
|       37 | 0.02818325 | select * from employee limit 1                             |
|       38 | 0.00047475 | select * from employee limit 1                             |
+----------+------------+------------------------------------------------------------+
15 rows in set, 1 warning (0.00 sec)

mysql> show profile cpu,block io for query 37;
+----------------------+----------+----------+------------+--------------+---------------+
| Status               | Duration | CPU_user | CPU_system | Block_ops_in | Block_ops_out |
+----------------------+----------+----------+------------+--------------+---------------+
| starting             | 0.015488 | 0.000507 |   0.000047 |          512 |             0 |
| checking permissions | 0.000019 | 0.000015 |   0.000002 |            0 |             0 |
| Opening tables       | 0.000606 | 0.000166 |   0.000015 |          112 |             0 |
| init                 | 0.006238 | 0.000140 |   0.000000 |          136 |             0 |
| System lock          | 0.000083 | 0.000083 |   0.000000 |            0 |             0 |
| optimizing           | 0.000007 | 0.000006 |   0.000000 |            0 |             0 |
| statistics           | 0.000188 | 0.000189 |   0.000000 |          240 |             0 |
| preparing            | 0.000018 | 0.000017 |   0.000000 |            0 |             0 |
| executing            | 0.000003 | 0.000003 |   0.000000 |            0 |             0 |
| Sending data         | 0.005445 | 0.000000 |   0.001869 |         1480 |             0 |
| end                  | 0.000012 | 0.000000 |   0.000010 |            0 |             0 |
| query end            | 0.000009 | 0.000000 |   0.000009 |            0 |             0 |
| closing tables       | 0.000007 | 0.000000 |   0.000007 |            0 |             0 |
| freeing items        | 0.000046 | 0.000000 |   0.000047 |            0 |             0 |
| cleaning up          | 0.000014 | 0.000000 |   0.000013 |            0 |             0 |
+----------------------+----------+----------+------------+--------------+---------------+
15 rows in set, 1 warning (0.00 sec)

```

å†™ç€å†™ç€å‘ç°æåŠå¾ˆå¤šçŸ¥è¯†ç‚¹è¿˜æ˜¯æœªçŸ¥ï¼Œè·¯æ¼«æ¼«å…¶ä¿®è¿œå…®ï¼Œéœ€è¦å­¦çš„ä¸œè¥¿è¿˜å¤šï¼Œæ„¿æ¯æ—¥éƒ½æ¯”æ˜¨æ—¥è¿›æ­¥ï¼Œå³ä½¿è¿›æ­¥å¾ˆå¾®å°ã€‚é‚£å…ˆåƒé¥­å»äº†ğŸš

#### todo

- æ•°æ®åº“å®ä¾‹äº†è§£


---

**å‚è€ƒ**

[MySQLå®æˆ˜45è®²](https://time.geekbang.org/column/article/68319)

[ä¸€æ¡SQLè¯­å¥åœ¨MySQLä¸­æ˜¯å¦‚ä½•æ‰§è¡Œçš„](https://zhuanlan.zhihu.com/p/61757521)

[æœ¬æ¥ä»¥ä¸ºmysqlå³å°†æ¶ˆäº¡ï¼Œæ²¡æƒ³åˆ°å®ƒå´è¶Šæ¥è¶Šå¼ºå¤§](https://www.jianshu.com/p/bb6bdedbf9ce)

[MySQLä½“ç³»æ¶æ„](https://www.jianshu.com/p/7d1552883289)

[mysqlä½“ç³»æ¶æ„å›¾ä»¥åŠäºŒè¿›åˆ¶å®‰è£…mariadb](https://www.jianshu.com/p/1a3a932ccf88)

[MySQLä¸­çš„å®ä¾‹ã€æ•°æ®åº“å…³ç³»ç®€ä»‹](https://blog.csdn.net/u010342038/article/details/52798320)
