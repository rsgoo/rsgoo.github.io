---
title: MySQLä¼˜åŒ–ä¹‹ç´¢å¼•ä½¿ç”¨åŸåˆ™
date: 2019-08-25 11:45:50
tags:
    - MySQL
categories:
    - æ•°æ®åº“
    - MySQL
---

**å†™åœ¨å‰é¢**: å‰é¢äº†è§£åˆ°ç´¢å¼•æ˜¯å¸®åŠ© `MySQL` é«˜æ•ˆè·å–æ•°æ®çš„æ•°æ®ç»“æ„ã€‚é‚£ä¹ˆåœ¨ä¸€ä¸ªæ•°æ®è¡¨æŸ¥è¯¢åº”ç”¨ä¸­ï¼Œæˆ‘ä»¬æ˜¯å¦åº”è¯¥ä½¿ç”¨ç´¢å¼•ï¼Ÿè¯¥æ€æ ·ä½¿ç”¨ç´¢å¼•ï¼Ÿä»€ä¹ˆåœºæ™¯ä¸‹ç´¢å¼•ä¼šå¤±æ•ˆï¼Ÿ

<!--more-->

**æ•°æ®å‡†å¤‡**

```sql
-- å»ºè¡¨è¯­å¥
create table staffs(
    id int PRIMARY key auto_increment,
    name varchar(24) not null default '' comment 'å§“å',
    age int not null default 0 comment 'å¹´é¾„',
    pos varchar(20) not null default '' comment 'èŒä½',
    add_time timestamp not null default current_timestamp comment 'å…¥èŒæ—¶é—´'
)default character set utf8mb4 comment 'å‘˜å·¥è®°å½•è¡¨';

-- æ•°æ®æ’å…¥
insert into staffs(name, age, pos, add_time)
values
('z3', 22, 'manager', now()),
('July', 23, 'dev', now()),
('2000', 23, 'dev', now()),
('tom', 2, 'pm', now()),
('jerry', 2, 'pm', now());

-- å»ºç«‹ç»„åˆç´¢å¼•
mysql> create index idx_staffs_nameAgePos on staffs(name,age,pos);
```

---

#### 1: ç´¢å¼•ä½¿ç”¨åŸåˆ™

- 1ï¼šå…¨å€¼åŒ¹é…æˆ‘æœ€çˆ±

    ```SQL
    -- ç»„åˆç´¢å¼•çš„æ‰€æœ‰å­—æ®µå…¨éƒ¨ä½¿ç”¨åˆ°ï¼Œå…¨å€¼åŒ¹é…
    mysql> explain select * from staffs where name='July' and age=23 and pos='dev';
    +----+-------------+--------+------------+------+-----------------------+-----------------------+---------+-------------------+------+----------+-------+
    | id | select_type | table  | partitions | type | possible_keys         | key                   | key_len | ref               | rows | filtered | Extra |
    +----+-------------+--------+------------+------+-----------------------+-----------------------+---------+-------------------+------+----------+-------+
    |  1 | SIMPLE      | staffs | NULL       | ref  | idx_staffs_nameAgePos | idx_staffs_nameAgePos | 184     | const,const,const |    1 |   100.00 | NULL  |
    +----+-------------+--------+------------+------+-----------------------+-----------------------+---------+-------------------+------+----------+-------+
    ```

- 2ï¼šæœ€å·¦å‰ç¼€åŸåˆ™ã€å¸¦å¤´å¤§å“¥ä¸æ˜¯æ­»ï¼Œä¸­é—´å…„å¼ŸğŸ‘¬ä¸èƒ½æ–­ã€‘

    > å¦‚æœä½¿ç”¨äº†ç»„åˆç´¢å¼•ï¼Œè¦éµå¾ªæœ€å·¦å‰ç¼€åŸåˆ™ï¼ŒæŸ¥è¯¢ä»ç´¢å¼•çš„æœ€å·¦å‰åˆ—å¼€å§‹å¹¶ä¸”ä¸èƒ½è·³è¿‡ç´¢å¼•ä¸­çš„åˆ—ã€‚

- 3ï¼šä¸è¦åœ¨ç´¢å¼•åˆ—ä¸Šåšä»»ä½•æ“ä½œï¼ˆè®¡ç®—ï¼Œå‡½æ•°ï¼Œã€Œæ‰‹åŠ¨ | è‡ªåŠ¨ã€ç±»å‹è½¬æ¢ï¼‰ï¼Œä¼šå¯¼è‡´ç´¢å¼•å¤±æ•ˆè€Œè½¬å‘å…¨è¡¨æ‰«æã€ç´¢å¼•åˆ—ä¸Šå°‘è®¡ç®—ã€‘

    ```SQL
    -- ä½¿ç”¨åˆ°äº†left()å‡½æ•°
    mysql> explain select * from staffs where left(name,4) = "July";
    +----+-------------+--------+------------+------+---------------+------+---------+------+------+----------+-------------+
    | id | select_type | table  | partitions | type | possible_keys | key  | key_len | ref  | rows | filtered | Extra       |
    +----+-------------+--------+------------+------+---------------+------+---------+------+------+----------+-------------+
    |  1 | SIMPLE      | staffs | NULL       | ALL  | NULL          | NULL | NULL    | NULL |    5 |   100.00 | Using where |
    +----+-------------+--------+------------+------+---------------+------+---------+------+------+----------+-------------+
    1 row in set, 1 warning (0.00 sec)
    ```

- 4ï¼šå­˜å‚¨å¼•æ“ä¸èƒ½ä½¿ç”¨ç´¢å¼•ä¸­ **èŒƒå›´æ¡ä»¶(å¤§äºï¼Œå°äº...)** å³è¾¹çš„åˆ—ã€èŒƒå›´ä¹‹åå…¨å¤±æ•ˆã€‘

    ```SQL
    -- ç»„åˆç´¢å¼•name,ageçš„éƒ¨åˆ†ç´¢å¼•è¢«ç”¨åˆ°
    mysql> explain select * from staffs where name='July' and age>20 and pos='dev';
    +----+-------------+--------+------------+-------+-----------------------+-----------------------+---------+------+------+----------+-----------------------+
    | id | select_type | table  | partitions | type  | possible_keys         | key                   | key_len | ref  | rows | filtered | Extra                 |
    +----+-------------+--------+------------+-------+-----------------------+-----------------------+---------+------+------+----------+-----------------------+
    |  1 | SIMPLE      | staffs | NULL       | range | idx_staffs_nameAgePos | idx_staffs_nameAgePos | 102     | NULL |    1 |    20.00 | Using index condition |
    +----+-------------+--------+------------+-------+-----------------------+-----------------------+---------+------+------+----------+-----------------------+
    1 row in set, 1 warning (0.00 sec)

    ```

- 5ï¼šå°½é‡ä½¿ç”¨è¦†ç›–ç´¢å¼•(æŸ¥è¯¢çš„åˆ—æ˜¯ç´¢å¼•çš„ä¸€éƒ¨åˆ†)ï¼Œå‡å°‘ `select *` ä½¿ç”¨

    ```SQL
    -- å…¨è¡¨æ‰«æ
    mysql> explain select * from staffs;
    +----+-------------+--------+------------+------+---------------+------+---------+------+------+----------+-------+
    | id | select_type | table  | partitions | type | possible_keys | key  | key_len | ref  | rows | filtered | Extra |
    +----+-------------+--------+------------+------+---------------+------+---------+------+------+----------+-------+
    |  1 | SIMPLE      | staffs | NULL       | ALL  | NULL          | NULL | NULL    | NULL |    5 |   100.00 | NULL  |
    +----+-------------+--------+------------+------+---------------+------+---------+------+------+----------+-------+
    1 row in set, 1 warning (0.00 sec)

    -- Extra ä¸º Using index, ä½¿ç”¨åˆ°äº†è¦†ç›–ç´¢å¼•
    mysql> explain select name,age,pos from staffs;
    +----+-------------+--------+------------+-------+---------------+-----------------------+---------+------+------+----------+-------------+
    | id | select_type | table  | partitions | type  | possible_keys | key                   | key_len | ref  | rows | filtered | Extra       |
    +----+-------------+--------+------------+-------+---------------+-----------------------+---------+------+------+----------+-------------+
    |  1 | SIMPLE      | staffs | NULL       | index | NULL          | idx_staffs_nameAgePos | 184     | NULL |    5 |   100.00 | Using index |
    +----+-------------+--------+------------+-------+---------------+-----------------------+---------+------+------+----------+-------------+
    1 row in set, 1 warning (0.00 sec)

    -- è¦†ç›–ç´¢å¼•
    mysql> explain select name,age,pos from staffs where name='July' and age=22 and pos='dev';
    +----+-------------+--------+------------+------+-----------------------+-----------------------+---------+-------------------+------+----------+-------------+
    | id | select_type | table  | partitions | type | possible_keys         | key                   | key_len | ref               | rows | filtered | Extra       |
    +----+-------------+--------+------------+------+-----------------------+-----------------------+---------+-------------------+------+----------+-------------+
    |  1 | SIMPLE      | staffs | NULL       | ref  | idx_staffs_nameAgePos | idx_staffs_nameAgePos | 184     | const,const,const |    1 |   100.00 | Using index |
    +----+-------------+--------+------------+------+-----------------------+-----------------------+---------+-------------------+------+----------+-------------+
    1 row in set, 1 warning (0.00 sec)

    ```

- 6ï¼šåœ¨ä¸ä½¿ç”¨è¦†ç›–ç´¢å¼•çš„æƒ…å†µä¸‹ï¼Œ`MySQL` åœ¨ä½¿ç”¨ä¸ç­‰äºè¿ç®—ç¬¦çš„æ—¶å€™æ— æ³•ä½¿ç”¨ç´¢å¼•ä¼šå¯¼è‡´å…¨è¡¨æ‰«æï¼Œ

    ```SQL
    -- è¿™é‡ŒæŸ¥è¯¢çš„åˆ—éƒ½æ˜¯ç´¢å¼•çš„åˆ—ï¼Œå› æ­¤ç”¨åˆ°äº†è¦†ç›–ç´¢å¼•
    mysql> explain select name,age,pos from staffs where name != 'July';
    +----+-------------+--------+------------+-------+-----------------------+-----------------------+---------+------+------+----------+--------------------------+
    | id | select_type | table  | partitions | type  | possible_keys         | key                   | key_len | ref  | rows | filtered | Extra                    |
    +----+-------------+--------+------------+-------+-----------------------+-----------------------+---------+------+------+----------+--------------------------+
    |  1 | SIMPLE      | staffs | NULL       | range | idx_staffs_nameAgePos | idx_staffs_nameAgePos | 98      | NULL |    4 |   100.00 | Using where; Using index |
    +----+-------------+--------+------------+-------+-----------------------+-----------------------+---------+------+------+----------+--------------------------+

    -- ä½¿ç”¨äº†ä¸ç­‰è¿ç®—ï¼Œä¹Ÿæ²¡æœ‰ä½¿ç”¨åˆ°è¦†ç›–ç´¢å¼•ï¼Œå› æ­¤ä¼šå…¨è¡¨æ‰«æ
    mysql> explain select * from staffs where name != 'July';
    +----+-------------+--------+------------+------+-----------------------+------+---------+------+------+----------+-------------+
    | id | select_type | table  | partitions | type | possible_keys         | key  | key_len | ref  | rows | filtered | Extra       |
    +----+-------------+--------+------------+------+-----------------------+------+---------+------+------+----------+-------------+
    |  1 | SIMPLE      | staffs | NULL       | ALL  | idx_staffs_nameAgePos | NULL | NULL    | NULL |    5 |    80.00 | Using where |
    +----+-------------+--------+------------+------+-----------------------+------+---------+------+------+----------+-------------+
    ```

- 7ï¼š`is null` æˆ–è€… `is not null` ä¹Ÿæ— æ³•ä½¿ç”¨ç´¢å¼•ï¼Œæ‰€ä»¥å»ºè¡¨æ—¶ä½¿ç”¨é»˜è®¤å€¼

    ```SQL
    -- type ä¸º all, Extra ä¸º Using where
    mysql> explain select * from staffs where name is not null;
    +----+-------------+--------+------------+------+-----------------------+------+---------+------+------+----------+-------------+
    | id | select_type | table  | partitions | type | possible_keys         | key  | key_len | ref  | rows | filtered | Extra       |
    +----+-------------+--------+------------+------+-----------------------+------+---------+------+------+----------+-------------+
    |  1 | SIMPLE      | staffs | NULL       | ALL  | idx_staffs_nameAgePos | NULL | NULL    | NULL |    5 |    80.00 | Using where |
    +----+-------------+--------+------------+------+-----------------------+------+---------+------+------+----------+-------------+
    1 row in set, 1 warning (0.00 sec)

    -- type ä¸º null, Extra ä¸º Impossible WHERE
    -- null è™½ç„¶æ— æ³•ä½¿ç”¨ç´¢å¼•ä½†æ˜¯ is null é€Ÿåº¦æ˜¯æœ€å¿«çš„â“
    mysql> explain select * from staffs where name is null;
    +----+-------------+-------+------------+------+---------------+------+---------+------+------+----------+------------------+
    | id | select_type | table | partitions | type | possible_keys | key  | key_len | ref  | rows | filtered | Extra            |
    +----+-------------+-------+------------+------+---------------+------+---------+------+------+----------+------------------+
    |  1 | SIMPLE      | NULL  | NULL       | NULL | NULL          | NULL | NULL    | NULL | NULL |     NULL | Impossible WHERE |
    +----+-------------+-------+------------+------+---------------+------+---------+------+------+----------+------------------+
    1 row in set, 1 warning (0.02 sec)

    ```

- 8ï¼š`like` ä»¥é€šé…ç¬¦ `%` å¼€å¤´ï¼ˆ`eg: like '%abc'`ï¼‰çš„SQLè¯­å¥ç´¢å¼•å¤±æ•ˆä¼šå˜æˆå…¨è¡¨æ‰«æ

    > è§£å†³æ–¹æ¡ˆï¼šä½¿ç”¨è¦†ç›–ç´¢å¼•ä»£æ›¿å…¨è¡¨æ‰«æ

    ```SQL
    -- ç´¢å¼•å¤±æ•ˆï¼Œå…¨è¡¨æ‰«æ
    mysql> explain select * from staffs where name like '%July';
    +----+-------------+--------+------------+------+---------------+------+---------+------+------+----------+-------------+
    | id | select_type | table  | partitions | type | possible_keys | key  | key_len | ref  | rows | filtered | Extra       |
    +----+-------------+--------+------------+------+---------------+------+---------+------+------+----------+-------------+
    |  1 | SIMPLE      | staffs | NULL       | ALL  | NULL          | NULL | NULL    | NULL |    5 |    20.00 | Using where |
    +----+-------------+--------+------------+------+---------------+------+---------+------+------+----------+-------------+
    1 row in set, 1 warning (0.00 sec)

    -- ä½¿ç”¨éƒ¨åˆ†ç´¢å¼•
    mysql> explain select * from staffs where name like 'July%';
    +----+-------------+--------+------------+-------+-----------------------+-----------------------+---------+------+------+----------+-----------------------+
    | id | select_type | table  | partitions | type  | possible_keys         | key                   | key_len | ref  | rows | filtered | Extra                 |
    +----+-------------+--------+------------+-------+-----------------------+-----------------------+---------+------+------+----------+-----------------------+
    |  1 | SIMPLE      | staffs | NULL       | range | idx_staffs_nameAgePos | idx_staffs_nameAgePos | 98      | NULL |    1 |   100.00 | Using index condition |
    +----+-------------+--------+------------+-------+-----------------------+-----------------------+---------+------+------+----------+-----------------------+
    1 row in set, 1 warning (0.00 sec)

    ```

    > å‡è®¾ç´¢å¼•ä¸º index(a,b,c); è¯­å¥1ï¼šwhere a = 3 and b like 'aa%' and c=4 èƒ½ç”¨åˆ°ç´¢å¼• a b cï¼›è¯­å¥2ï¼šwhere a = 3 and b like 'aa%bb%' and c=4 ä¹Ÿèƒ½ç”¨åˆ°ç´¢å¼• a b cï¼›

- 9ï¼š**å­—ç¬¦ä¸²ä¸åŠ å•å¼•å·ç´¢å¼•ä¼šå¤±æ•ˆ** ã€æ•°æ®ç±»å‹è¢«éšå¼è½¬æ¢ã€‘

    > varchar ç±»å‹ ä½¿ç”¨æ—¶éœ€è¦åŠ ä¸Šå•å¼•å·ã€‚

    ```SQL
    -- åŠ äº† å•å¼•å·ï¼Œå’Œå»ºè¡¨å­—æ®µå®šä¹‰ç±»å‹ä¸€è‡´
    mysql> explain select * from staffs where name='2000';
    +----+-------------+--------+------------+------+-----------------------+-----------------------+---------+-------+------+----------+-------+
    | id | select_type | table  | partitions | type | possible_keys         | key                   | key_len | ref   | rows | filtered | Extra |
    +----+-------------+--------+------------+------+-----------------------+-----------------------+---------+-------+------+----------+-------+
    |  1 | SIMPLE      | staffs | NULL       | ref  | idx_staffs_nameAgePos | idx_staffs_nameAgePos | 98      | const |    1 |   100.00 | NULL  |
    +----+-------------+--------+------------+------+-----------------------+-----------------------+---------+-------+------+----------+-------+
    1 row in set, 1 warning (0.00 sec)

    -- å»ºè¡¨name å­—æ®µæ˜¯å­—ç¬¦ä¸²ç±»å‹ï¼Œç°åœ¨çš„æŸ¥è¯¢æ˜¯æ•°å€¼ç±»å‹ï¼Œç´¢å¼•å¤±æ•ˆ
    mysql> explain select * from staffs where name=2000;
    +----+-------------+--------+------------+------+-----------------------+------+---------+------+------+----------+-------------+
    | id | select_type | table  | partitions | type | possible_keys         | key  | key_len | ref  | rows | filtered | Extra       |
    +----+-------------+--------+------------+------+-----------------------+------+---------+------+------+----------+-------------+
    |  1 | SIMPLE      | staffs | NULL       | ALL  | idx_staffs_nameAgePos | NULL | NULL    | NULL |    5 |    20.00 | Using where |
    +----+-------------+--------+------------+------+-----------------------+------+---------+------+------+----------+-------------+
    1 row in set, 3 warnings (0.00 sec)
    ```

- 10ï¼šå°½å¯èƒ½å°‘ç”¨ `or`ï¼Œç”¨å®ƒæ¥è¿æ¥æ—¶ç´¢å¼•ä¼šå¤±æ•ˆã€‚

    ```SQL
    -- å…¨è¡¨æ‰«æ
    mysql> explain select * from staffs where name="July" or name = 'tom';
    +----+-------------+--------+------------+------+-----------------------+------+---------+------+------+----------+-------------+
    | id | select_type | table  | partitions | type | possible_keys         | key  | key_len | ref  | rows | filtered | Extra       |
    +----+-------------+--------+------------+------+-----------------------+------+---------+------+------+----------+-------------+
    |  1 | SIMPLE      | staffs | NULL       | ALL  | idx_staffs_nameAgePos | NULL | NULL    | NULL |    5 |    40.00 | Using where |
    +----+-------------+--------+------------+------+-----------------------+------+---------+------+------+----------+-------------+

    ```
---

```SQL
create table test03(
    id int PRIMARY key auto_increment,
    c1 char(10),
    c2 char(10),
    c3 char(10),
    c4 char(10),
    c5 char(10)
);

insert into test03(c1,c2,c3,c4,c5)
values
('a1','a2','a3','a4','a5'),
('b1','b2','b3','b4','b5'),
('c1','c2','c3','c4','c5'),
('d1','d2','d3','d4','d5'),
('e1','e2','e3','e4','e5'),
('f1','f2','f3','f4','f5');

create index idx_test03_c1234 on test03(c1,c2,c3,c4);
```
