---
title: MySQLä¼˜åŒ–ä¹‹å°è¡¨é©±åŠ¨å¤§è¡¨
date: 2019-08-26 21:58:23
tags:
    - MySQL
categories:
    - æ•°æ®åº“
    - MySQL
---

**å†™åœ¨å‰é¢**ï¼šå‰é¢å­¦ä¹ äº†é€šè¿‡ `explain` æŸ¥çœ‹ `SQL` è¯­å¥çš„æ‰§è¡Œè®¡åˆ’ï¼Œç„¶åå¯¹å…¶è¿›è¡Œå¿…è¦çš„ç´¢å¼•ä¼˜åŒ–ã€‚é‚£ä¹ˆæˆ‘ä»¬åˆè¯¥æ€ä¹ˆè·å–åˆ°è¿™äº› `SQL` è¯­å¥å‘¢ğŸ¤”ğŸ¤”ğŸ¤”ï¼Ÿ

<!--more-->

#### è·å–æ…¢SQLçš„æ–¹æ³•

- 1ï¼šå¼€å¯æ…¢æŸ¥è¯¢æ—¥å¿—ï¼Œè®¾ç½® `é˜ˆ(yÃ¹)å€¼`ï¼Œæ¯”å¦‚è¶…è¿‡ 3 ç§’å°±å®šä¹‰ä¸ºæ…¢SQLï¼Œç„¶åè¿›è¡Œè®°å½•

- 2ï¼šè§‚å¯Ÿã€‚åœ¨æŒ‡å®šçš„ç¯å¢ƒï¼ˆç”Ÿäº§ï¼‰è¿åŠ¨æŒ‡å®šæ—¶é—´çš„åº”ç”¨ç¨‹åºï¼Œçœ‹çœ‹äº§ç”Ÿæ…¢SQLçš„æƒ…å†µã€‚

- 3ï¼šä½¿ç”¨ `explain + æ…¢SQL` æŸ¥çœ‹SQLè¯­å¥çš„æ‰§è¡Œè®¡åˆ’è¿›è¡Œåˆ†æã€‚

- 4ï¼š`show profile` æŸ¥è¯¢ sql è¯­å¥åœ¨æ•°æ®åº“æœåŠ¡å™¨ä¸­çš„æ‰§è¡Œç»†èŠ‚å’Œç”Ÿå‘½å‘¨æœŸæƒ…å†µã€‚

- 5ï¼šMySQL æ•°æ®åº“æœåŠ¡å™¨å‚æ•°è°ƒä¼˜ï¼ˆè¿™ä¸ªåŸºæœ¬å’Œæˆ‘ä»¬æ²¡æœ‰åŠæ¯›é’±å…³ç³»ï¼‰


#### ä¼˜åŒ–åŸåˆ™ä¹‹ å°è¡¨é©±åŠ¨å¤§è¡¨

> å³æ˜¯ä½¿ç”¨å°çš„ç»“æœé›†é©±åŠ¨å¤§çš„ç»“æœé›†ã€‚

- å½“ B è¡¨çš„æ•°æ®é›†å°äº A è¡¨çš„æ•°æ®é›†æ—¶ï¼Œä½¿ç”¨ `in` ä¼˜äº `exists`ã€‚

```SQL
select * from A where id in(select id from B)

-- ç­‰ä»·äº
for select id from B

    for select * from A where A.id = B.id

-- å¤–å±‚ for å¾ªç¯çš„æ¬¡æ•°è¶Šå°è¶Šå¥½
```

- å½“ A è¡¨çš„æ•°æ®é›†å°äº B è¡¨çš„æ•°æ®é›†æ—¶ï¼Œä½¿ç”¨ `exists` ä¼˜äº `in`ã€‚

```SQL
select * from A where exists (select å¸¸é‡ï¼ˆeg:1) from B WHERE B.id = A.id);

-- ç­‰ä»·äº
for select id from A

    for select * from B where A.id = B.id

```

å½“å­æŸ¥è¯¢éœ€è¦ç”¨åˆ°ä¸»æŸ¥è¯¢çš„æ•°æ®çš„æ—¶å€™ï¼Œä¸»æŸ¥è¯¢ä¸€æ¬¡å°±æ‰§è¡Œä¸€æ¬¡å­æŸ¥è¯¢

- in å’Œ exists çš„äº’è½¬

```SQL
-- æ•°æ®å‡†å¤‡
mysql> select * from websites;
-- 5 æ¡è®°å½•
+----+--------------+---------------------------+-------+---------+
| id | name         | url                       | alexa | country |
+----+--------------+---------------------------+-------+---------+
|  1 | Google       | https://www.google.cm/    |     1 | USA     |
|  2 | æ·˜å®          | https://www.taobao.com/   |    13 | CN      |
|  3 | èœé¸Ÿæ•™ç¨‹      | http://www.runoob.com/    |  4689 | CN      |
|  4 | å¾®åš          | http://weibo.com/         |    20 | CN      |
|  5 | Facebook     | https://www.facebook.com/ |     3 | USA     |
+----+--------------+---------------------------+-------+---------+
5 rows in set (0.00 sec)

mysql> select * from access_log;
-- 12 æ¡è®°å½•
+-----+---------+-------+------------+
| aid | site_id | count | date       |
+-----+---------+-------+------------+
|   1 |       1 |    45 | 2016-05-10 |
|   2 |       3 |   100 | 2016-05-13 |
|   3 |       1 |   230 | 2016-05-14 |
|   4 |       2 |    10 | 2016-05-14 |
|   5 |       5 |   205 | 2016-05-14 |
|   6 |       4 |    13 | 2016-05-15 |
|   7 |       3 |   220 | 2016-05-15 |
|   8 |       5 |   545 | 2016-05-16 |
|   9 |       3 |   201 | 2016-05-17 |
|  10 |       6 |  2011 | 2016-05-17 |
|  11 |       7 |  2012 | 2016-05-18 |
|  12 |       8 |  2013 | 2016-05-19 |
+-----+---------+-------+------------+
12 rows in set (0.00 sec)

-- æŸ¥è¯¢åˆé‚£äº›ç«™ç‚¹è¢«è®¿é—®è¿‡

----ä½¿ç”¨ in
mysql> select * from websites where id in (select site_id from access_log);
+----+----------+---------------------------+-------+---------+
| id | name     | url                       | alexa | country |
+----+----------+---------------------------+-------+---------+
|  1 | Google   | https://www.google.cm/    |     1 | USA     |
|  2 | æ·˜å®     | https://www.taobao.com/   |    13 | CN      |
|  4 | å¾®åš     | http://weibo.com/         |    20 | CN      |
|  5 | Facebook | https://www.facebook.com/ |     3 | USA     |
+----+----------+---------------------------+-------+---------+
4 rows in set (0.00 sec)

----æŸ¥çœ‹æ‰§è¡Œè®¡åˆ’
mysql> explain select * from websites where id in (select site_id from access_log);
+----+--------------+-------------+------------+--------+---------------+------------+---------+--------------------+------+----------+-------------+
| id | select_type  | table       | partitions | type   | possible_keys | key        | key_len | ref                | rows | filtered | Extra       |
+----+--------------+-------------+------------+--------+---------------+------------+---------+--------------------+------+----------+-------------+
|  1 | SIMPLE       | websites    | NULL       | ALL    | PRIMARY       | NULL       | NULL    | NULL               |    5 |   100.00 | Using where |
|  1 | SIMPLE       | <subquery2> | NULL       | eq_ref | <auto_key>    | <auto_key> | 4       | runoob.websites.id |    1 |   100.00 | NULL        |
|  2 | MATERIALIZED | access_log  | NULL       | ALL    | NULL          | NULL       | NULL    | NULL               |   12 |   100.00 | NULL        |
+----+--------------+-------------+------------+--------+---------------+------------+---------+--------------------+------+----------+-------------+
3 rows in set, 1 warning (0.00 sec)

-------------------------------------------------------------
-------------------------------------------------------------

---- ä½¿ç”¨ exists
mysql> select * from websites where exists (select 1 from access_log where websites.id=access_log.site_id);
+----+----------+---------------------------+-------+---------+
| id | name     | url                       | alexa | country |
+----+----------+---------------------------+-------+---------+
|  1 | Google   | https://www.google.cm/    |     1 | USA     |
|  2 | æ·˜å®     | https://www.taobao.com/   |    13 | CN      |
|  4 | å¾®åš     | http://weibo.com/         |    20 | CN      |
|  5 | Facebook | https://www.facebook.com/ |     3 | USA     |
+----+----------+---------------------------+-------+---------+
4 rows in set (0.00 sec)

----æŸ¥çœ‹æ‰§è¡Œè®¡åˆ’
mysql> explain select * from websites where exists (select 1 from access_log where websites.id=access_log.site_id);
+----+--------------------+------------+------------+------+---------------+------+---------+------+------+----------+-------------+
| id | select_type        | table      | partitions | type | possible_keys | key  | key_len | ref  | rows | filtered | Extra       |
+----+--------------------+------------+------------+------+---------------+------+---------+------+------+----------+-------------+
|  1 | PRIMARY            | websites   | NULL       | ALL  | NULL          | NULL | NULL    | NULL |    5 |   100.00 | Using where |
|  2 | DEPENDENT SUBQUERY | access_log | NULL       | ALL  | NULL          | NULL | NULL    | NULL |   12 |    10.00 | Using where |
+----+--------------------+------------+------------+------+---------------+------+---------+------+------+----------+-------------+
2 rows in set, 2 warnings (0.01 sec)

```

æ ¹æ®å°è¡¨é©±åŠ¨å¤§è¡¨çš„åŸåˆ™ï¼Œä¸Šé¢çš„ä¸¤ä¸ª `SQLè¯­å¥` ç¬¬äºŒä¸ªä½¿ç”¨ `exists` æ›´åˆé€‚
