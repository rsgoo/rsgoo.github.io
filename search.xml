<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>MySQLä¼˜åŒ–ä¹‹æ…¢æŸ¥è¯¢æ—¥å¿—</title>
      <link href="/2019/08/28/MySQL%E4%BC%98%E5%8C%96%E4%B9%8B%E6%85%A2%E6%9F%A5%E8%AF%A2%E6%97%A5%E5%BF%97/"/>
      <url>/2019/08/28/MySQL%E4%BC%98%E5%8C%96%E4%B9%8B%E6%85%A2%E6%9F%A5%E8%AF%A2%E6%97%A5%E5%BF%97/</url>
      
        <content type="html"><![CDATA[<p><strong>å†™åœ¨å‰é¢</strong>ï¼š <code>MySQL</code> çš„æ…¢æŸ¥è¯¢æ—¥å¿—æ˜¯ <code>MySQL</code> æä¾›çš„ä¸€ç§æ—¥å¿—è®°å½•ï¼Œç”¨äºè®°å½•åœ¨ <code>MySQL</code> ä¸­å“åº”æ—¶é—´è¶…è¿‡é˜ˆå€¼çš„è¯­å¥ã€‚å³æ˜¯æŒ‡ â˜ å¦‚æœè¿è¡Œæ—¶é—´è¶…è¿‡é…ç½® <code>long_query_time</code> å€¼çš„ <code>SQL</code> è¯­å¥ï¼Œåˆ™ä¼šè¢«è®°å½•åˆ°æ…¢æŸ¥è¯¢æ—¥å¿—ä¸­ã€‚</p><hr><p>1ï¼šæŸ¥çœ‹ <code>MySQL</code> æœåŠ¡å™¨é»˜è®¤é…ç½®çš„ <code>long_query_time</code> å€¼</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show variables like 'long_query_time';</span><br><span class="line">+<span class="comment">-----------------+-----------+</span></span><br><span class="line">| Variable_name   | Value     |</span><br><span class="line">+<span class="comment">-----------------+-----------+</span></span><br><span class="line">| long_query_time | 10.000000 |</span><br><span class="line">+<span class="comment">-----------------+-----------+</span></span><br><span class="line">1 row in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line"><span class="string">``</span><span class="string">`   </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">2ï¼šæŸ¥çœ‹åŠå¼€å¯ **æ…¢æŸ¥è¯¢** æ—¥å¿—ä¿¡æ¯</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&gt; MySQLæœåŠ¡å™¨é…ç½®æ–‡ä»¶è¯¦è§ [MySQL 5.7.21-1é…ç½®æ–‡ä»¶my.cnf](https://inscode.github.io/2019/08/15/MySQL-5-7-21-1%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6my-cnf/)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">`</span><span class="string">``</span><span class="keyword">SQL</span></span><br><span class="line"><span class="comment">-- æŸ¥çœ‹</span></span><br><span class="line">mysql&gt; <span class="keyword">show</span> <span class="keyword">variables</span> <span class="keyword">like</span> <span class="string">'%slow_query%'</span>;</span><br><span class="line">+<span class="comment">---------------------+---------------------------------+</span></span><br><span class="line">| Variable_name       | Value                           |</span><br><span class="line">+<span class="comment">---------------------+---------------------------------+</span></span><br><span class="line">| slow_query_log      | OFF                             |</span><br><span class="line">| slow_query_log_file | /var/lib/mysql/inscode-slow.log |</span><br><span class="line">+<span class="comment">---------------------+---------------------------------+</span></span><br><span class="line">2 rows in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line"><span class="comment">-- ä¿®æ”¹ slow_query_log ç›¸å…³é…ç½®ï¼Œç„¶åé‡å¯ MySQL</span></span><br><span class="line">slow_query_log        = <span class="number">1</span></span><br><span class="line">slow_query_log_file   = /<span class="keyword">var</span>/<span class="keyword">log</span>/mysql/mysql-slow.log</span><br></pre></td></tr></table></figure><p>3ï¼šæ•è·æ…¢æŸ¥è¯¢æ—¥å¿—</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">root@inscode:/var/log/mysql&gt; tail -f mysql-slow.log</span><br><span class="line"></span><br><span class="line"><span class="comment"># Time: 2019-08-28T15:08:48.983829Z   --SQLæ‰§è¡Œæ—¶é—´</span></span><br><span class="line"><span class="comment"># User@Host: root[root] @ localhost []  Id:     2   --æ‰§è¡Œsqlçš„è´¦æˆ·åŠè¿æ¥ä¿¡æ¯</span></span><br><span class="line"><span class="comment">-- sqlæ‰§è¡Œæ—¶é•¿           --é”ğŸ”æ—¶é•¿           --è¿”å›çš„è®°å½•æ•°       --æŸ¥è¯¢æ£€æŸ¥çš„è¡Œæ•°ï¼ˆä¸ºä»€ä¹ˆè¿™ä¸ªå€¼ä¼šå¤§äºè¯¥è¡¨çš„æ€»è®°å½•æ•°å‘¢ï¼ŸğŸ¤”ğŸ¤”ğŸ¤”ï¼‰</span></span><br><span class="line"><span class="comment"># Query_time: 0.288241  Lock_time: 0.000526 Rows_sent: 204846  Rows_examined: 504870</span></span><br><span class="line"><span class="keyword">SET</span> <span class="built_in">timestamp</span>=<span class="number">1567004928</span>;   <span class="comment">--æ—¶é—´æˆ³ 2019-08-28 23:08:48</span></span><br><span class="line"><span class="comment">-- è¶…è¿‡MySQLæœåŠ¡å™¨ long_query_time æ—¶é•¿çš„sqlè¯­å¥</span></span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> employees <span class="keyword">where</span>  birth_date&gt;<span class="string">'1950'</span> <span class="keyword">and</span> first_name <span class="keyword">like</span> <span class="string">'%e%'</span> <span class="keyword">or</span> last_name <span class="keyword">like</span> <span class="string">'%a%'</span> <span class="keyword">and</span> hire_date&gt;<span class="string">'1986'</span> <span class="keyword">order</span> <span class="keyword">by</span> birth_date <span class="keyword">desc</span>, last_name <span class="keyword">asc</span>, hire_date <span class="keyword">desc</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment"># Time: 2019-08-28T15:08:56.678322Z</span></span><br><span class="line"><span class="comment"># User@Host: root[root] @ localhost []  Id:     2</span></span><br><span class="line"><span class="comment"># Query_time: 0.287522  Lock_time: 0.000226 Rows_sent: 204846  Rows_examined: 504870</span></span><br><span class="line"><span class="keyword">SET</span> <span class="built_in">timestamp</span>=<span class="number">1567004936</span>;</span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> employees <span class="keyword">where</span>  birth_date&gt;<span class="string">'1950'</span> <span class="keyword">and</span> first_name <span class="keyword">like</span> <span class="string">'%e%'</span> <span class="keyword">or</span> last_name <span class="keyword">like</span> <span class="string">'%a%'</span> <span class="keyword">and</span> hire_date&gt;<span class="string">'1986'</span> <span class="keyword">order</span> <span class="keyword">by</span> birth_date <span class="keyword">desc</span>, last_name <span class="keyword">asc</span>;</span><br></pre></td></tr></table></figure><p>4ï¼š <code>mysqldumpslow</code> çš„ä½¿ç”¨</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">root@inscode:/etc/mysql/mysql.conf.d&gt; mysqldumpslow --help</span><br><span class="line">Usage: mysqldumpslow [ OPTS... ] [ LOGS... ]</span><br><span class="line"></span><br><span class="line">Parse and summarize the MySQL slow query log. Options are</span><br><span class="line"></span><br><span class="line">  --verbose    verbose</span><br><span class="line">  --debug      debug</span><br><span class="line">  --help       write this text to standard output</span><br><span class="line"></span><br><span class="line">  -v           verbose</span><br><span class="line">  -d           debug</span><br><span class="line">  -s ORDER     what to sort by (al, at, ar, c, l, r, t), &apos;at&apos; is default</span><br><span class="line">                al: average lock time   //è¯„è®ºé”å®šæ—¶é—´</span><br><span class="line">                ar: average rows sent   //è¯„è®ºè¿”å›æ—¶é—´</span><br><span class="line">                at: average query time  //å¹³å‡æ‰§è¡Œæ—¶é—´</span><br><span class="line">                 c: count               //è®¿é—®æ¬¡æ•°</span><br><span class="line">                 l: lock time           //é”å®šæ—¶é—´</span><br><span class="line">                 r: rows sent           //è¿”å›çš„è®°å½•è¡Œæ•°</span><br><span class="line">                 t: query time          //æŸ¥è¯¢æ—¶é—´</span><br><span class="line">  -r           reverse the sort order (largest last instead of first)</span><br><span class="line">  -t NUM       just show the top n queries</span><br><span class="line">  -a           don&apos;t abstract all numbers to N and strings to &apos;S&apos;</span><br><span class="line">  -n NUM       abstract numbers with at least n digits within names</span><br><span class="line">  -g PATTERN   grep: only consider stmts that include this string</span><br><span class="line">  -h HOSTNAME  hostname of db server for *-slow.log filename (can be wildcard),</span><br><span class="line">               default is &apos;*&apos;, i.e. match all</span><br><span class="line">  -i NAME      name of server instance (if using mysql.server startup script)</span><br><span class="line">  -l           don&apos;t subtract lock time from total time</span><br></pre></td></tr></table></figure><ul><li><p>è·å– è¿”å›è®°å½•ç»“æœé›†æœ€å¤šçš„10ä¸ªsqlè¯­å¥</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysqldumpslow -s r -t 10 /var/log/mysql/mysql-slow.log</span><br></pre></td></tr></table></figure></li><li><p>è·å– è®¿é—®æ¬¡æ•°æœ€å¤šçš„10ä¸ªsqlè¯­å¥</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysqldumpslow -s c -t 10 /var/log/mysql/mysql-slow.log</span><br></pre></td></tr></table></figure></li><li><p>è·å– æŒ‰ç…§æ—¶é—´æ’åºçš„å‰10æ¡ä¸­å«æœ‰ â€œå·¦è¿æ¥â€ çš„æŸ¥è¯¢è¯­å¥</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mysqldumpslow -s t -t 10 -g|"left join" /var/log/mysql/mysql-slow.log</span><br><span class="line"><span class="comment">-- ä½¿ç”¨more é˜²æ­¢ çˆ†å±</span></span><br><span class="line">mysqldumpslow -s t -t 10 -g|"left join" /var/log/mysql/mysql-slow.log | more</span><br></pre></td></tr></table></figure></li></ul>]]></content>
      
      
      <categories>
          
          <category> æ•°æ®åº“ </category>
          
          <category> MySQL </category>
          
      </categories>
      
      
        <tags>
            
            <tag> MySQL </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>MySQLä¼˜åŒ–ä¹‹orderByä¼˜åŒ–</title>
      <link href="/2019/08/27/MySQL%E4%BC%98%E5%8C%96%E4%B9%8BorderBy%E4%BC%98%E5%8C%96/"/>
      <url>/2019/08/27/MySQL%E4%BC%98%E5%8C%96%E4%B9%8BorderBy%E4%BC%98%E5%8C%96/</url>
      
        <content type="html"><![CDATA[<p><strong>å†™åœ¨å‰é¢</strong>ï¼š<code>order by</code> å­—å¥åº”è¯¥å°½é‡ä½¿ç”¨ <code>Index</code> æ–¹å¼æ’åºï¼Œé¿å…ä½¿ç”¨ <code>Filesort</code> æ–¹å¼æ’åºã€‚</p><a id="more"></a><p>1ï¼š MySQLæ”¯æŒä¸¤ç§æ–¹å¼çš„æ’åº: <code>Filesort</code> å’Œ <code>Index</code>ã€‚Index æ•ˆç‡é«˜ï¼Œå› ä¸ºMySQLæ‰«ææœ¬èº«å°±èƒ½å®Œæˆæ’åºã€‚<code>Filesort</code> æ–¹å¼æ•ˆç‡è¾ƒä½ï¼Œå› ä¸ºå®ƒéœ€è¦çš„ç´¢å¼•çš„åŸºç¡€ä¸Šå†æ¬¡æ’åºã€‚</p><p>2ï¼š order by æ»¡è¶³ä¸¤ç§æƒ…å†µæ—¶ä¼šä½¿ç”¨ <code>Index</code> æ–¹å¼æ’åº</p><ul><li><p>ä½¿ç”¨ <code>ORDER BY</code> è¯­å¥ä½¿ç”¨ <strong>ç´¢å¼•æœ€å·¦å‰åˆ—</strong></p></li><li><p>ä½¿ç”¨ <code>Where</code> å­—å¥å’Œ <code>Order by</code> å­—å¥çš„æ¡ä»¶åˆ—ç»„åˆæ»¡è¶³  <strong>ç´¢å¼•æœ€å·¦å‰åˆ—</strong></p>  <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">explain</span> <span class="keyword">select</span> * <span class="keyword">from</span> tableA <span class="keyword">where</span> age&gt;<span class="number">20</span> <span class="keyword">order</span> <span class="keyword">by</span> birth;</span><br></pre></td></tr></table></figure></li></ul><p>3ï¼šå¦‚æœ <code>order by</code> åçš„å­—æ®µæ²¡æœ‰åœ¨ç´¢å¼•åˆ—ä¸Šï¼Œä¼šäº§ç”Ÿ <code>Filesort</code>ã€‚<code>Filesort</code> æœ‰ä¸¤ç§ç®—æ³•ï¼š<strong>å•è·¯æ’åº</strong> å’Œ <strong>åŒè·¯æ’åº</strong>ã€‚</p><ul><li><p>åŒè·¯æ’åºï¼šæ‰«æç£ç›˜ä¸¤æ¬¡ï¼Œæœ€ç»ˆå¾—åˆ°æ•°æ®ã€‚ã€ä¸¤æ¬¡I/Oã€‘</p><blockquote><p>ä»ç£ç›˜å–å‡ºæ’åºå­—æ®µï¼Œåœ¨bufferä¸­è¿›è¡Œæ’åºï¼Œå†ä»ç£ç›˜å–å…¶ä»–å­—æ®µã€‚</p></blockquote></li><li><p>å•è·¯æ’åºï¼š</p><blockquote><p>ä»ç£ç›˜è¯»å–æŸ¥è¯¢æ‰€éœ€è¦çš„ <strong>æ‰€æœ‰åˆ—</strong>ï¼ŒæŒ‰ç…§ order by æŒ‡å®šçš„åˆ—åœ¨ buffer å¯¹å®ƒä»¬è¿›è¡Œæ’åºï¼Œç„¶åæ‰«ææ’åºåçš„åˆ—è¿›è¡Œè¾“å‡ºã€‚å•è·¯æ’åºçš„æ•ˆç‡æ›´å¿«ä¸€äº›ï¼Œå®ƒé¿å…äº†ç¬¬äºŒæ¬¡è¯»å–æ•°æ®ã€‚å¹¶ä¸”æŠŠ <code>éšæœºIO</code> å˜æˆäº† <code>é¡ºåºIO</code>ã€‚ä½†æ˜¯ä¼šå¸¦æ¥ä½¿ç”¨æ›´å¤šçš„ç©ºé—´ï¼Œå› ä¸ºä»–æŠŠæ¯ä¸€è¡Œéƒ½ä¿å­˜åœ¨å†…å­˜ä¸­ã€‚</p></blockquote><blockquote><p>å•è·¯æ’åºç®—æ³•å¤±æ•ˆï¼šå–å‡ºçš„æ‰€æœ‰åˆ—çš„å¤§å°è¶…è¿‡äº† <strong>sort_buffer_size</strong> çš„å®¹é‡ï¼Œå¯¼è‡´å®é™…ä¸Šæ¯æ¬¡åªèƒ½æŒ‰ç…§ <strong>sort_buffer_size</strong> çš„å¤§å°å–æ•°æ®è¿›è¡Œæ’åºï¼Œæ‹å®Œåºåå†å– <strong>sort_buffer_size</strong> å®¹é‡å¤§å°çš„æ•°æ®ï¼Œåœ¨æ’åºâ€¦.å¦‚æ­¤å¾€å¤ï¼Œä»è€Œå¤šæ¬¡ I/O</p></blockquote><blockquote><p>ä¼˜åŒ–ç­–ç•¥ï¼šã€è°ƒæ•´ sort_buffer_size å‚æ•°çš„å€¼ã€‘ã€è°ƒæ•´max_length_for_sort_data å‚æ•°çš„å€¼ã€‘</p></blockquote></li></ul><p>4ï¼šä½¿ç”¨ <strong>order by</strong> çš„ä¸€äº›ä¼˜åŒ–ç­–ç•¥</p><ul><li><p>1ï¼šorder by æ—¶ <code>select *</code>æ˜¯ä¸å¤ªå¥½çš„å·¥ç¨‹å®è·µã€‚åº”è¯¥åªæŸ¥è¯¢éœ€è¦çš„å­—æ®µã€‚</p><ul><li><p>åŸå› 1ï¼šå½“æŸ¥è¯¢çš„å­å¼¹å¤§å°æ€»å’Œå°äº <code>max_length_for_sort_data</code> å¹¶æ²¡æ’åºçš„å­—æ®µä¸æ˜¯ <code>text || bolb</code> ç±»å‹æ—¶ï¼Œä¼šä½¿ç”¨å•è·¯æ’åºç®—æ³•ï¼Œå¦åˆ™ä¼šä½¿ç”¨å¤šè·¯æ’åºç®—æ³•</p></li><li><p>åŸå› 2ï¼šä¸¤ç§æ’åºç®—æ³•çš„æ•°æ®éƒ½æœ‰å¯èƒ½è¶…è¿‡ <code>sort_buffer_size</code> çš„å®¹é‡ï¼Œè¶…å‡ºä¹‹åï¼Œä¼šåˆ›å»º <code>tmp</code> æ–‡ä»¶è¿›è¡Œåˆå¹¶ï¼Œä»è€Œå¯¼è‡´å¤šæ¬¡ I/0ã€‚è€Œä½¿ç”¨å•è·¯æ’åºç®—æ³•å‡ºç°çš„æ¦‚ç‡æ›´å¤šä¸€äº›ï¼Œæ‰€ä»¥è¦å¢åŠ  <code>sort_buffer_size</code> å€¼å¤§å°ã€‚</p></li></ul></li><li><p>2ï¼šå°è¯•æé«˜ <code>sort_buffer_size</code> å‚æ•°çš„å€¼</p></li><li><p>3ï¼šå°è¯•æé«˜ <code>max_length_for_sort_data</code> å‚æ•°çš„å€¼</p></li></ul><p><img src="/images/blog/201908/8-order-by%E6%98%AF%E5%90%A6%E4%BD%BF%E7%94%A8%E7%B4%A2%E5%BC%95%E6%8E%92%E5%BA%8F%E5%88%86%E6%9E%90.jpeg" alt="order-byæ˜¯å¦ä½¿ç”¨ç´¢å¼•æ’åºåˆ†æ"></p><hr><p>æ•°æ®å‡†å¤‡</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- å»ºè¡¨è¯­å¥</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> tableA(</span><br><span class="line">    <span class="keyword">id</span> <span class="built_in">int</span> primary <span class="keyword">key</span> <span class="keyword">not</span> <span class="literal">null</span> auto_increment,</span><br><span class="line">    age <span class="built_in">int</span>,</span><br><span class="line">    birth <span class="built_in">timestamp</span> <span class="keyword">not</span> <span class="literal">null</span></span><br><span class="line">)<span class="keyword">default</span>  <span class="built_in">character</span> <span class="keyword">set</span> utf8mb4;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- æ•°æ®æ’å…¥</span></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> tableA(age, birth) <span class="keyword">values</span>(<span class="number">22</span>, <span class="keyword">NOW</span>());</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> tableA(age, birth) <span class="keyword">values</span>(<span class="number">23</span>, <span class="keyword">NOW</span>());</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> tableA(age, birth) <span class="keyword">values</span>(<span class="number">24</span>, <span class="keyword">NOW</span>());</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> tableA(age, birth) <span class="keyword">values</span>(<span class="number">25</span>, <span class="keyword">NOW</span>());</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> tableA(age, birth) <span class="keyword">values</span>(<span class="number">26</span>, <span class="keyword">NOW</span>());</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> tableA(age, birth) <span class="keyword">values</span>(<span class="number">27</span>, <span class="keyword">NOW</span>());</span><br><span class="line"></span><br><span class="line"><span class="comment">-- å»ºç«‹ç»„åˆç´¢å¼•</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">index</span> idx_ageBirth <span class="keyword">on</span> tableA(age,birth);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- order byæ’åºå­—æ®µé¡ºåºå’Œç´¢å¼•å­—æ®µé¡ºåºä¸€è‡´ï¼Œä¸ä¼šäº§ç”Ÿæ–‡ä»¶æ’åº</span></span><br><span class="line">mysql&gt; explain select * from tableA where age&gt;20 order by age,birth;</span><br><span class="line">+<span class="comment">----+-------------+--------+------------+-------+---------------+--------------+---------+------+------+----------+--------------------------+</span></span><br><span class="line">| id | select_type | table  | partitions | type  | possible_keys | key          | key_len | ref  | rows | filtered | Extra                    |</span><br><span class="line">+<span class="comment">----+-------------+--------+------------+-------+---------------+--------------+---------+------+------+----------+--------------------------+</span></span><br><span class="line">|  1 | SIMPLE      | tableA | NULL       | index | idx_ageBirth  | idx_ageBirth | 9       | NULL |    6 |   100.00 | Using where; Using index |</span><br><span class="line">+<span class="comment">----+-------------+--------+------------+-------+---------------+--------------+---------+------+------+----------+--------------------------+</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- order byæ’åºå­—æ®µé¡ºåºå’Œç´¢å¼•çš„é¡ºåºä¸ä¸€è‡´ï¼Œå› æ­¤ä¼šäº§ç”Ÿæ–‡ä»¶æ’åºã€‚</span></span><br><span class="line">mysql&gt; explain select * from tableA where age&gt;20 order by birth;</span><br><span class="line">+<span class="comment">----+-------------+--------+------------+-------+---------------+--------------+---------+------+------+----------+------------------------------------------+</span></span><br><span class="line">| id | select_type | table  | partitions | type  | possible_keys | key          | key_len | ref  | rows | filtered | Extra                                    |</span><br><span class="line">+<span class="comment">----+-------------+--------+------------+-------+---------------+--------------+---------+------+------+----------+------------------------------------------+</span></span><br><span class="line">|  1 | SIMPLE      | tableA | NULL       | index | idx_ageBirth  | idx_ageBirth | 9       | NULL |    6 |   100.00 | Using where; Using index; Using filesort |</span><br><span class="line">+<span class="comment">----+-------------+--------+------------+-------+---------------+--------------+---------+------+------+----------+------------------------------------------+</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- order byæ’åºå­—æ®µé¡ºåºå’Œç´¢å¼•çš„é¡ºåºä¸ä¸€è‡´ï¼Œå› æ­¤ä¼šäº§ç”Ÿæ–‡ä»¶æ’åºã€‚</span></span><br><span class="line">mysql&gt; explain select * from tableA where age&gt;20 order by birth,age;</span><br><span class="line">+<span class="comment">----+-------------+--------+------------+-------+---------------+--------------+---------+------+------+----------+------------------------------------------+</span></span><br><span class="line">| id | select_type | table  | partitions | type  | possible_keys | key          | key_len | ref  | rows | filtered | Extra                                    |</span><br><span class="line">+<span class="comment">----+-------------+--------+------------+-------+---------------+--------------+---------+------+------+----------+------------------------------------------+</span></span><br><span class="line">|  1 | SIMPLE      | tableA | NULL       | index | idx_ageBirth  | idx_ageBirth | 9       | NULL |    6 |   100.00 | Using where; Using index; Using filesort |</span><br><span class="line">+<span class="comment">----+-------------+--------+------------+-------+---------------+--------------+---------+------+------+----------+------------------------------------------+</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- order byåä¸æ˜¯åŒå‡åŒé™éƒ½ä¼šä½¿ç”¨åˆ°æ–‡ä»¶æ’åº Filesort</span></span><br><span class="line"><span class="comment">-- ç´¢å¼•æ˜¯æ’å¥½åºçš„å¿«é€ŸæŸ¥æ‰¾æ•°æ®ç»“æ„ï¼Œä¸æŒ‰ç…§å·²ç»æ’åºçš„è§„åˆ™å»è·å–æ•°æ®ä¼šäº§ç”Ÿæ–‡ä»¶å†…æ’åº</span></span><br><span class="line">mysql&gt; explain select age,birth from tableA where birth&gt;"2019-08-27 21:52:08" order by age desc,birth asc;</span><br><span class="line">+<span class="comment">----+-------------+--------+------------+-------+---------------+--------------+---------+------+------+----------+------------------------------------------+</span></span><br><span class="line">| id | select_type | table  | partitions | type  | possible_keys | key          | key_len | ref  | rows | filtered | Extra                                    |</span><br><span class="line">+<span class="comment">----+-------------+--------+------------+-------+---------------+--------------+---------+------+------+----------+------------------------------------------+</span></span><br><span class="line">|  1 | SIMPLE      | tableA | NULL       | index | NULL          | idx_ageBirth | 9       | NULL |    6 |    33.33 | Using where; Using index; Using filesort |</span><br><span class="line">+<span class="comment">----+-------------+--------+------------+-------+---------------+--------------+---------+------+------+----------+------------------------------------------+</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- order byåä¸æ˜¯åŒå‡åŒé™éƒ½ä¼šä½¿ç”¨åˆ°æ–‡ä»¶æ’åº Filesort</span></span><br><span class="line">mysql&gt; explain select age,birth from tableA where birth&gt;"2019-08-27 21:52:08" order by age asc,birth desc;</span><br><span class="line">+<span class="comment">----+-------------+--------+------------+-------+---------------+--------------+---------+------+------+----------+------------------------------------------+</span></span><br><span class="line">| id | select_type | table  | partitions | type  | possible_keys | key          | key_len | ref  | rows | filtered | Extra                                    |</span><br><span class="line">+<span class="comment">----+-------------+--------+------------+-------+---------------+--------------+---------+------+------+----------+------------------------------------------+</span></span><br><span class="line">|  1 | SIMPLE      | tableA | NULL       | index | NULL          | idx_ageBirth | 9       | NULL |    6 |    33.33 | Using where; Using index; Using filesort |</span><br><span class="line">+<span class="comment">----+-------------+--------+------------+-------+---------------+--------------+---------+------+------+----------+------------------------------------------+</span></span><br></pre></td></tr></table></figure><hr><p><code>Group by</code> çš„ä¼˜åŒ–ç­–ç•¥å’ŒåŸç†å’Œ <code>Order by</code> è¶‹åŒï¼Œå”¯ä¸€çš„ä¸€ç‚¹æ˜¯ <code>where</code> æ¡ä»¶ä¼˜å…ˆçº§é«˜äº <code>having</code>ï¼Œèƒ½å†™åœ¨ <code>where</code> é™å®šçš„æ¡ä»¶å°±ä¸è¦å» <code>having</code> é™å®šã€‚</p><hr><p>ç¬”è®°æ¥è‡ª <a href="https://www.bilibili.com/video/av49181542/?p=226" target="_blank" rel="noopener">MySQLé«˜çº§_ä¸ºæ’åºä½¿ç”¨ç´¢å¼•OrderBy</a></p>]]></content>
      
      
      <categories>
          
          <category> æ•°æ®åº“ </category>
          
          <category> MySQL </category>
          
      </categories>
      
      
        <tags>
            
            <tag> MySQL </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>MySQLä¼˜åŒ–ä¹‹å°è¡¨é©±åŠ¨å¤§è¡¨</title>
      <link href="/2019/08/26/MySQL%E4%BC%98%E5%8C%96%E4%B9%8B%E5%B0%8F%E8%A1%A8%E9%A9%B1%E5%8A%A8%E5%A4%A7%E8%A1%A8/"/>
      <url>/2019/08/26/MySQL%E4%BC%98%E5%8C%96%E4%B9%8B%E5%B0%8F%E8%A1%A8%E9%A9%B1%E5%8A%A8%E5%A4%A7%E8%A1%A8/</url>
      
        <content type="html"><![CDATA[<p><strong>å†™åœ¨å‰é¢</strong>ï¼šå‰é¢å­¦ä¹ äº†é€šè¿‡ <code>explain</code> æŸ¥çœ‹ <code>SQL</code> è¯­å¥çš„æ‰§è¡Œè®¡åˆ’ï¼Œç„¶åå¯¹å…¶è¿›è¡Œå¿…è¦çš„ç´¢å¼•ä¼˜åŒ–ã€‚é‚£ä¹ˆæˆ‘ä»¬åˆè¯¥æ€ä¹ˆè·å–åˆ°è¿™äº› <code>SQL</code> è¯­å¥å‘¢ğŸ¤”ğŸ¤”ğŸ¤”ï¼Ÿ</p><a id="more"></a><h4 id="è·å–æ…¢SQLçš„æ–¹æ³•"><a href="#è·å–æ…¢SQLçš„æ–¹æ³•" class="headerlink" title="è·å–æ…¢SQLçš„æ–¹æ³•"></a>è·å–æ…¢SQLçš„æ–¹æ³•</h4><ul><li><p>1ï¼šå¼€å¯æ…¢æŸ¥è¯¢æ—¥å¿—ï¼Œè®¾ç½® <code>é˜ˆ(yÃ¹)å€¼</code>ï¼Œæ¯”å¦‚è¶…è¿‡ 3 ç§’å°±å®šä¹‰ä¸ºæ…¢SQLï¼Œç„¶åè¿›è¡Œè®°å½•</p></li><li><p>2ï¼šè§‚å¯Ÿã€‚åœ¨æŒ‡å®šçš„ç¯å¢ƒï¼ˆç”Ÿäº§ï¼‰è¿åŠ¨æŒ‡å®šæ—¶é—´çš„åº”ç”¨ç¨‹åºï¼Œçœ‹çœ‹äº§ç”Ÿæ…¢SQLçš„æƒ…å†µã€‚</p></li><li><p>3ï¼šä½¿ç”¨ <code>explain + æ…¢SQL</code> æŸ¥çœ‹SQLè¯­å¥çš„æ‰§è¡Œè®¡åˆ’è¿›è¡Œåˆ†æã€‚</p></li><li><p>4ï¼š<code>show profile</code> æŸ¥è¯¢ sql è¯­å¥åœ¨æ•°æ®åº“æœåŠ¡å™¨ä¸­çš„æ‰§è¡Œç»†èŠ‚å’Œç”Ÿå‘½å‘¨æœŸæƒ…å†µã€‚</p></li><li><p>5ï¼šMySQL æ•°æ®åº“æœåŠ¡å™¨å‚æ•°è°ƒä¼˜ï¼ˆè¿™ä¸ªåŸºæœ¬å’Œæˆ‘ä»¬æ²¡æœ‰åŠæ¯›é’±å…³ç³»ï¼‰</p></li></ul><h4 id="ä¼˜åŒ–åŸåˆ™ä¹‹-å°è¡¨é©±åŠ¨å¤§è¡¨"><a href="#ä¼˜åŒ–åŸåˆ™ä¹‹-å°è¡¨é©±åŠ¨å¤§è¡¨" class="headerlink" title="ä¼˜åŒ–åŸåˆ™ä¹‹ å°è¡¨é©±åŠ¨å¤§è¡¨"></a>ä¼˜åŒ–åŸåˆ™ä¹‹ å°è¡¨é©±åŠ¨å¤§è¡¨</h4><blockquote><p>å³æ˜¯ä½¿ç”¨å°çš„ç»“æœé›†é©±åŠ¨å¤§çš„ç»“æœé›†ã€‚</p></blockquote><ul><li>å½“ B è¡¨çš„æ•°æ®é›†å°äº A è¡¨çš„æ•°æ®é›†æ—¶ï¼Œä½¿ç”¨ <code>in</code> ä¼˜äº <code>exists</code>ã€‚</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> A <span class="keyword">where</span> <span class="keyword">id</span> <span class="keyword">in</span>(<span class="keyword">select</span> <span class="keyword">id</span> <span class="keyword">from</span> B)</span><br><span class="line"></span><br><span class="line"><span class="comment">-- ç­‰ä»·äº</span></span><br><span class="line"><span class="keyword">for</span> <span class="keyword">select</span> <span class="keyword">id</span> <span class="keyword">from</span> B</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> <span class="keyword">select</span> * <span class="keyword">from</span> A <span class="keyword">where</span> A.id = B.id</span><br><span class="line"></span><br><span class="line"><span class="comment">-- å¤–å±‚ for å¾ªç¯çš„æ¬¡æ•°è¶Šå°è¶Šå¥½</span></span><br></pre></td></tr></table></figure><ul><li>å½“ A è¡¨çš„æ•°æ®é›†å°äº B è¡¨çš„æ•°æ®é›†æ—¶ï¼Œä½¿ç”¨ <code>exists</code> ä¼˜äº <code>in</code>ã€‚</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> A <span class="keyword">where</span> <span class="keyword">exists</span> (<span class="keyword">select</span> å¸¸é‡ï¼ˆeg:<span class="number">1</span>) <span class="keyword">from</span> B <span class="keyword">WHERE</span> B.id = A.id);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- ç­‰ä»·äº</span></span><br><span class="line">for <span class="keyword">select</span> <span class="keyword">id</span> <span class="keyword">from</span> A</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> <span class="keyword">select</span> * <span class="keyword">from</span> B <span class="keyword">where</span> A.id = B.id</span><br></pre></td></tr></table></figure><p>å½“å­æŸ¥è¯¢éœ€è¦ç”¨åˆ°ä¸»æŸ¥è¯¢çš„æ•°æ®çš„æ—¶å€™ï¼Œä¸»æŸ¥è¯¢ä¸€æ¬¡å°±æ‰§è¡Œä¸€æ¬¡å­æŸ¥è¯¢</p><ul><li>in å’Œ exists çš„äº’è½¬</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- æ•°æ®å‡†å¤‡</span></span><br><span class="line">mysql&gt; select * from websites;</span><br><span class="line"><span class="comment">-- 5 æ¡è®°å½•</span></span><br><span class="line">+<span class="comment">----+--------------+---------------------------+-------+---------+</span></span><br><span class="line">| id | name         | url                       | alexa | country |</span><br><span class="line">+<span class="comment">----+--------------+---------------------------+-------+---------+</span></span><br><span class="line">|  1 | Google       | https://www.google.cm/    |     1 | USA     |</span><br><span class="line">|  2 | æ·˜å®          | https://www.taobao.com/   |    13 | CN      |</span><br><span class="line">|  3 | èœé¸Ÿæ•™ç¨‹      | http://www.runoob.com/    |  4689 | CN      |</span><br><span class="line">|  4 | å¾®åš          | http://weibo.com/         |    20 | CN      |</span><br><span class="line">|  5 | Facebook     | https://www.facebook.com/ |     3 | USA     |</span><br><span class="line">+<span class="comment">----+--------------+---------------------------+-------+---------+</span></span><br><span class="line">5 rows in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; <span class="keyword">select</span> * <span class="keyword">from</span> access_log;</span><br><span class="line"><span class="comment">-- 12 æ¡è®°å½•</span></span><br><span class="line">+<span class="comment">-----+---------+-------+------------+</span></span><br><span class="line">| aid | site_id | count | date       |</span><br><span class="line">+<span class="comment">-----+---------+-------+------------+</span></span><br><span class="line">|   1 |       1 |    45 | 2016-05-10 |</span><br><span class="line">|   2 |       3 |   100 | 2016-05-13 |</span><br><span class="line">|   3 |       1 |   230 | 2016-05-14 |</span><br><span class="line">|   4 |       2 |    10 | 2016-05-14 |</span><br><span class="line">|   5 |       5 |   205 | 2016-05-14 |</span><br><span class="line">|   6 |       4 |    13 | 2016-05-15 |</span><br><span class="line">|   7 |       3 |   220 | 2016-05-15 |</span><br><span class="line">|   8 |       5 |   545 | 2016-05-16 |</span><br><span class="line">|   9 |       3 |   201 | 2016-05-17 |</span><br><span class="line">|  10 |       6 |  2011 | 2016-05-17 |</span><br><span class="line">|  11 |       7 |  2012 | 2016-05-18 |</span><br><span class="line">|  12 |       8 |  2013 | 2016-05-19 |</span><br><span class="line">+<span class="comment">-----+---------+-------+------------+</span></span><br><span class="line">12 rows in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line"><span class="comment">-- æŸ¥è¯¢åˆé‚£äº›ç«™ç‚¹è¢«è®¿é—®è¿‡</span></span><br><span class="line"></span><br><span class="line"><span class="comment">----ä½¿ç”¨ in</span></span><br><span class="line">mysql&gt; <span class="keyword">select</span> * <span class="keyword">from</span> websites <span class="keyword">where</span> <span class="keyword">id</span> <span class="keyword">in</span> (<span class="keyword">select</span> site_id <span class="keyword">from</span> access_log);</span><br><span class="line">+<span class="comment">----+----------+---------------------------+-------+---------+</span></span><br><span class="line">| id | name     | url                       | alexa | country |</span><br><span class="line">+<span class="comment">----+----------+---------------------------+-------+---------+</span></span><br><span class="line">|  1 | Google   | https://www.google.cm/    |     1 | USA     |</span><br><span class="line">|  2 | æ·˜å®     | https://www.taobao.com/   |    13 | CN      |</span><br><span class="line">|  4 | å¾®åš     | http://weibo.com/         |    20 | CN      |</span><br><span class="line">|  5 | Facebook | https://www.facebook.com/ |     3 | USA     |</span><br><span class="line">+<span class="comment">----+----------+---------------------------+-------+---------+</span></span><br><span class="line">4 rows in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line"><span class="comment">----æŸ¥çœ‹æ‰§è¡Œè®¡åˆ’</span></span><br><span class="line">mysql&gt; <span class="keyword">explain</span> <span class="keyword">select</span> * <span class="keyword">from</span> websites <span class="keyword">where</span> <span class="keyword">id</span> <span class="keyword">in</span> (<span class="keyword">select</span> site_id <span class="keyword">from</span> access_log);</span><br><span class="line">+<span class="comment">----+--------------+-------------+------------+--------+---------------+------------+---------+--------------------+------+----------+-------------+</span></span><br><span class="line">| id | select_type  | table       | partitions | type   | possible_keys | key        | key_len | ref                | rows | filtered | Extra       |</span><br><span class="line">+<span class="comment">----+--------------+-------------+------------+--------+---------------+------------+---------+--------------------+------+----------+-------------+</span></span><br><span class="line">|  1 | SIMPLE       | websites    | NULL       | ALL    | PRIMARY       | NULL       | NULL    | NULL               |    5 |   100.00 | Using where |</span><br><span class="line">|  1 | SIMPLE       | &lt;subquery2&gt; | NULL       | eq_ref | &lt;auto_key&gt;    | &lt;auto_key&gt; | 4       | runoob.websites.id |    1 |   100.00 | NULL        |</span><br><span class="line">|  2 | MATERIALIZED | access_log  | NULL       | ALL    | NULL          | NULL       | NULL    | NULL               |   12 |   100.00 | NULL        |</span><br><span class="line">+<span class="comment">----+--------------+-------------+------------+--------+---------------+------------+---------+--------------------+------+----------+-------------+</span></span><br><span class="line">3 rows in <span class="keyword">set</span>, <span class="number">1</span> <span class="keyword">warning</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line"><span class="comment">-------------------------------------------------------------</span></span><br><span class="line"><span class="comment">-------------------------------------------------------------</span></span><br><span class="line"></span><br><span class="line"><span class="comment">---- ä½¿ç”¨ exists</span></span><br><span class="line">mysql&gt; <span class="keyword">select</span> * <span class="keyword">from</span> websites <span class="keyword">where</span> <span class="keyword">exists</span> (<span class="keyword">select</span> <span class="number">1</span> <span class="keyword">from</span> access_log <span class="keyword">where</span> websites.id=access_log.site_id);</span><br><span class="line">+<span class="comment">----+----------+---------------------------+-------+---------+</span></span><br><span class="line">| id | name     | url                       | alexa | country |</span><br><span class="line">+<span class="comment">----+----------+---------------------------+-------+---------+</span></span><br><span class="line">|  1 | Google   | https://www.google.cm/    |     1 | USA     |</span><br><span class="line">|  2 | æ·˜å®     | https://www.taobao.com/   |    13 | CN      |</span><br><span class="line">|  4 | å¾®åš     | http://weibo.com/         |    20 | CN      |</span><br><span class="line">|  5 | Facebook | https://www.facebook.com/ |     3 | USA     |</span><br><span class="line">+<span class="comment">----+----------+---------------------------+-------+---------+</span></span><br><span class="line">4 rows in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line"><span class="comment">----æŸ¥çœ‹æ‰§è¡Œè®¡åˆ’</span></span><br><span class="line">mysql&gt; <span class="keyword">explain</span> <span class="keyword">select</span> * <span class="keyword">from</span> websites <span class="keyword">where</span> <span class="keyword">exists</span> (<span class="keyword">select</span> <span class="number">1</span> <span class="keyword">from</span> access_log <span class="keyword">where</span> websites.id=access_log.site_id);</span><br><span class="line">+<span class="comment">----+--------------------+------------+------------+------+---------------+------+---------+------+------+----------+-------------+</span></span><br><span class="line">| id | select_type        | table      | partitions | type | possible_keys | key  | key_len | ref  | rows | filtered | Extra       |</span><br><span class="line">+<span class="comment">----+--------------------+------------+------------+------+---------------+------+---------+------+------+----------+-------------+</span></span><br><span class="line">|  1 | PRIMARY            | websites   | NULL       | ALL  | NULL          | NULL | NULL    | NULL |    5 |   100.00 | Using where |</span><br><span class="line">|  2 | DEPENDENT SUBQUERY | access_log | NULL       | ALL  | NULL          | NULL | NULL    | NULL |   12 |    10.00 | Using where |</span><br><span class="line">+<span class="comment">----+--------------------+------------+------------+------+---------------+------+---------+------+------+----------+-------------+</span></span><br><span class="line">2 rows in <span class="keyword">set</span>, <span class="number">2</span> <span class="keyword">warnings</span> (<span class="number">0.01</span> sec)</span><br></pre></td></tr></table></figure><p>æ ¹æ®å°è¡¨é©±åŠ¨å¤§è¡¨çš„åŸåˆ™ï¼Œä¸Šé¢çš„ä¸¤ä¸ª <code>SQLè¯­å¥</code> ç¬¬äºŒä¸ªä½¿ç”¨ <code>exists</code> æ›´åˆé€‚</p>]]></content>
      
      
      <categories>
          
          <category> æ•°æ®åº“ </category>
          
          <category> MySQL </category>
          
      </categories>
      
      
        <tags>
            
            <tag> MySQL </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>MySQLä¼˜åŒ–ä¹‹ç´¢å¼•ä½¿ç”¨åŸåˆ™</title>
      <link href="/2019/08/25/MySQL%E4%BC%98%E5%8C%96%E4%B9%8B%E7%B4%A2%E5%BC%95%E4%BD%BF%E7%94%A8%E5%8E%9F%E5%88%99/"/>
      <url>/2019/08/25/MySQL%E4%BC%98%E5%8C%96%E4%B9%8B%E7%B4%A2%E5%BC%95%E4%BD%BF%E7%94%A8%E5%8E%9F%E5%88%99/</url>
      
        <content type="html"><![CDATA[<p><strong>å†™åœ¨å‰é¢</strong>: å‰é¢äº†è§£åˆ°ç´¢å¼•æ˜¯å¸®åŠ© <code>MySQL</code> é«˜æ•ˆè·å–æ•°æ®çš„æ•°æ®ç»“æ„ã€‚é‚£ä¹ˆåœ¨ä¸€ä¸ªæ•°æ®è¡¨æŸ¥è¯¢åº”ç”¨ä¸­ï¼Œæˆ‘ä»¬æ˜¯å¦åº”è¯¥ä½¿ç”¨ç´¢å¼•ï¼Ÿè¯¥æ€æ ·ä½¿ç”¨ç´¢å¼•ï¼Ÿä»€ä¹ˆåœºæ™¯ä¸‹ç´¢å¼•ä¼šå¤±æ•ˆï¼Ÿ</p><a id="more"></a><p><strong>æ•°æ®å‡†å¤‡</strong></p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- å»ºè¡¨è¯­å¥</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> staffs(</span><br><span class="line">    <span class="keyword">id</span> <span class="built_in">int</span> PRIMARY <span class="keyword">key</span> auto_increment,</span><br><span class="line">    <span class="keyword">name</span> <span class="built_in">varchar</span>(<span class="number">24</span>) <span class="keyword">not</span> <span class="literal">null</span> <span class="keyword">default</span> <span class="string">''</span> <span class="keyword">comment</span> <span class="string">'å§“å'</span>,</span><br><span class="line">    age <span class="built_in">int</span> <span class="keyword">not</span> <span class="literal">null</span> <span class="keyword">default</span> <span class="number">0</span> <span class="keyword">comment</span> <span class="string">'å¹´é¾„'</span>,</span><br><span class="line">    pos <span class="built_in">varchar</span>(<span class="number">20</span>) <span class="keyword">not</span> <span class="literal">null</span> <span class="keyword">default</span> <span class="string">''</span> <span class="keyword">comment</span> <span class="string">'èŒä½'</span>,</span><br><span class="line">    add_time <span class="built_in">timestamp</span> <span class="keyword">not</span> <span class="literal">null</span> <span class="keyword">default</span> <span class="keyword">current_timestamp</span> <span class="keyword">comment</span> <span class="string">'å…¥èŒæ—¶é—´'</span></span><br><span class="line">)<span class="keyword">default</span> <span class="built_in">character</span> <span class="keyword">set</span> utf8mb4 <span class="keyword">comment</span> <span class="string">'å‘˜å·¥è®°å½•è¡¨'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- æ•°æ®æ’å…¥</span></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> staffs(<span class="keyword">name</span>, age, pos, add_time)</span><br><span class="line"><span class="keyword">values</span></span><br><span class="line">(<span class="string">'z3'</span>, <span class="number">22</span>, <span class="string">'manager'</span>, <span class="keyword">now</span>()),</span><br><span class="line">(<span class="string">'July'</span>, <span class="number">23</span>, <span class="string">'dev'</span>, <span class="keyword">now</span>()),</span><br><span class="line">(<span class="string">'2000'</span>, <span class="number">23</span>, <span class="string">'dev'</span>, <span class="keyword">now</span>()),</span><br><span class="line">(<span class="string">'tom'</span>, <span class="number">2</span>, <span class="string">'pm'</span>, <span class="keyword">now</span>()),</span><br><span class="line">(<span class="string">'jerry'</span>, <span class="number">2</span>, <span class="string">'pm'</span>, <span class="keyword">now</span>());</span><br><span class="line"></span><br><span class="line"><span class="comment">-- å»ºç«‹ç»„åˆç´¢å¼•</span></span><br><span class="line">mysql&gt; create index idx_staffs_nameAgePos on staffs(name,age,pos);</span><br></pre></td></tr></table></figure><hr><h4 id="1-ç´¢å¼•ä½¿ç”¨åŸåˆ™"><a href="#1-ç´¢å¼•ä½¿ç”¨åŸåˆ™" class="headerlink" title="1: ç´¢å¼•ä½¿ç”¨åŸåˆ™"></a>1: ç´¢å¼•ä½¿ç”¨åŸåˆ™</h4><ul><li><p>1ï¼šå…¨å€¼åŒ¹é…æˆ‘æœ€çˆ±</p>  <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- ç»„åˆç´¢å¼•çš„æ‰€æœ‰å­—æ®µå…¨éƒ¨ä½¿ç”¨åˆ°ï¼Œå…¨å€¼åŒ¹é…</span></span><br><span class="line">mysql&gt; explain select * from staffs where name='July' and age=23 and pos='dev';</span><br><span class="line">+<span class="comment">----+-------------+--------+------------+------+-----------------------+-----------------------+---------+-------------------+------+----------+-------+</span></span><br><span class="line">| id | select_type | table  | partitions | type | possible_keys         | key                   | key_len | ref               | rows | filtered | Extra |</span><br><span class="line">+<span class="comment">----+-------------+--------+------------+------+-----------------------+-----------------------+---------+-------------------+------+----------+-------+</span></span><br><span class="line">|  1 | SIMPLE      | staffs | NULL       | ref  | idx_staffs_nameAgePos | idx_staffs_nameAgePos | 184     | const,const,const |    1 |   100.00 | NULL  |</span><br><span class="line">+<span class="comment">----+-------------+--------+------------+------+-----------------------+-----------------------+---------+-------------------+------+----------+-------+</span></span><br></pre></td></tr></table></figure></li><li><p>2ï¼šæœ€å·¦å‰ç¼€åŸåˆ™ã€å¸¦å¤´å¤§å“¥ä¸æ˜¯æ­»ï¼Œä¸­é—´å…„å¼ŸğŸ‘¬ä¸èƒ½æ–­ã€‘</p><blockquote><p>å¦‚æœä½¿ç”¨äº†ç»„åˆç´¢å¼•ï¼Œè¦éµå¾ªæœ€å·¦å‰ç¼€åŸåˆ™ï¼ŒæŸ¥è¯¢ä»ç´¢å¼•çš„æœ€å·¦å‰åˆ—å¼€å§‹å¹¶ä¸”ä¸èƒ½è·³è¿‡ç´¢å¼•ä¸­çš„åˆ—ã€‚</p></blockquote></li><li><p>3ï¼šä¸è¦åœ¨ç´¢å¼•åˆ—ä¸Šåšä»»ä½•æ“ä½œï¼ˆè®¡ç®—ï¼Œå‡½æ•°ï¼Œã€Œæ‰‹åŠ¨ | è‡ªåŠ¨ã€ç±»å‹è½¬æ¢ï¼‰ï¼Œä¼šå¯¼è‡´ç´¢å¼•å¤±æ•ˆè€Œè½¬å‘å…¨è¡¨æ‰«æã€ç´¢å¼•åˆ—ä¸Šå°‘è®¡ç®—ã€‘</p>  <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- ä½¿ç”¨åˆ°äº†left()å‡½æ•°</span></span><br><span class="line">mysql&gt; explain select * from staffs where left(name,4) = "July";</span><br><span class="line">+<span class="comment">----+-------------+--------+------------+------+---------------+------+---------+------+------+----------+-------------+</span></span><br><span class="line">| id | select_type | table  | partitions | type | possible_keys | key  | key_len | ref  | rows | filtered | Extra       |</span><br><span class="line">+<span class="comment">----+-------------+--------+------------+------+---------------+------+---------+------+------+----------+-------------+</span></span><br><span class="line">|  1 | SIMPLE      | staffs | NULL       | ALL  | NULL          | NULL | NULL    | NULL |    5 |   100.00 | Using where |</span><br><span class="line">+<span class="comment">----+-------------+--------+------------+------+---------------+------+---------+------+------+----------+-------------+</span></span><br><span class="line">1 row in <span class="keyword">set</span>, <span class="number">1</span> <span class="keyword">warning</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure></li><li><p>4ï¼šå­˜å‚¨å¼•æ“ä¸èƒ½ä½¿ç”¨ç´¢å¼•ä¸­ <strong>èŒƒå›´æ¡ä»¶(å¤§äºï¼Œå°äºâ€¦)</strong> å³è¾¹çš„åˆ—ã€èŒƒå›´ä¹‹åå…¨å¤±æ•ˆã€‘</p>  <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- ç»„åˆç´¢å¼•name,ageçš„éƒ¨åˆ†ç´¢å¼•è¢«ç”¨åˆ°</span></span><br><span class="line">mysql&gt; explain select * from staffs where name='July' and age&gt;20 and pos='dev';</span><br><span class="line">+<span class="comment">----+-------------+--------+------------+-------+-----------------------+-----------------------+---------+------+------+----------+-----------------------+</span></span><br><span class="line">| id | select_type | table  | partitions | type  | possible_keys         | key                   | key_len | ref  | rows | filtered | Extra                 |</span><br><span class="line">+<span class="comment">----+-------------+--------+------------+-------+-----------------------+-----------------------+---------+------+------+----------+-----------------------+</span></span><br><span class="line">|  1 | SIMPLE      | staffs | NULL       | range | idx_staffs_nameAgePos | idx_staffs_nameAgePos | 102     | NULL |    1 |    20.00 | Using index condition |</span><br><span class="line">+<span class="comment">----+-------------+--------+------------+-------+-----------------------+-----------------------+---------+------+------+----------+-----------------------+</span></span><br><span class="line">1 row in <span class="keyword">set</span>, <span class="number">1</span> <span class="keyword">warning</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure></li><li><p>5ï¼šå°½é‡ä½¿ç”¨è¦†ç›–ç´¢å¼•(æŸ¥è¯¢çš„åˆ—æ˜¯ç´¢å¼•çš„ä¸€éƒ¨åˆ†)ï¼Œå‡å°‘ <code>select *</code> ä½¿ç”¨</p>  <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- å…¨è¡¨æ‰«æ</span></span><br><span class="line">mysql&gt; explain select * from staffs;</span><br><span class="line">+<span class="comment">----+-------------+--------+------------+------+---------------+------+---------+------+------+----------+-------+</span></span><br><span class="line">| id | select_type | table  | partitions | type | possible_keys | key  | key_len | ref  | rows | filtered | Extra |</span><br><span class="line">+<span class="comment">----+-------------+--------+------------+------+---------------+------+---------+------+------+----------+-------+</span></span><br><span class="line">|  1 | SIMPLE      | staffs | NULL       | ALL  | NULL          | NULL | NULL    | NULL |    5 |   100.00 | NULL  |</span><br><span class="line">+<span class="comment">----+-------------+--------+------------+------+---------------+------+---------+------+------+----------+-------+</span></span><br><span class="line">1 row in <span class="keyword">set</span>, <span class="number">1</span> <span class="keyword">warning</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line"><span class="comment">-- Extra ä¸º Using index, ä½¿ç”¨åˆ°äº†è¦†ç›–ç´¢å¼•</span></span><br><span class="line">mysql&gt; <span class="keyword">explain</span> <span class="keyword">select</span> <span class="keyword">name</span>,age,pos <span class="keyword">from</span> staffs;</span><br><span class="line">+<span class="comment">----+-------------+--------+------------+-------+---------------+-----------------------+---------+------+------+----------+-------------+</span></span><br><span class="line">| id | select_type | table  | partitions | type  | possible_keys | key                   | key_len | ref  | rows | filtered | Extra       |</span><br><span class="line">+<span class="comment">----+-------------+--------+------------+-------+---------------+-----------------------+---------+------+------+----------+-------------+</span></span><br><span class="line">|  1 | SIMPLE      | staffs | NULL       | index | NULL          | idx_staffs_nameAgePos | 184     | NULL |    5 |   100.00 | Using index |</span><br><span class="line">+<span class="comment">----+-------------+--------+------------+-------+---------------+-----------------------+---------+------+------+----------+-------------+</span></span><br><span class="line">1 row in <span class="keyword">set</span>, <span class="number">1</span> <span class="keyword">warning</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line"><span class="comment">-- è¦†ç›–ç´¢å¼•</span></span><br><span class="line">mysql&gt; <span class="keyword">explain</span> <span class="keyword">select</span> <span class="keyword">name</span>,age,pos <span class="keyword">from</span> staffs <span class="keyword">where</span> <span class="keyword">name</span>=<span class="string">'July'</span> <span class="keyword">and</span> age=<span class="number">22</span> <span class="keyword">and</span> pos=<span class="string">'dev'</span>;</span><br><span class="line">+<span class="comment">----+-------------+--------+------------+------+-----------------------+-----------------------+---------+-------------------+------+----------+-------------+</span></span><br><span class="line">| id | select_type | table  | partitions | type | possible_keys         | key                   | key_len | ref               | rows | filtered | Extra       |</span><br><span class="line">+<span class="comment">----+-------------+--------+------------+------+-----------------------+-----------------------+---------+-------------------+------+----------+-------------+</span></span><br><span class="line">|  1 | SIMPLE      | staffs | NULL       | ref  | idx_staffs_nameAgePos | idx_staffs_nameAgePos | 184     | const,const,const |    1 |   100.00 | Using index |</span><br><span class="line">+<span class="comment">----+-------------+--------+------------+------+-----------------------+-----------------------+---------+-------------------+------+----------+-------------+</span></span><br><span class="line">1 row in <span class="keyword">set</span>, <span class="number">1</span> <span class="keyword">warning</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure></li><li><p>6ï¼šåœ¨ä¸ä½¿ç”¨è¦†ç›–ç´¢å¼•çš„æƒ…å†µä¸‹ï¼Œ<code>MySQL</code> åœ¨ä½¿ç”¨ä¸ç­‰äºè¿ç®—ç¬¦çš„æ—¶å€™æ— æ³•ä½¿ç”¨ç´¢å¼•ä¼šå¯¼è‡´å…¨è¡¨æ‰«æï¼Œ</p>  <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- è¿™é‡ŒæŸ¥è¯¢çš„åˆ—éƒ½æ˜¯ç´¢å¼•çš„åˆ—ï¼Œå› æ­¤ç”¨åˆ°äº†è¦†ç›–ç´¢å¼•</span></span><br><span class="line">mysql&gt; explain select name,age,pos from staffs where name != 'July';</span><br><span class="line">+<span class="comment">----+-------------+--------+------------+-------+-----------------------+-----------------------+---------+------+------+----------+--------------------------+</span></span><br><span class="line">| id | select_type | table  | partitions | type  | possible_keys         | key                   | key_len | ref  | rows | filtered | Extra                    |</span><br><span class="line">+<span class="comment">----+-------------+--------+------------+-------+-----------------------+-----------------------+---------+------+------+----------+--------------------------+</span></span><br><span class="line">|  1 | SIMPLE      | staffs | NULL       | range | idx_staffs_nameAgePos | idx_staffs_nameAgePos | 98      | NULL |    4 |   100.00 | Using where; Using index |</span><br><span class="line">+<span class="comment">----+-------------+--------+------------+-------+-----------------------+-----------------------+---------+------+------+----------+--------------------------+</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- ä½¿ç”¨äº†ä¸ç­‰è¿ç®—ï¼Œä¹Ÿæ²¡æœ‰ä½¿ç”¨åˆ°è¦†ç›–ç´¢å¼•ï¼Œå› æ­¤ä¼šå…¨è¡¨æ‰«æ</span></span><br><span class="line">mysql&gt; explain select * from staffs where name != 'July';</span><br><span class="line">+<span class="comment">----+-------------+--------+------------+------+-----------------------+------+---------+------+------+----------+-------------+</span></span><br><span class="line">| id | select_type | table  | partitions | type | possible_keys         | key  | key_len | ref  | rows | filtered | Extra       |</span><br><span class="line">+<span class="comment">----+-------------+--------+------------+------+-----------------------+------+---------+------+------+----------+-------------+</span></span><br><span class="line">|  1 | SIMPLE      | staffs | NULL       | ALL  | idx_staffs_nameAgePos | NULL | NULL    | NULL |    5 |    80.00 | Using where |</span><br><span class="line">+<span class="comment">----+-------------+--------+------------+------+-----------------------+------+---------+------+------+----------+-------------+</span></span><br></pre></td></tr></table></figure></li><li><p>7ï¼š<code>is null</code> æˆ–è€… <code>is not null</code> ä¹Ÿæ— æ³•ä½¿ç”¨ç´¢å¼•ï¼Œæ‰€ä»¥å»ºè¡¨æ—¶ä½¿ç”¨é»˜è®¤å€¼</p>  <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- type ä¸º all, Extra ä¸º Using where</span></span><br><span class="line">mysql&gt; explain select * from staffs where name is not null;</span><br><span class="line">+<span class="comment">----+-------------+--------+------------+------+-----------------------+------+---------+------+------+----------+-------------+</span></span><br><span class="line">| id | select_type | table  | partitions | type | possible_keys         | key  | key_len | ref  | rows | filtered | Extra       |</span><br><span class="line">+<span class="comment">----+-------------+--------+------------+------+-----------------------+------+---------+------+------+----------+-------------+</span></span><br><span class="line">|  1 | SIMPLE      | staffs | NULL       | ALL  | idx_staffs_nameAgePos | NULL | NULL    | NULL |    5 |    80.00 | Using where |</span><br><span class="line">+<span class="comment">----+-------------+--------+------------+------+-----------------------+------+---------+------+------+----------+-------------+</span></span><br><span class="line">1 row in <span class="keyword">set</span>, <span class="number">1</span> <span class="keyword">warning</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line"><span class="comment">-- type ä¸º null, Extra ä¸º Impossible WHERE</span></span><br><span class="line"><span class="comment">-- null è™½ç„¶æ— æ³•ä½¿ç”¨ç´¢å¼•ä½†æ˜¯ is null é€Ÿåº¦æ˜¯æœ€å¿«çš„â“</span></span><br><span class="line">mysql&gt; <span class="keyword">explain</span> <span class="keyword">select</span> * <span class="keyword">from</span> staffs <span class="keyword">where</span> <span class="keyword">name</span> <span class="keyword">is</span> <span class="literal">null</span>;</span><br><span class="line">+<span class="comment">----+-------------+-------+------------+------+---------------+------+---------+------+------+----------+------------------+</span></span><br><span class="line">| id | select_type | table | partitions | type | possible_keys | key  | key_len | ref  | rows | filtered | Extra            |</span><br><span class="line">+<span class="comment">----+-------------+-------+------------+------+---------------+------+---------+------+------+----------+------------------+</span></span><br><span class="line">|  1 | SIMPLE      | NULL  | NULL       | NULL | NULL          | NULL | NULL    | NULL | NULL |     NULL | Impossible WHERE |</span><br><span class="line">+<span class="comment">----+-------------+-------+------------+------+---------------+------+---------+------+------+----------+------------------+</span></span><br><span class="line">1 row in <span class="keyword">set</span>, <span class="number">1</span> <span class="keyword">warning</span> (<span class="number">0.02</span> sec)</span><br></pre></td></tr></table></figure></li><li><p>8ï¼š<code>like</code> ä»¥é€šé…ç¬¦ <code>%</code> å¼€å¤´ï¼ˆ<code>eg: like &#39;%abc&#39;</code>ï¼‰çš„SQLè¯­å¥ç´¢å¼•å¤±æ•ˆä¼šå˜æˆå…¨è¡¨æ‰«æ</p><blockquote><p>è§£å†³æ–¹æ¡ˆï¼šä½¿ç”¨è¦†ç›–ç´¢å¼•ä»£æ›¿å…¨è¡¨æ‰«æ</p></blockquote>  <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- ç´¢å¼•å¤±æ•ˆï¼Œå…¨è¡¨æ‰«æ</span></span><br><span class="line">mysql&gt; explain select * from staffs where name like '%July';</span><br><span class="line">+<span class="comment">----+-------------+--------+------------+------+---------------+------+---------+------+------+----------+-------------+</span></span><br><span class="line">| id | select_type | table  | partitions | type | possible_keys | key  | key_len | ref  | rows | filtered | Extra       |</span><br><span class="line">+<span class="comment">----+-------------+--------+------------+------+---------------+------+---------+------+------+----------+-------------+</span></span><br><span class="line">|  1 | SIMPLE      | staffs | NULL       | ALL  | NULL          | NULL | NULL    | NULL |    5 |    20.00 | Using where |</span><br><span class="line">+<span class="comment">----+-------------+--------+------------+------+---------------+------+---------+------+------+----------+-------------+</span></span><br><span class="line">1 row in <span class="keyword">set</span>, <span class="number">1</span> <span class="keyword">warning</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line"><span class="comment">-- ä½¿ç”¨éƒ¨åˆ†ç´¢å¼•</span></span><br><span class="line">mysql&gt; <span class="keyword">explain</span> <span class="keyword">select</span> * <span class="keyword">from</span> staffs <span class="keyword">where</span> <span class="keyword">name</span> <span class="keyword">like</span> <span class="string">'July%'</span>;</span><br><span class="line">+<span class="comment">----+-------------+--------+------------+-------+-----------------------+-----------------------+---------+------+------+----------+-----------------------+</span></span><br><span class="line">| id | select_type | table  | partitions | type  | possible_keys         | key                   | key_len | ref  | rows | filtered | Extra                 |</span><br><span class="line">+<span class="comment">----+-------------+--------+------------+-------+-----------------------+-----------------------+---------+------+------+----------+-----------------------+</span></span><br><span class="line">|  1 | SIMPLE      | staffs | NULL       | range | idx_staffs_nameAgePos | idx_staffs_nameAgePos | 98      | NULL |    1 |   100.00 | Using index condition |</span><br><span class="line">+<span class="comment">----+-------------+--------+------------+-------+-----------------------+-----------------------+---------+------+------+----------+-----------------------+</span></span><br><span class="line">1 row in <span class="keyword">set</span>, <span class="number">1</span> <span class="keyword">warning</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line"><span class="comment">-- ç´¢å¼• KEY `idx_test03_c1234` (`c1`,`c2`,`c3`,`c4`)</span></span><br><span class="line"><span class="comment">-- æ­¤æ—¶ç”¨åˆ°äº†ç»„åˆç´¢å¼•çš„å‰ä¸‰ä¸ªåˆ—ï¼Œc2 like 'a2%' ä¹Ÿæ˜¯ä¸€ç§èŒƒå›´æ ‡è¯†</span></span><br><span class="line">mysql&gt; <span class="keyword">explain</span> <span class="keyword">select</span> * <span class="keyword">from</span> test03 <span class="keyword">where</span> c1=<span class="string">'a1'</span>  <span class="keyword">and</span> c2 <span class="keyword">like</span> <span class="string">'a2%'</span>  <span class="keyword">and</span> c3=<span class="string">'a3'</span>;</span><br><span class="line">+<span class="comment">----+-------------+--------+------------+-------+------------------+------------------+---------+------+------+----------+-----------------------+</span></span><br><span class="line">| id | select_type | table  | partitions | type  | possible_keys    | key              | key_len | ref  | rows | filtered | Extra                 |</span><br><span class="line">+<span class="comment">----+-------------+--------+------------+-------+------------------+------------------+---------+------+------+----------+-----------------------+</span></span><br><span class="line">|  1 | SIMPLE      | test03 | NULL       | range | idx_test03_c1234 | idx_test03_c1234 | 123     | NULL |    1 |    16.67 | Using index condition |</span><br><span class="line">+<span class="comment">----+-------------+--------+------------+-------+------------------+------------------+---------+------+------+----------+-----------------------+</span></span><br><span class="line">1 row in <span class="keyword">set</span>, <span class="number">1</span> <span class="keyword">warning</span> (<span class="number">0.01</span> sec)</span><br></pre></td></tr></table></figure><blockquote><p>å‡è®¾ç´¢å¼•ä¸º index(a,b,c); è¯­å¥1ï¼šwhere a = 3 and b like â€˜aa%â€™ and c=4 èƒ½ç”¨åˆ°ç´¢å¼• a b cï¼›è¯­å¥2ï¼šwhere a = 3 and b like â€˜aa%bb%â€™ and c=4 ä¹Ÿèƒ½ç”¨åˆ°ç´¢å¼• a b cï¼›</p></blockquote></li><li><p>9ï¼š<strong>å­—ç¬¦ä¸²ä¸åŠ å•å¼•å·ç´¢å¼•ä¼šå¤±æ•ˆ</strong> ã€æ•°æ®ç±»å‹è¢«éšå¼è½¬æ¢ã€‘</p><blockquote><p>varchar ç±»å‹ ä½¿ç”¨æ—¶éœ€è¦åŠ ä¸Šå•å¼•å·ã€‚</p></blockquote>  <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- åŠ äº† å•å¼•å·ï¼Œå’Œå»ºè¡¨å­—æ®µå®šä¹‰ç±»å‹ä¸€è‡´</span></span><br><span class="line">mysql&gt; explain select * from staffs where name='2000';</span><br><span class="line">+<span class="comment">----+-------------+--------+------------+------+-----------------------+-----------------------+---------+-------+------+----------+-------+</span></span><br><span class="line">| id | select_type | table  | partitions | type | possible_keys         | key                   | key_len | ref   | rows | filtered | Extra |</span><br><span class="line">+<span class="comment">----+-------------+--------+------------+------+-----------------------+-----------------------+---------+-------+------+----------+-------+</span></span><br><span class="line">|  1 | SIMPLE      | staffs | NULL       | ref  | idx_staffs_nameAgePos | idx_staffs_nameAgePos | 98      | const |    1 |   100.00 | NULL  |</span><br><span class="line">+<span class="comment">----+-------------+--------+------------+------+-----------------------+-----------------------+---------+-------+------+----------+-------+</span></span><br><span class="line">1 row in <span class="keyword">set</span>, <span class="number">1</span> <span class="keyword">warning</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line"><span class="comment">-- å»ºè¡¨name å­—æ®µæ˜¯å­—ç¬¦ä¸²ç±»å‹ï¼Œç°åœ¨çš„æŸ¥è¯¢æ˜¯æ•°å€¼ç±»å‹ï¼Œç´¢å¼•å¤±æ•ˆ</span></span><br><span class="line">mysql&gt; <span class="keyword">explain</span> <span class="keyword">select</span> * <span class="keyword">from</span> staffs <span class="keyword">where</span> <span class="keyword">name</span>=<span class="number">2000</span>;</span><br><span class="line">+<span class="comment">----+-------------+--------+------------+------+-----------------------+------+---------+------+------+----------+-------------+</span></span><br><span class="line">| id | select_type | table  | partitions | type | possible_keys         | key  | key_len | ref  | rows | filtered | Extra       |</span><br><span class="line">+<span class="comment">----+-------------+--------+------------+------+-----------------------+------+---------+------+------+----------+-------------+</span></span><br><span class="line">|  1 | SIMPLE      | staffs | NULL       | ALL  | idx_staffs_nameAgePos | NULL | NULL    | NULL |    5 |    20.00 | Using where |</span><br><span class="line">+<span class="comment">----+-------------+--------+------------+------+-----------------------+------+---------+------+------+----------+-------------+</span></span><br><span class="line">1 row in <span class="keyword">set</span>, <span class="number">3</span> <span class="keyword">warnings</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure></li><li><p>10ï¼šå°½å¯èƒ½å°‘ç”¨ <code>or</code>ï¼Œç”¨å®ƒæ¥è¿æ¥æ—¶ç´¢å¼•ä¼šå¤±æ•ˆã€‚</p>  <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- å…¨è¡¨æ‰«æ</span></span><br><span class="line">mysql&gt; explain select * from staffs where name="July" or name = 'tom';</span><br><span class="line">+<span class="comment">----+-------------+--------+------------+------+-----------------------+------+---------+------+------+----------+-------------+</span></span><br><span class="line">| id | select_type | table  | partitions | type | possible_keys         | key  | key_len | ref  | rows | filtered | Extra       |</span><br><span class="line">+<span class="comment">----+-------------+--------+------------+------+-----------------------+------+---------+------+------+----------+-------------+</span></span><br><span class="line">|  1 | SIMPLE      | staffs | NULL       | ALL  | idx_staffs_nameAgePos | NULL | NULL    | NULL |    5 |    40.00 | Using where |</span><br><span class="line">+<span class="comment">----+-------------+--------+------------+------+-----------------------+------+---------+------+------+----------+-------------+</span></span><br></pre></td></tr></table></figure></li></ul><hr><h4 id="2-ç´¢å¼•ä½¿ç”¨ç¤ºä¾‹"><a href="#2-ç´¢å¼•ä½¿ç”¨ç¤ºä¾‹" class="headerlink" title="2: ç´¢å¼•ä½¿ç”¨ç¤ºä¾‹"></a>2: ç´¢å¼•ä½¿ç”¨ç¤ºä¾‹</h4><p><strong>æ•°æ®å‡†å¤‡</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- å»ºè¡¨</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> test03(</span><br><span class="line">    <span class="keyword">id</span> <span class="built_in">int</span> PRIMARY <span class="keyword">key</span> auto_increment,</span><br><span class="line">    c1 <span class="built_in">char</span>(<span class="number">10</span>),</span><br><span class="line">    c2 <span class="built_in">char</span>(<span class="number">10</span>),</span><br><span class="line">    c3 <span class="built_in">char</span>(<span class="number">10</span>),</span><br><span class="line">    c4 <span class="built_in">char</span>(<span class="number">10</span>),</span><br><span class="line">    c5 <span class="built_in">char</span>(<span class="number">10</span>)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- æ’å…¥æ•°æ®</span></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> test03(c1,c2,c3,c4,c5)</span><br><span class="line"><span class="keyword">values</span></span><br><span class="line">(<span class="string">'a1'</span>,<span class="string">'a2'</span>,<span class="string">'a3'</span>,<span class="string">'a4'</span>,<span class="string">'a5'</span>),</span><br><span class="line">(<span class="string">'b1'</span>,<span class="string">'b2'</span>,<span class="string">'b3'</span>,<span class="string">'b4'</span>,<span class="string">'b5'</span>),</span><br><span class="line">(<span class="string">'c1'</span>,<span class="string">'c2'</span>,<span class="string">'c3'</span>,<span class="string">'c4'</span>,<span class="string">'c5'</span>),</span><br><span class="line">(<span class="string">'d1'</span>,<span class="string">'d2'</span>,<span class="string">'d3'</span>,<span class="string">'d4'</span>,<span class="string">'d5'</span>),</span><br><span class="line">(<span class="string">'e1'</span>,<span class="string">'e2'</span>,<span class="string">'e3'</span>,<span class="string">'e4'</span>,<span class="string">'e5'</span>),</span><br><span class="line">(<span class="string">'f1'</span>,<span class="string">'f2'</span>,<span class="string">'f3'</span>,<span class="string">'f4'</span>,<span class="string">'f5'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- åˆ›å»ºç´¢å¼•</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">index</span> idx_test03_c1234 <span class="keyword">on</span> test03(c1,c2,c3,c4);</span><br></pre></td></tr></table></figure><ul><li><p>1ï¼šç´¢å¼•å…¨å€¼åŒ¹é…</p><blockquote><p>ä¾‹å¦‚ä¸€ä¸ªæ•°æ®è¡¨å»ºç«‹çš„ç»„åˆç´¢å¼• idx_table_c1c2c3c4, å½“æŸ¥è¯¢æ¡ä»¶ä¸º <code>where c3=&#39;c3&#39; and c2=&#39;c2&#39;  and c4=&#39;c4&#39; and c1=&#39;c1&#39;;</code> æ—¶æŸ¥è¯¢ä¼˜åŒ–å™¨ä¼šè‡ªåŠ¨è°ƒæ•´å’Œä¼˜åŒ–ï¼Œæ­¤æ—¶ç­‰ä»·äº <code>where c1=&#39;c1&#39; and c2=&#39;c2&#39;  and c4=&#39;c4&#39; and c3=&#39;c3&#39;;</code>ã€‚ä½†æ˜¯æœ€ä½³å®è·µæ˜¯æŒ‰ç…§ç´¢å¼•å»ºç«‹çš„é¡ºåºæ¥ä½¿ç”¨ï¼Œä»¥æ­¤æ¥å‡å°‘åº•å±‚ä¼˜åŒ–å™¨çš„å·¥ä½œé‡ã€‚</p></blockquote>  <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; explain select * from test03 where c1='c2'  and c2='c2' and c3='c3' and c4='c4';</span><br><span class="line">+<span class="comment">----+-------------+--------+------------+------+------------------+------------------+---------+-------------------------+------+----------+-------+</span></span><br><span class="line">| id | select_type | table  | partitions | type | possible_keys    | key              | key_len | ref                     | rows | filtered | Extra |</span><br><span class="line">+<span class="comment">----+-------------+--------+------------+------+------------------+------------------+---------+-------------------------+------+----------+-------+</span></span><br><span class="line">|  1 | SIMPLE      | test03 | NULL       | ref  | idx_test03_c1234 | idx_test03_c1234 | 164     | const,const,const,const |    1 |   100.00 | NULL  |</span><br><span class="line">+<span class="comment">----+-------------+--------+------------+------+------------------+------------------+---------+-------------------------+------+----------+-------+</span></span><br></pre></td></tr></table></figure>  <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- æ³¨æ„ç°åœ¨çš„æŸ¥è¯¢æ¡ä»¶where æ˜¯ c1, c2, c4, c3</span></span><br><span class="line">mysql&gt; explain select * from test03 where c1='c1' and c2='c2'  and c4='c4' and c3='c3';</span><br><span class="line">+<span class="comment">----+-------------+--------+------------+------+------------------+------------------+---------+-------------------------+------+----------+-------+</span></span><br><span class="line">| id | select_type | table  | partitions | type | possible_keys    | key              | key_len | ref                     | rows | filtered | Extra |</span><br><span class="line">+<span class="comment">----+-------------+--------+------------+------+------------------+------------------+---------+-------------------------+------+----------+-------+</span></span><br><span class="line">|  1 | SIMPLE      | test03 | NULL       | ref  | idx_test03_c1234 | idx_test03_c1234 | 164     | const,const,const,const |    1 |   100.00 | NULL  |</span><br><span class="line">+<span class="comment">----+-------------+--------+------------+------+------------------+------------------+---------+-------------------------+------+----------+-------+</span></span><br><span class="line">1 row in <span class="keyword">set</span>, <span class="number">1</span> <span class="keyword">warning</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line"><span class="comment">-- æ³¨æ„ç°åœ¨çš„æŸ¥è¯¢æ¡ä»¶where æ˜¯ c3, c2, c4, c1</span></span><br><span class="line">mysql&gt; <span class="keyword">explain</span> <span class="keyword">select</span> * <span class="keyword">from</span> test03 <span class="keyword">where</span> c3=<span class="string">'c3'</span> <span class="keyword">and</span> c2=<span class="string">'c2'</span>  <span class="keyword">and</span> c4=<span class="string">'c4'</span> <span class="keyword">and</span> c1=<span class="string">'c1'</span>;</span><br><span class="line">+<span class="comment">----+-------------+--------+------------+------+------------------+------------------+---------+-------------------------+------+----------+-------+</span></span><br><span class="line">| id | select_type | table  | partitions | type | possible_keys    | key              | key_len | ref                     | rows | filtered | Extra |</span><br><span class="line">+<span class="comment">----+-------------+--------+------------+------+------------------+------------------+---------+-------------------------+------+----------+-------+</span></span><br><span class="line">|  1 | SIMPLE      | test03 | NULL       | ref  | idx_test03_c1234 | idx_test03_c1234 | 164     | const,const,const,const |    1 |   100.00 | NULL  |</span><br><span class="line">+<span class="comment">----+-------------+--------+------------+------+------------------+------------------+---------+-------------------------+------+----------+-------+</span></span><br><span class="line">1 row in <span class="keyword">set</span>, <span class="number">1</span> <span class="keyword">warning</span> (<span class="number">0.03</span> sec)</span><br></pre></td></tr></table></figure></li><li><p>2ï¼šä½¿ç”¨åˆ°èŒƒå›´è¿ç®—ç¬¦æ—¶</p></li></ul><pre><code><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- ä½¿ç”¨åˆ°ç»„åˆç´¢å¼•çš„å‰3ä¸ªç´¢å¼•    </span></span><br><span class="line">mysql&gt; explain select * from test03 where c1='c2'  and c2='c2' and c3&gt;='c3' and c4='c4';</span><br><span class="line">+<span class="comment">----+-------------+--------+------------+-------+------------------+------------------+---------+------+------+----------+-----------------------+</span></span><br><span class="line">| id | select_type | table  | partitions | type  | possible_keys    | key              | key_len | ref  | rows | filtered | Extra                 |</span><br><span class="line">+<span class="comment">----+-------------+--------+------------+-------+------------------+------------------+---------+------+------+----------+-----------------------+</span></span><br><span class="line">|  1 | SIMPLE      | test03 | NULL       | range | idx_test03_c1234 | idx_test03_c1234 | 164     | NULL |    1 |    16.67 | Using index condition |</span><br><span class="line">+<span class="comment">----+-------------+--------+------------+-------+------------------+------------------+---------+------+------+----------+-----------------------+</span></span><br><span class="line">1 row in <span class="keyword">set</span>, <span class="number">1</span> <span class="keyword">warning</span> (<span class="number">0.01</span> sec)</span><br><span class="line"></span><br><span class="line"><span class="comment">-- ç”¨åˆ°äº†å››ä¸ªç´¢å¼•</span></span><br><span class="line">mysql&gt; <span class="keyword">explain</span> <span class="keyword">select</span> * <span class="keyword">from</span> test03 <span class="keyword">where</span> c1=<span class="string">'c2'</span>  <span class="keyword">and</span> c2=<span class="string">'c2'</span> <span class="keyword">and</span> c3=<span class="string">'c3'</span> <span class="keyword">and</span> c4&gt;=<span class="string">'c4'</span>;</span><br><span class="line">+<span class="comment">----+-------------+--------+------------+-------+------------------+------------------+---------+------+------+----------+-----------------------+</span></span><br><span class="line">| id | select_type | table  | partitions | type  | possible_keys    | key              | key_len | ref  | rows | filtered | Extra                 |</span><br><span class="line">+<span class="comment">----+-------------+--------+------------+-------+------------------+------------------+---------+------+------+----------+-----------------------+</span></span><br><span class="line">|  1 | SIMPLE      | test03 | NULL       | range | idx_test03_c1234 | idx_test03_c1234 | 164     | NULL |    1 |   100.00 | Using index condition |</span><br><span class="line">+<span class="comment">----+-------------+--------+------------+-------+------------------+------------------+---------+------+------+----------+-----------------------+</span></span><br><span class="line">1 row in <span class="keyword">set</span>, <span class="number">1</span> <span class="keyword">warning</span> (<span class="number">0.01</span> sec)</span><br></pre></td></tr></table></figure></code></pre><ul><li><p>3ï¼šä½¿ç”¨ <code>order by</code> æ—¶</p>  <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- ä½¿ç”¨åˆ°ç»„åˆç´¢å¼•çš„å‰ä¸‰ä¸ªï¼Œc3çš„ä½œç”¨æ˜¯æ’åºï¼Œåªæ˜¯æ²¡æœ‰ä¸‹é¢çš„æŸ¥æ‰¾ä¸­</span></span><br><span class="line">mysql&gt; explain select * from test03 where c1='c2'  and c2='c2' and c4='c4' order by c3;</span><br><span class="line">+<span class="comment">----+-------------+--------+------------+------+------------------+------------------+---------+-------------+------+----------+-----------------------+</span></span><br><span class="line">| id | select_type | table  | partitions | type | possible_keys    | key              | key_len | ref         | rows | filtered | Extra                 |</span><br><span class="line">+<span class="comment">----+-------------+--------+------------+------+------------------+------------------+---------+-------------+------+----------+-----------------------+</span></span><br><span class="line">|  1 | SIMPLE      | test03 | NULL       | ref  | idx_test03_c1234 | idx_test03_c1234 | 82      | const,const |    1 |    16.67 | Using index condition |</span><br><span class="line">+<span class="comment">----+-------------+--------+------------+------+------------------+------------------+---------+-------------+------+----------+-----------------------+</span></span><br><span class="line">1 row in <span class="keyword">set</span>, <span class="number">1</span> <span class="keyword">warning</span> (<span class="number">0.01</span> sec)</span><br><span class="line"></span><br><span class="line"><span class="comment">-- å’Œä¸Šä¸€ä¸ªæ‰§è¡Œè®¡åˆ’ä¸€è‡´</span></span><br><span class="line">mysql&gt; <span class="keyword">explain</span> <span class="keyword">select</span> * <span class="keyword">from</span> test03 <span class="keyword">where</span> c1=<span class="string">'c2'</span>  <span class="keyword">and</span> c2=<span class="string">'c2'</span> <span class="keyword">order</span> <span class="keyword">by</span> c3;</span><br><span class="line">+<span class="comment">----+-------------+--------+------------+------+------------------+------------------+---------+-------------+------+----------+-----------------------+</span></span><br><span class="line">| id | select_type | table  | partitions | type | possible_keys    | key              | key_len | ref         | rows | filtered | Extra                 |</span><br><span class="line">+<span class="comment">----+-------------+--------+------------+------+------------------+------------------+---------+-------------+------+----------+-----------------------+</span></span><br><span class="line">|  1 | SIMPLE      | test03 | NULL       | ref  | idx_test03_c1234 | idx_test03_c1234 | 82      | const,const |    1 |   100.00 | Using index condition |</span><br><span class="line">+<span class="comment">----+-------------+--------+------------+------+------------------+------------------+---------+-------------+------+----------+-----------------------+</span></span><br><span class="line">1 row in <span class="keyword">set</span>, <span class="number">1</span> <span class="keyword">warning</span> (<span class="number">0.01</span> sec)</span><br><span class="line"></span><br><span class="line"><span class="comment">-- æ­¤æ—¶åªä¼šä½¿ç”¨åˆ°ä¸¤ä¸ªç´¢å¼•ï¼Œç„¶åC4æ¡ä»¶æ²¡ä½¿ç”¨åˆ°ç´¢å¼•ï¼Œä½¿ç”¨åˆ°äº†æ–‡ä»¶å†…æ’åº Using filesort</span></span><br><span class="line">mysql&gt; <span class="keyword">explain</span> <span class="keyword">select</span> * <span class="keyword">from</span> test03 <span class="keyword">where</span> c1=<span class="string">'c2'</span>  <span class="keyword">and</span> c2=<span class="string">'c2'</span> <span class="keyword">order</span> <span class="keyword">by</span> c4;</span><br><span class="line">+<span class="comment">----+-------------+--------+------------+------+------------------+------------------+---------+-------------+------+----------+---------------------------------------+</span></span><br><span class="line">| id | select_type | table  | partitions | type | possible_keys    | key              | key_len | ref         | rows | filtered | Extra                                 |</span><br><span class="line">+<span class="comment">----+-------------+--------+------------+------+------------------+------------------+---------+-------------+------+----------+---------------------------------------+</span></span><br><span class="line">|  1 | SIMPLE      | test03 | NULL       | ref  | idx_test03_c1234 | idx_test03_c1234 | 82      | const,const |    1 |   100.00 | Using index condition; Using filesort |</span><br><span class="line">+<span class="comment">----+-------------+--------+------------+------+------------------+------------------+---------+-------------+------+----------+---------------------------------------+</span></span><br><span class="line">1 row in <span class="keyword">set</span>, <span class="number">1</span> <span class="keyword">warning</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line"><span class="comment">-- æŸ¥æ‰¾ç”¨åˆ°äº†ä¸€ä¸ªç´¢å¼•ï¼Œæ’åºç”¨åˆ°äº† c2,c3, æ­¤æ—¶æ—  Using filesort</span></span><br><span class="line">mysql&gt; <span class="keyword">explain</span> <span class="keyword">select</span> * <span class="keyword">from</span> test03 <span class="keyword">where</span> c1=<span class="string">'c1'</span>  <span class="keyword">and</span> c5=<span class="string">'c5'</span> <span class="keyword">order</span> <span class="keyword">by</span> c2,c3;</span><br><span class="line">+<span class="comment">----+-------------+--------+------------+------+------------------+------------------+---------+-------+------+----------+------------------------------------+</span></span><br><span class="line">| id | select_type | table  | partitions | type | possible_keys    | key              | key_len | ref   | rows | filtered | Extra                              |</span><br><span class="line">+<span class="comment">----+-------------+--------+------------+------+------------------+------------------+---------+-------+------+----------+------------------------------------+</span></span><br><span class="line">|  1 | SIMPLE      | test03 | NULL       | ref  | idx_test03_c1234 | idx_test03_c1234 | 41      | const |    1 |    16.67 | Using index condition; Using where |</span><br><span class="line">+<span class="comment">----+-------------+--------+------------+------+------------------+------------------+---------+-------+------+----------+------------------------------------+</span></span><br><span class="line">1 row in <span class="keyword">set</span>, <span class="number">1</span> <span class="keyword">warning</span> (<span class="number">0.01</span> sec)</span><br><span class="line"></span><br><span class="line"><span class="comment">-- ä½¿ç”¨åˆ°äº†ç»„åˆç´¢å¼•çš„c1, ç”±äºorder by çš„é¡ºåºæ²¡æŒ‰ç…§ç»„åˆç´¢å¼•é¡ºåºæ¥ï¼Œå› æ­¤å‡ºç°äº† Using filesort</span></span><br><span class="line">mysql&gt; <span class="keyword">explain</span> <span class="keyword">select</span> * <span class="keyword">from</span> test03 <span class="keyword">where</span> c1=<span class="string">'c1'</span>  <span class="keyword">and</span> c5=<span class="string">'c5'</span> <span class="keyword">order</span> <span class="keyword">by</span> c3,c2;</span><br><span class="line">+<span class="comment">----+-------------+--------+------------+------+------------------+------------------+---------+-------+------+----------+----------------------------------------------------+</span></span><br><span class="line">| id | select_type | table  | partitions | type | possible_keys    | key              | key_len | ref   | rows | filtered | Extra                                              |</span><br><span class="line">+<span class="comment">----+-------------+--------+------------+------+------------------+------------------+---------+-------+------+----------+----------------------------------------------------+</span></span><br><span class="line">|  1 | SIMPLE      | test03 | NULL       | ref  | idx_test03_c1234 | idx_test03_c1234 | 41      | const |    1 |    16.67 | Using index condition; Using where; Using filesort |</span><br><span class="line">+<span class="comment">----+-------------+--------+------------+------+------------------+------------------+---------+-------+------+----------+----------------------------------------------------+</span></span><br><span class="line">1 row in <span class="keyword">set</span>, <span class="number">1</span> <span class="keyword">warning</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line"><span class="comment">-- ç´¢å¼•ç”¨åˆ°äº† c1ï¼Œc2, æ’åºç”¨åˆ°äº†c2,c3</span></span><br><span class="line">mysql&gt; <span class="keyword">explain</span> <span class="keyword">select</span> * <span class="keyword">from</span> test03 <span class="keyword">where</span> c1=<span class="string">'c1'</span>  <span class="keyword">and</span> c2=<span class="string">'c2'</span> <span class="keyword">order</span> <span class="keyword">by</span> c2,c3;</span><br><span class="line">+<span class="comment">----+-------------+--------+------------+------+------------------+------------------+---------+-------------+------+----------+-----------------------+</span></span><br><span class="line">| id | select_type | table  | partitions | type | possible_keys    | key              | key_len | ref         | rows | filtered | Extra                 |</span><br><span class="line">+<span class="comment">----+-------------+--------+------------+------+------------------+------------------+---------+-------------+------+----------+-----------------------+</span></span><br><span class="line">|  1 | SIMPLE      | test03 | NULL       | ref  | idx_test03_c1234 | idx_test03_c1234 | 82      | const,const |    1 |   100.00 | Using index condition |</span><br><span class="line">+<span class="comment">----+-------------+--------+------------+------+------------------+------------------+---------+-------------+------+----------+-----------------------+</span></span><br><span class="line">1 row in <span class="keyword">set</span>, <span class="number">1</span> <span class="keyword">warning</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line"><span class="comment">-- æŸ¥æ‰¾ç”¨åˆ°äº†ç»„åˆç´¢å¼•çš„c1,c2, æ­¤æ—¶çš„æŸ¥è¯¢æ¡ä»¶ä¸­c2å€¼æ˜¯ä¸€ä¸ªå¸¸é‡ï¼Œorder by åçš„c2 ä¸ºä¸€ä¸ªå¸¸é‡ï¼ˆå›ºå®šå€¼ï¼‰ï¼Œæ­¤æ—¶å¯¹c2æ˜¯å¦æ’åºå¯¹æ•´ä¸ªsqlæ— å½±å“ã€‚  </span></span><br><span class="line">mysql&gt; <span class="keyword">explain</span> <span class="keyword">select</span> * <span class="keyword">from</span> test03 <span class="keyword">where</span> c1=<span class="string">'c1'</span>  <span class="keyword">and</span> c2=<span class="string">'c2'</span> <span class="keyword">and</span> c5=<span class="string">'c5'</span> <span class="keyword">order</span> <span class="keyword">by</span> c3,c2;</span><br><span class="line">+<span class="comment">----+-------------+--------+------------+------+------------------+------------------+---------+-------------+------+----------+------------------------------------+</span></span><br><span class="line">| id | select_type | table  | partitions | type | possible_keys    | key              | key_len | ref         | rows | filtered | Extra                              |</span><br><span class="line">+<span class="comment">----+-------------+--------+------------+------+------------------+------------------+---------+-------------+------+----------+------------------------------------+</span></span><br><span class="line">|  1 | SIMPLE      | test03 | NULL       | ref  | idx_test03_c1234 | idx_test03_c1234 | 82      | const,const |    1 |    16.67 | Using index condition; Using where |</span><br><span class="line">+<span class="comment">----+-------------+--------+------------+------+------------------+------------------+---------+-------------+------+----------+------------------------------------+</span></span><br><span class="line">1 row in <span class="keyword">set</span>, <span class="number">1</span> <span class="keyword">warning</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line"><span class="comment">-- ç”¨åˆ°äº†ä¸€ä¸ªç´¢å¼•</span></span><br><span class="line">mysql&gt; <span class="keyword">explain</span> <span class="keyword">select</span> c1,c2,c3 <span class="keyword">from</span> test03 <span class="keyword">where</span> c1=<span class="string">'a1'</span>  <span class="keyword">and</span> c4=<span class="string">'a4'</span> <span class="keyword">group</span> <span class="keyword">by</span> c2,c3;</span><br><span class="line">+<span class="comment">----+-------------+--------+------------+------+------------------+------------------+---------+-------+------+----------+--------------------------+</span></span><br><span class="line">| id | select_type | table  | partitions | type | possible_keys    | key              | key_len | ref   | rows | filtered | Extra                    |</span><br><span class="line">+<span class="comment">----+-------------+--------+------------+------+------------------+------------------+---------+-------+------+----------+--------------------------+</span></span><br><span class="line">|  1 | SIMPLE      | test03 | NULL       | ref  | idx_test03_c1234 | idx_test03_c1234 | 41      | const |    1 |    16.67 | Using where; Using index |</span><br><span class="line">+<span class="comment">----+-------------+--------+------------+------+------------------+------------------+---------+-------+------+----------+--------------------------+</span></span><br><span class="line">1 row in <span class="keyword">set</span>, <span class="number">1</span> <span class="keyword">warning</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line"><span class="comment">-- å‡ºç°äº†æ–‡ä»¶æ’åºï¼Œä½¿ç”¨åˆ°äº†ä¸´æ—¶è¡¨ ,</span></span><br><span class="line">mysql&gt; <span class="keyword">explain</span> <span class="keyword">select</span> c1,c2,c3 <span class="keyword">from</span> test03 <span class="keyword">where</span> c1=<span class="string">'a1'</span>  <span class="keyword">and</span> c4=<span class="string">'a4'</span> <span class="keyword">group</span> <span class="keyword">by</span> c3,c2;</span><br><span class="line">+<span class="comment">----+-------------+--------+------------+------+------------------+------------------+---------+-------+------+----------+-----------------------------------------------------------+</span></span><br><span class="line">| id | select_type | table  | partitions | type | possible_keys    | key              | key_len | ref   | rows | filtered | Extra                                                     |</span><br><span class="line">+<span class="comment">----+-------------+--------+------------+------+------------------+------------------+---------+-------+------+----------+-----------------------------------------------------------+</span></span><br><span class="line">|  1 | SIMPLE      | test03 | NULL       | ref  | idx_test03_c1234 | idx_test03_c1234 | 41      | const |    1 |    16.67 | Using where; Using index; Using temporary; Using filesort |</span><br><span class="line">+<span class="comment">----+-------------+--------+------------+------+------------------+------------------+---------+-------+------+----------+-----------------------------------------------------------+</span></span><br><span class="line">1 row in <span class="keyword">set</span>, <span class="number">1</span> <span class="keyword">warning</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line"><span class="comment">-- é’ˆå¯¹ä¸Šä¸€ä¸ªæ‰§è¡Œè®¡åˆ’ä¼˜åŒ–å¦‚ä¸‹æ–°å¢ c2 = 'a2'</span></span><br><span class="line">mysql&gt; <span class="keyword">explain</span> <span class="keyword">select</span> c1,c2,c3 <span class="keyword">from</span> test03 <span class="keyword">where</span> c1=<span class="string">'a1'</span>  <span class="keyword">and</span> c2=<span class="string">'a2'</span>  <span class="keyword">and</span> c4=<span class="string">'a4'</span> <span class="keyword">group</span> <span class="keyword">by</span> c3,c2;</span><br><span class="line">+<span class="comment">----+-------------+--------+------------+------+------------------+------------------+---------+-------------+------+----------+--------------------------+</span></span><br><span class="line">| id | select_type | table  | partitions | type | possible_keys    | key              | key_len | ref         | rows | filtered | Extra                    |</span><br><span class="line">+<span class="comment">----+-------------+--------+------------+------+------------------+------------------+---------+-------------+------+----------+--------------------------+</span></span><br><span class="line">|  1 | SIMPLE      | test03 | NULL       | ref  | idx_test03_c1234 | idx_test03_c1234 | 82      | const,const |    1 |    16.67 | Using where; Using index |</span><br><span class="line">+<span class="comment">----+-------------+--------+------------+------+------------------+------------------+---------+-------------+------+----------+--------------------------+</span></span><br><span class="line">1 row in <span class="keyword">set</span>, <span class="number">1</span> <span class="keyword">warning</span> (<span class="number">0.01</span> sec)</span><br><span class="line"></span><br><span class="line"><span class="comment">-- group by åŸºæœ¬ä¸Šéƒ½éœ€è¦æ’åºï¼Œä¼šæœ‰ä¸´æ—¶è¡¨äº§ç”Ÿã€‚</span></span><br></pre></td></tr></table></figure></li></ul><hr><h4 id="3-ç´¢å¼•ä½¿ç”¨çš„ä¸€èˆ¬æ€§å»ºè®®"><a href="#3-ç´¢å¼•ä½¿ç”¨çš„ä¸€èˆ¬æ€§å»ºè®®" class="headerlink" title="3: ç´¢å¼•ä½¿ç”¨çš„ä¸€èˆ¬æ€§å»ºè®®"></a>3: ç´¢å¼•ä½¿ç”¨çš„ä¸€èˆ¬æ€§å»ºè®®</h4><ul><li><p>å¯¹äºå•å€¼ç´¢å¼•ï¼Œå°½é‡é€‰æ‹©é’ˆå¯¹å½“å‰æŸ¥è¯¢ <strong>è¿‡æ»¤æ€§æ›´å¥½</strong> çš„ç´¢å¼•</p></li><li><p>åœ¨é€‰ç”¨ç»„åˆç´¢å¼•çš„æ—¶å€™ï¼Œå½“å‰æŸ¥è¯¢ä¸­ï¼Œ<strong>è¿‡æ»¤æ€§æœ€å¥½ï¼ˆè¶Šå¥½ï¼‰</strong> çš„å­—æ®µåœ¨ç»„åˆç´¢å¼•å­—æ®µé¡ºåºä¸­ï¼Œ<strong>ä½ç½®è¶Šé å‰è¶Šå¥½</strong></p></li><li><p>åœ¨é€‰æ‹©ç»„åˆç´¢å¼•çš„æ—¶å€™ï¼Œå°½é‡é€‰æ‹©èƒ½å¤ŸåŒ…å«å½“å‰æŸ¥è¯¢çš„ <code>where</code> å­—å¥ä¸­æ›´å¤šå­—æ®µçš„ç´¢å¼•ã€‚</p></li><li><p>å°½å¯èƒ½é€šè¿‡åˆ†æç»Ÿè®¡ä¿¡æ¯å’Œè°ƒæ•´ <code>query</code> çš„å†™æ³•æ¥è¾¾åˆ°é€‰æ‹©é€‚åˆç´¢å¼•çš„ç›®çš„</p></li></ul>]]></content>
      
      
      <categories>
          
          <category> æ•°æ®åº“ </category>
          
          <category> MySQL </category>
          
      </categories>
      
      
        <tags>
            
            <tag> MySQL </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>MySQLæ€§èƒ½ä¼˜åŒ–ä¹‹Explainç´¢å¼•ä¼˜åŒ–å®ä¾‹</title>
      <link href="/2019/08/24/MySQL%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E4%B9%8B%E9%80%9A%E8%BF%87Explain%E8%BF%9B%E8%A1%8C%E7%B4%A2%E5%BC%95%E4%BC%98%E5%8C%96/"/>
      <url>/2019/08/24/MySQL%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E4%B9%8B%E9%80%9A%E8%BF%87Explain%E8%BF%9B%E8%A1%8C%E7%B4%A2%E5%BC%95%E4%BC%98%E5%8C%96/</url>
      
        <content type="html"><![CDATA[<p><strong>å†™åœ¨å‰é¢</strong>: å‰é¢äº†è§£ <code>Explain</code> çš„åŸºç¡€çŸ¥è¯†ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬é€šè¿‡å¥½ä¸€äº›æ¡ˆåˆ—æ¥å®æ“ä¸€ä¸‹ï¼Œé€šè¿‡å®è·µåŠ æ·±å¯¹å‰é¢ä¸¤ç¯‡ç¬”è®°çš„äº†è§£ã€‚</p><a id="more"></a><hr><h4 id="æ¡ˆä¾‹ä¸€"><a href="#æ¡ˆä¾‹ä¸€" class="headerlink" title="æ¡ˆä¾‹ä¸€"></a>æ¡ˆä¾‹ä¸€</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">exlain <span class="keyword">select</span> d1.name, (<span class="keyword">select</span> <span class="keyword">id</span> <span class="keyword">from</span> t3) d2</span><br><span class="line"><span class="keyword">from</span> (<span class="keyword">select</span> <span class="keyword">id</span>, <span class="keyword">name</span> <span class="keyword">from</span> t1 <span class="keyword">where</span> other_colume = <span class="string">''</span>) d1</span><br><span class="line"><span class="keyword">union</span></span><br><span class="line">(<span class="keyword">select</span> <span class="keyword">name</span>, <span class="keyword">id</span> <span class="keyword">from</span> t2);</span><br></pre></td></tr></table></figure><p>ä¾æ® explain ä¸­ <code>id</code>å€¼å¯çŸ¥æ‰§è¡Œå…ˆåé¡ºåºåˆ†åˆ«æ˜¯ <strong>4 &gt; 3 &gt; 2 &gt; 1 &gt; NULL</strong>ã€‚è¯´æ˜å¦‚ä¸‹</p><p><img src="/images/blog/201908/7-explain%E6%89%A7%E8%A1%8C%E6%A1%88%E4%BE%8B%E4%B8%80.png" alt></p><blockquote><p>æ‰§è¡Œé¡ºåº1ï¼ˆidä¸º4ï¼‰: select_typeä¸º<code>UNION</code>ï¼Œæ‰§è¡Œçš„SQLä¸º<code>select name, id from t2</code></p></blockquote><blockquote><p>æ‰§è¡Œé¡ºåº2ï¼ˆidä¸º3ï¼‰: select_typeä¸º<code>DERIVED</code>ï¼Œç”±äºSQLæŸ¥è¯¢è§£ææ—¶æ˜¯ä»<code>from</code>å¼€å§‹ï¼Œåé¢ç´§æ¥ç€çš„sqlæŸ¥è¯¢è¯­å¥åˆåŒ…å«åœ¨<code>from</code>ä¸­ï¼Œå› æ­¤select_typeä¸º<code>DERIVED</code>ã€‚æ‰§è¡ŒSQLä¸º<code>select id, name from t1 where other_colume = &#39;&#39;</code></p></blockquote><blockquote><p>æ‰§è¡Œé¡ºåº3ï¼ˆidä¸º2ï¼‰: select_typeä¸º<code>SUBQUERY</code>ï¼Œæ‰§è¡Œçš„SQLä¸º<code>select id from t3</code></p></blockquote><blockquote><p>æ‰§è¡Œé¡ºåº4ï¼ˆidä¸º1ï¼‰: select_typeåˆ—å€¼ä¸º<code>PRIMARY</code>è¡¨ç¤ºè¯¥æŸ¥è¯¢ä¸ºå¤–å±‚æŸ¥è¯¢ï¼Œtableåˆ—æ ‡è¯†ä¸º<code>&lt;derived3&gt;</code>è¡¨ç¤ºæŸ¥è¯¢çš„ç»“æœæ¥è‡ªäºä¸€ä¸ªè¡ç”Ÿè¡¨ï¼Œ<code>&lt;derived3&gt;</code>ä¸­çš„3è¡¨ç¤ºè¯¥æŸ¥è¯¢è¡ç”Ÿè‡ªç¬¬<code>idä¸º3</code>çš„æŸ¥è¯¢ã€‚</p></blockquote><blockquote><p>æ‰§è¡Œé¡ºåº4ï¼ˆidä¸º1ï¼‰: select_typeåˆ—å€¼ä¸º<code>UNION RESULT</code>è¡¨ç¤ºä»ä¸´æ—¶æŸ¥è¯¢ç»“æœé›†ä¸­è¯»å–è¡Œï¼Œtableåˆ—å€¼ä¸º<code>&lt;union 1,4&gt;</code> è¡¨ç¤ºå¯¹idä¸º1å’Œ4çš„ä¸¤ä¸ªselectç»“æœè¿›è¡Œ<code>UNION</code>æ“ä½œã€‚</p></blockquote><hr><h4 id="æ¡ˆä¾‹äºŒ-ä¹‹-å•è¡¨ä¼˜åŒ–"><a href="#æ¡ˆä¾‹äºŒ-ä¹‹-å•è¡¨ä¼˜åŒ–" class="headerlink" title="æ¡ˆä¾‹äºŒ ä¹‹ å•è¡¨ä¼˜åŒ–"></a>æ¡ˆä¾‹äºŒ ä¹‹ å•è¡¨ä¼˜åŒ–</h4><p>æ•°æ®å‡†å¤‡</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- å»ºè¡¨è¯­å¥</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> article(</span><br><span class="line">    <span class="keyword">id</span> <span class="built_in">int</span>(<span class="number">10</span>) <span class="keyword">unsigned</span> <span class="keyword">not</span> <span class="literal">null</span> PRIMARY <span class="keyword">key</span> auto_increment,</span><br><span class="line">    author_id <span class="built_in">int</span>(<span class="number">10</span>) <span class="keyword">unsigned</span> <span class="keyword">not</span> <span class="literal">null</span> <span class="keyword">comment</span> <span class="string">'ä½œè€…id'</span>,</span><br><span class="line">    category_id <span class="built_in">int</span>(<span class="number">10</span>) <span class="keyword">unsigned</span> <span class="keyword">not</span> <span class="literal">null</span> <span class="keyword">comment</span> <span class="string">'åˆ†ç±»id'</span>,</span><br><span class="line">    views <span class="built_in">int</span>(<span class="number">10</span>) <span class="keyword">unsigned</span> <span class="keyword">not</span> <span class="literal">null</span> <span class="keyword">comment</span> <span class="string">'æŸ¥çœ‹æ¬¡æ•°'</span>,</span><br><span class="line">    comments <span class="built_in">int</span>(<span class="number">10</span>) <span class="keyword">unsigned</span> <span class="keyword">not</span> <span class="literal">null</span> <span class="keyword">comment</span> <span class="string">'è¯„è®ºæ¬¡æ•°'</span>,</span><br><span class="line">    title <span class="built_in">varchar</span>(<span class="number">255</span>) <span class="keyword">not</span> <span class="literal">null</span> <span class="keyword">comment</span> <span class="string">'æ–‡ç« æ ‡é¢˜'</span>,</span><br><span class="line">    <span class="keyword">content</span> <span class="built_in">text</span> <span class="keyword">not</span> <span class="literal">null</span> <span class="keyword">comment</span> <span class="string">'å†…å®¹'</span></span><br><span class="line">)<span class="keyword">default</span> <span class="built_in">character</span> <span class="keyword">set</span> utf8mb4;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- æ•°æ®æ’å…¥</span></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> article(author_id, category_id, views, comments, title, <span class="keyword">content</span>)</span><br><span class="line"><span class="keyword">values</span></span><br><span class="line">(<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="string">'æ ‡é¢˜1'</span>,<span class="string">'å†…å®¹1'</span>),</span><br><span class="line">(<span class="number">2</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="string">'æ ‡é¢˜2'</span>,<span class="string">'å†…å®¹2'</span>),</span><br><span class="line">(<span class="number">3</span>,<span class="number">3</span>,<span class="number">3</span>,<span class="number">3</span>,<span class="string">'æ ‡é¢˜3'</span>,<span class="string">'å†…å®¹3'</span>),</span><br><span class="line">(<span class="number">4</span>,<span class="number">4</span>,<span class="number">4</span>,<span class="number">4</span>,<span class="string">'æ ‡é¢˜4'</span>,<span class="string">'å†…å®¹4'</span>),</span><br><span class="line">(<span class="number">5</span>,<span class="number">5</span>,<span class="number">5</span>,<span class="number">5</span>,<span class="string">'æ ‡é¢˜5'</span>,<span class="string">'å†…å®¹5'</span>),</span><br><span class="line">(<span class="number">6</span>,<span class="number">6</span>,<span class="number">6</span>,<span class="number">6</span>,<span class="string">'æ ‡é¢˜6'</span>,<span class="string">'å†…å®¹6'</span>);</span><br></pre></td></tr></table></figure><ul><li><p>æŸ¥è¯¢ category_id ä¸º1 ä¸” comments å¤§äº1æƒ…å†µä¸‹, views æœ€å¤šçš„article_id</p>  <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- æŸ¥è¯¢sql</span></span><br><span class="line">mysql&gt; select id,author_id from article where category_id=1 and comments&gt;1 order by views desc limit 1;</span><br><span class="line">+<span class="comment">----+-----------+</span></span><br><span class="line">| id | author_id |</span><br><span class="line">+<span class="comment">----+-----------+</span></span><br><span class="line">|  3 |         1 |</span><br><span class="line">+<span class="comment">----+-----------+</span></span><br><span class="line">1 row in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line"><span class="comment">--æŸ¥çœ‹æ‰§è¡Œè®¡åˆ’ï¼Œå¾—åˆ°å¦‚ä¸‹å¯ä¼˜åŒ–ç‚¹</span></span><br><span class="line"><span class="comment">---- 1ï¼štype ä¸º ALL å…¨è¡¨æ‰«æï¼›</span></span><br><span class="line"><span class="comment">---- 2ï¼šExtra å‡ºç°äº† Using filesort</span></span><br><span class="line">mysql&gt; <span class="keyword">explain</span> <span class="keyword">select</span> <span class="keyword">id</span>,author_id <span class="keyword">from</span> article <span class="keyword">where</span> category_id=<span class="number">1</span> <span class="keyword">and</span> comments&gt;<span class="number">1</span> <span class="keyword">order</span> <span class="keyword">by</span> views <span class="keyword">desc</span> <span class="keyword">limit</span> <span class="number">1</span>;</span><br><span class="line">+<span class="comment">----+-------------+---------+------------+------+---------------+------+---------+------+------+----------+-----------------------------+</span></span><br><span class="line">| id | select_type | table   | partitions | type | possible_keys | key  | key_len | ref  | rows | filtered | Extra                       |</span><br><span class="line">+<span class="comment">----+-------------+---------+------------+------+---------------+------+---------+------+------+----------+-----------------------------+</span></span><br><span class="line">|  1 | SIMPLE      | article | NULL       | ALL  | NULL          | NULL | NULL    | NULL |    6 |    16.67 | Using where; Using filesort |</span><br><span class="line">+<span class="comment">----+-------------+---------+------------+------+---------------+------+---------+------+------+----------+-----------------------------+</span></span><br><span class="line">1 row in <span class="keyword">set</span>, <span class="number">1</span> <span class="keyword">warning</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line"><span class="comment">-- å°è¯•ä¼˜åŒ–</span></span><br><span class="line"><span class="comment">---- æ ¹æ®æŸ¥è¯¢æ¡ä»¶å»ºç«‹ç»„åˆç´¢å¼•ï¼š</span></span><br><span class="line">mysql&gt; <span class="keyword">create</span> <span class="keyword">index</span> idx_article_ccv <span class="keyword">on</span> article(category_id,comments,views);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- æŸ¥çœ‹åˆšå»ºçš„ç´¢å¼•</span></span><br><span class="line">mysql&gt; show index from article;</span><br><span class="line">+<span class="comment">---------+------------+-----------------+--------------+-------------+-----------+-------------+----------+--------+------+------------+---------+---------------+</span></span><br><span class="line">| Table   | Non_unique | Key_name        | Seq_in_index | Column_name | Collation | Cardinality | Sub_part | Packed | Null | Index_type | <span class="keyword">Comment</span> | Index_comment |</span><br><span class="line">+<span class="comment">---------+------------+-----------------+--------------+-------------+-----------+-------------+----------+--------+------+------------+---------+---------------+</span></span><br><span class="line">| article |          <span class="number">0</span> | PRIMARY         |            <span class="number">1</span> | <span class="keyword">id</span>          | A         |           <span class="number">6</span> |     <span class="literal">NULL</span> | <span class="literal">NULL</span>   |      | BTREE      |         |               |</span><br><span class="line">| article |          <span class="number">1</span> | idx_article_ccv |            <span class="number">1</span> | category_id | A         |           <span class="number">5</span> |     <span class="literal">NULL</span> | <span class="literal">NULL</span>   |      | BTREE      |         |               |</span><br><span class="line">| article |          <span class="number">1</span> | idx_article_ccv |            <span class="number">2</span> | comments    | A         |           <span class="number">6</span> |     <span class="literal">NULL</span> | <span class="literal">NULL</span>   |      | BTREE      |         |               |</span><br><span class="line">| article |          <span class="number">1</span> | idx_article_ccv |            <span class="number">3</span> | views       | A         |           <span class="number">6</span> |     <span class="literal">NULL</span> | <span class="literal">NULL</span>   |      | BTREE      |         |               |</span><br><span class="line">+<span class="comment">---------+------------+-----------------+--------------+-------------+-----------+-------------+----------+--------+------+------------+---------+---------------+</span></span><br><span class="line"><span class="number">4</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.02</span> sec)</span><br><span class="line"></span><br><span class="line"><span class="comment">-- å†æ¬¡æ‰§è¡Œåˆšæ‰çš„æŸ¥è¯¢SQL</span></span><br><span class="line"><span class="comment">---- 1: type ç”± ALL å˜æˆäº† range</span></span><br><span class="line"><span class="comment">---- 2: Extra è¿˜æ˜¯å‡ºç°äº† Using filesort, //çœ‹æ¥è¿˜å¾—ä¼˜åŒ–</span></span><br><span class="line"><span class="comment">---- 3: MySQL æ— æ³•å†å¯¹åé¢ view éƒ¨åˆ†è¿›è¡Œæ£€ç´¢ï¼Œå³æ˜¯range ç±»å‹æŸ¥è¯¢å­—æ®µåé¢çš„å­—æ®µæ— æ•ˆ</span></span><br><span class="line">mysql&gt; <span class="keyword">explain</span> <span class="keyword">select</span> <span class="keyword">id</span>,author_id <span class="keyword">from</span> article <span class="keyword">where</span> category_id=<span class="number">1</span> <span class="keyword">and</span> comments&gt;<span class="number">1</span> <span class="keyword">order</span> <span class="keyword">by</span> views <span class="keyword">desc</span> <span class="keyword">limit</span> <span class="number">1</span>;</span><br><span class="line">+<span class="comment">----+-------------+---------+------------+-------+-----------------+-----------------+---------+------+------+----------+---------------------------------------+</span></span><br><span class="line">| id | select_type | table   | partitions | type  | possible_keys   | key             | key_len | ref  | rows | filtered | Extra                                 |</span><br><span class="line">+<span class="comment">----+-------------+---------+------------+-------+-----------------+-----------------+---------+------+------+----------+---------------------------------------+</span></span><br><span class="line">|  1 | SIMPLE      | article | NULL       | range | idx_article_ccv | idx_article_ccv | 8       | NULL |    1 |   100.00 | Using index condition; Using filesort |</span><br><span class="line">+<span class="comment">----+-------------+---------+------------+-------+-----------------+-----------------+---------+------+------+----------+---------------------------------------+</span></span><br><span class="line">1 row in <span class="keyword">set</span>, <span class="number">1</span> <span class="keyword">warning</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line"><span class="comment">-- åˆ é™¤ä¹‹å‰æ‰€å»ºç«‹çš„ç´¢å¼•</span></span><br><span class="line">mysql&gt; <span class="keyword">drop</span> <span class="keyword">index</span> idx_article_ccv <span class="keyword">on</span> article;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- å†æ¬¡å°è¯•å»ºç«‹ç´¢å¼•</span></span><br><span class="line"><span class="comment">---- æ ¹æ®æŸ¥è¯¢æ¡ä»¶å»ºç«‹ç»„åˆç´¢å¼•ï¼Œè¿™æ¬¡å»æ‰ comments</span></span><br><span class="line">mysql&gt; create index idx_article_cv on article(category_id,views);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- å†æ¬¡æŸ¥è¯¢æ‰§è¡Œè®¡åˆ’</span></span><br><span class="line"><span class="comment">---- type å˜ä¸ºäº†ref</span></span><br><span class="line"><span class="comment">---- ref  å˜ä¸ºle const</span></span><br><span class="line"><span class="comment">---- Extra æ²¡æœ‰ Using filesort</span></span><br><span class="line">mysql&gt; explain select id,author_id from article where category_id=1 and comments&gt;1 order by views desc limit 1;</span><br><span class="line">+<span class="comment">----+-------------+---------+------------+------+----------------+----------------+---------+-------+------+----------+-------------+</span></span><br><span class="line">| id | select_type | table   | partitions | type | possible_keys  | key            | key_len | ref   | rows | filtered | Extra       |</span><br><span class="line">+<span class="comment">----+-------------+---------+------------+------+----------------+----------------+---------+-------+------+----------+-------------+</span></span><br><span class="line">|  1 | SIMPLE      | article | NULL       | ref  | idx_article_cv | idx_article_cv | 4       | const |    2 |    33.33 | Using where |</span><br><span class="line">+<span class="comment">----+-------------+---------+------------+------+----------------+----------------+---------+-------+------+----------+-------------+</span></span><br><span class="line">1 row in <span class="keyword">set</span>, <span class="number">1</span> <span class="keyword">warning</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure></li></ul><hr><h4 id="æ¡ˆä¾‹ä¸‰-ä¹‹-åŒè¡¨ä¼˜åŒ–"><a href="#æ¡ˆä¾‹ä¸‰-ä¹‹-åŒè¡¨ä¼˜åŒ–" class="headerlink" title="æ¡ˆä¾‹ä¸‰ ä¹‹ åŒè¡¨ä¼˜åŒ–"></a>æ¡ˆä¾‹ä¸‰ ä¹‹ åŒè¡¨ä¼˜åŒ–</h4><p>æ•°æ®å‡†å¤‡</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- å»ºè¡¨è¯­å¥</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> <span class="keyword">class</span> (</span><br><span class="line">    <span class="keyword">id</span> <span class="built_in">int</span>(<span class="number">10</span>) <span class="keyword">unsigned</span> <span class="keyword">not</span> <span class="literal">null</span> PRIMARY <span class="keyword">key</span> auto_increment,</span><br><span class="line">    card <span class="built_in">int</span>(<span class="number">10</span>) <span class="keyword">unsigned</span> <span class="keyword">not</span> <span class="literal">null</span> <span class="keyword">comment</span> <span class="string">'åˆ†ç±»id'</span></span><br><span class="line">)<span class="keyword">default</span> <span class="built_in">character</span> <span class="keyword">set</span> utf8mb4;</span><br><span class="line"></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> book (</span><br><span class="line">    bookid <span class="built_in">int</span>(<span class="number">10</span>) <span class="keyword">unsigned</span> <span class="keyword">not</span> <span class="literal">null</span> PRIMARY <span class="keyword">key</span> auto_increment,</span><br><span class="line">    card <span class="built_in">int</span>(<span class="number">10</span>) <span class="keyword">unsigned</span> <span class="keyword">not</span> <span class="literal">null</span> <span class="keyword">comment</span> <span class="string">'åˆ†ç±»id'</span></span><br><span class="line">)<span class="keyword">default</span> <span class="built_in">character</span> <span class="keyword">set</span> utf8mb4;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- æ•°æ®æ’å…¥</span></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> <span class="keyword">class</span>(<span class="keyword">id</span>,card)</span><br><span class="line"><span class="keyword">values</span></span><br><span class="line">(<span class="number">1</span>,<span class="number">10</span>),(<span class="number">2</span>,<span class="number">7</span>),(<span class="number">3</span>,<span class="number">3</span>),(<span class="number">4</span>,<span class="number">13</span>),(<span class="number">5</span>,<span class="number">17</span>),</span><br><span class="line">(<span class="number">6</span>,<span class="number">4</span>),(<span class="number">7</span>,<span class="number">9</span>),(<span class="number">8</span>,<span class="number">13</span>),(<span class="number">9</span>,<span class="number">19</span>),(<span class="number">10</span>,<span class="number">16</span>),</span><br><span class="line">(<span class="number">11</span>,<span class="number">20</span>),(<span class="number">12</span>,<span class="number">13</span>),(<span class="number">13</span>,<span class="number">3</span>),(<span class="number">14</span>,<span class="number">15</span>),(<span class="number">15</span>,<span class="number">5</span>),</span><br><span class="line">(<span class="number">16</span>,<span class="number">20</span>),(<span class="number">17</span>,<span class="number">6</span>),(<span class="number">18</span>,<span class="number">9</span>),(<span class="number">19</span>,<span class="number">6</span>),(<span class="number">20</span>,<span class="number">4</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- æ•°æ®æ’å…¥</span></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> book(bookid,card)</span><br><span class="line"><span class="keyword">values</span></span><br><span class="line">(<span class="number">1</span>,<span class="number">2</span>),(<span class="number">2</span>,<span class="number">18</span>),(<span class="number">3</span>,<span class="number">3</span>),(<span class="number">4</span>,<span class="number">2</span>),(<span class="number">5</span>,<span class="number">20</span>),</span><br><span class="line">(<span class="number">6</span>,<span class="number">15</span>),(<span class="number">7</span>,<span class="number">11</span>),(<span class="number">8</span>,<span class="number">13</span>),(<span class="number">9</span>,<span class="number">8</span>),(<span class="number">10</span>,<span class="number">4</span>),</span><br><span class="line">(<span class="number">11</span>,<span class="number">13</span>),(<span class="number">12</span>,<span class="number">14</span>),(<span class="number">13</span>,<span class="number">10</span>),(<span class="number">14</span>,<span class="number">7</span>),(<span class="number">15</span>,<span class="number">3</span>),</span><br><span class="line">(<span class="number">16</span>,<span class="number">16</span>),(<span class="number">17</span>,<span class="number">10</span>),(<span class="number">18</span>,<span class="number">3</span>),(<span class="number">19</span>,<span class="number">5</span>),(<span class="number">20</span>,<span class="number">14</span>);</span><br><span class="line"></span><br><span class="line">mysql&gt; explain select * from class left join book on class.card=book.card;</span><br><span class="line">+<span class="comment">----+-------------+-------+------------+------+---------------+------+---------+------+------+----------+----------------------------------------------------+</span></span><br><span class="line">| id | select_type | table | partitions | type | possible_keys | key  | key_len | ref  | rows | filtered | Extra                                              |</span><br><span class="line">+<span class="comment">----+-------------+-------+------------+------+---------------+------+---------+------+------+----------+----------------------------------------------------+</span></span><br><span class="line">|  1 | SIMPLE      | class | NULL       | ALL  | NULL          | NULL | NULL    | NULL |   20 |   100.00 | NULL                                               |</span><br><span class="line">|  1 | SIMPLE      | book  | NULL       | ALL  | NULL          | NULL | NULL    | NULL |   20 |   100.00 | Using where; Using join buffer (Block Nested Loop) |</span><br><span class="line">+<span class="comment">----+-------------+-------+------------+------+---------------+------+---------+------+------+----------+----------------------------------------------------+</span></span><br><span class="line">2 rows in <span class="keyword">set</span>, <span class="number">1</span> <span class="keyword">warning</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line"><span class="comment">-- å…ˆå‡è®¾ç»™class çš„cardåŠ ç´¢å¼•</span></span><br><span class="line"></span><br><span class="line">mysql&gt; <span class="keyword">create</span> <span class="keyword">index</span> idx_card <span class="keyword">on</span> <span class="keyword">class</span>(card);</span><br><span class="line"></span><br><span class="line">mysql&gt; explain select * from class left join book on class.card=book.card and class.id&gt;0;</span><br><span class="line">+<span class="comment">----+-------------+-------+------------+-------+---------------+----------+---------+------+------+----------+----------------------------------------------------+</span></span><br><span class="line">| id | select_type | table | partitions | type  | possible_keys | key      | key_len | ref  | rows | filtered | Extra                                              |</span><br><span class="line">+<span class="comment">----+-------------+-------+------------+-------+---------------+----------+---------+------+------+----------+----------------------------------------------------+</span></span><br><span class="line">|  1 | SIMPLE      | class | NULL       | index | NULL          | idx_card | 4       | NULL |   20 |   100.00 | Using index                                        |</span><br><span class="line">|  1 | SIMPLE      | book  | NULL       | ALL   | NULL          | NULL     | NULL    | NULL |   20 |   100.00 | Using where; Using join buffer (Block Nested Loop) |</span><br><span class="line">+<span class="comment">----+-------------+-------+------------+-------+---------------+----------+---------+------+------+----------+----------------------------------------------------+</span></span><br><span class="line">2 rows in <span class="keyword">set</span>, <span class="number">1</span> <span class="keyword">warning</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line"><span class="comment">-- åˆ é™¤ idx_card ç„¶ååœ¨ bookè¡¨ä¸ŠåŠ ç´¢å¼•è¯•è¯•</span></span><br><span class="line">mysql&gt; <span class="keyword">alter</span> <span class="keyword">table</span> <span class="keyword">class</span> <span class="keyword">drop</span> <span class="keyword">index</span> idx_card;</span><br><span class="line">mysql&gt; create index idx_card on book(card);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- æŸ¥çœ‹ä¸€ä¸‹æ‰§è¡Œè®¡åˆ’</span></span><br><span class="line"><span class="comment">-- å¯¹æ¯”ä¸Šä¸€ä¸ªæ‰§è¡Œè®¡åˆ’ï¼Œtype ç”± ALL å˜ä¸ºäº† refï¼Œrefåˆ—å€¼æŒ‡å‘runoob.class.cardï¼Œrows ç”± 20 + 20å˜ä¸º 20+1</span></span><br><span class="line">mysql&gt; explain select * from class left join book on book.card=class.card;</span><br><span class="line">+<span class="comment">----+-------------+-------+------------+------+---------------+----------+---------+-------------------+------+----------+-------------+</span></span><br><span class="line">| id | select_type | table | partitions | type | possible_keys | key      | key_len | ref               | rows | filtered | Extra       |</span><br><span class="line">+<span class="comment">----+-------------+-------+------------+------+---------------+----------+---------+-------------------+------+----------+-------------+</span></span><br><span class="line">|  1 | SIMPLE      | class | NULL       | ALL  | NULL          | NULL     | NULL    | NULL              |   20 |   100.00 | NULL        |</span><br><span class="line">|  1 | SIMPLE      | book  | NULL       | ref  | idx_card      | idx_card | 4       | runoob.class.card |    1 |   100.00 | Using index |</span><br><span class="line">+<span class="comment">----+-------------+-------+------------+------+---------------+----------+---------+-------------------+------+----------+-------------+</span></span><br><span class="line">2 rows in <span class="keyword">set</span>, <span class="number">1</span> <span class="keyword">warning</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line"><span class="comment">-- ä½¿ç”¨å³é“¾æ¥æŸ¥è¯¢æ—¶</span></span><br><span class="line">mysql&gt; <span class="keyword">create</span> <span class="keyword">index</span> idx_card <span class="keyword">on</span> book(card);</span><br><span class="line"></span><br><span class="line">mysql&gt; explain select * from book right join class on book.card=class.card;</span><br><span class="line">+<span class="comment">----+-------------+-------+------------+------+---------------+----------+---------+-------------------+------+----------+-------------+</span></span><br><span class="line">| id | select_type | table | partitions | type | possible_keys | key      | key_len | ref               | rows | filtered | Extra       |</span><br><span class="line">+<span class="comment">----+-------------+-------+------------+------+---------------+----------+---------+-------------------+------+----------+-------------+</span></span><br><span class="line">|  1 | SIMPLE      | class | NULL       | ALL  | NULL          | NULL     | NULL    | NULL              |   20 |   100.00 | NULL        |</span><br><span class="line">|  1 | SIMPLE      | book  | NULL       | ref  | idx_card      | idx_card | 4       | runoob.class.card |    1 |   100.00 | Using index |</span><br><span class="line">+<span class="comment">----+-------------+-------+------------+------+---------------+----------+---------+-------------------+------+----------+-------------+</span></span><br><span class="line">2 rows in <span class="keyword">set</span>, <span class="number">1</span> <span class="keyword">warning</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure><p>ç»“è®ºï¼šLeft join æ¡ä»¶ç”¨äºç¡®å®šå¦‚ä½•ä» <strong>å³è¡¨</strong> æœç´¢è¡Œï¼ˆå› ä¸ºå·¦è¡¨éƒ½æ˜¯åŒ¹é…çš„ï¼‰ï¼Œæ‰€ä»¥å³è¡¨ä¸€å®šè¦å»ºç«‹ç´¢å¼•ã€‚æ¢å¥è¯è¯´ â€œå·¦è¿æ¥å› ä¸ºä¸»è¡¨å¿…å®šå…¨éƒ¨æ‰«æï¼Œå­è¡¨ä¸ä¸€å®šå…¨éƒ¨å¯¹åº”ï¼Œæ‰€ä»¥åŠ åœ¨å­è¡¨å¥½ä¸€äº›â€ã€‚</p><p><img src="https://www.runoob.com/wp-content/uploads/2019/01/sql-join.png" alt></p><hr><h4 id="æ¡ˆä¾‹ä¸‰-ä¹‹-ä¸‰è¡¨ä¼˜åŒ–"><a href="#æ¡ˆä¾‹ä¸‰-ä¹‹-ä¸‰è¡¨ä¼˜åŒ–" class="headerlink" title="æ¡ˆä¾‹ä¸‰ ä¹‹ ä¸‰è¡¨ä¼˜åŒ–"></a>æ¡ˆä¾‹ä¸‰ ä¹‹ ä¸‰è¡¨ä¼˜åŒ–</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- å»ºè¡¨è¯­å¥</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> phone (</span><br><span class="line">    phoneid <span class="built_in">int</span>(<span class="number">10</span>) <span class="keyword">unsigned</span> <span class="keyword">not</span> <span class="literal">null</span> PRIMARY <span class="keyword">key</span> auto_increment,</span><br><span class="line">    card <span class="built_in">int</span>(<span class="number">10</span>) <span class="keyword">unsigned</span> <span class="keyword">not</span> <span class="literal">null</span> <span class="keyword">comment</span> <span class="string">'åˆ†ç±»id'</span></span><br><span class="line">)<span class="keyword">default</span> <span class="built_in">character</span> <span class="keyword">set</span> utf8mb4;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- æ•°æ®æ’å…¥</span></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> phone(phoneid,card)</span><br><span class="line"><span class="keyword">values</span></span><br><span class="line">(<span class="number">1</span>,<span class="number">16</span>),(<span class="number">2</span>,<span class="number">17</span>),(<span class="number">3</span>,<span class="number">17</span>),(<span class="number">4</span>,<span class="number">14</span>),(<span class="number">5</span>,<span class="number">16</span>),</span><br><span class="line">(<span class="number">6</span>,<span class="number">20</span>),(<span class="number">7</span>,<span class="number">11</span>),(<span class="number">8</span>,<span class="number">15</span>),(<span class="number">9</span>,<span class="number">3</span>),(<span class="number">10</span>,<span class="number">7</span>),</span><br><span class="line">(<span class="number">11</span>,<span class="number">5</span>),(<span class="number">12</span>,<span class="number">5</span>),(<span class="number">13</span>,<span class="number">7</span>),(<span class="number">14</span>,<span class="number">3</span>),(<span class="number">15</span>,<span class="number">11</span>),</span><br><span class="line">(<span class="number">16</span>,<span class="number">4</span>),(<span class="number">17</span>,<span class="number">9</span>),(<span class="number">18</span>,<span class="number">12</span>),(<span class="number">19</span>,<span class="number">13</span>),(<span class="number">20</span>,<span class="number">8</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">---------------------------------------</span></span><br><span class="line"><span class="comment">-- æŸ¥çœ‹åŸå§‹æ‰§è¡Œè®¡åˆ’</span></span><br><span class="line">mysql&gt; explain select * from class left join book on class.card = book.card left join phone on class.card = phone.card;</span><br><span class="line">+<span class="comment">----+-------------+-------+------------+------+---------------+------+---------+------+------+----------+----------------------------------------------------+</span></span><br><span class="line">| id | select_type | table | partitions | type | possible_keys | key  | key_len | ref  | rows | filtered | Extra                                              |</span><br><span class="line">+<span class="comment">----+-------------+-------+------------+------+---------------+------+---------+------+------+----------+----------------------------------------------------+</span></span><br><span class="line">|  1 | SIMPLE      | class | NULL       | ALL  | NULL          | NULL | NULL    | NULL |   20 |   100.00 | NULL                                               |</span><br><span class="line">|  1 | SIMPLE      | book  | NULL       | ALL  | NULL          | NULL | NULL    | NULL |   20 |   100.00 | Using where; Using join buffer (Block Nested Loop) |</span><br><span class="line">|  1 | SIMPLE      | phone | NULL       | ALL  | NULL          | NULL | NULL    | NULL |   20 |   100.00 | Using where; Using join buffer (Block Nested Loop) |</span><br><span class="line">+<span class="comment">----+-------------+-------+------------+------+---------------+------+---------+------+------+----------+----------------------------------------------------+</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- æ ¹æ®æ¡ˆä¾‹äºŒçš„ç»éªŒå¢åŠ å¦‚ä¸‹ç´¢å¼•</span></span><br><span class="line"></span><br><span class="line">mysql&gt; create index idx_b_card on book(card);</span><br><span class="line"></span><br><span class="line">mysql&gt; create index idx_p_card on phone(card);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- æŸ¥è¯¢å¢åŠ ç´¢å¼•åçš„æ‰§è¡Œè®¡åˆ’</span></span><br><span class="line"></span><br><span class="line"><span class="comment">---- æœ€åä¸¤ä¸ªtype å‡æ˜¯ ref, rows = 20 + 1 + 1</span></span><br><span class="line"></span><br><span class="line">mysql&gt; explain select * from class left join book on class.card = book.card left join phone on class.card = phone.card;</span><br><span class="line">+<span class="comment">----+-------------+-------+------------+------+---------------+------------+---------+-------------------+------+----------+-------------+</span></span><br><span class="line">| id | select_type | table | partitions | type | possible_keys | key        | key_len | ref               | rows | filtered | Extra       |</span><br><span class="line">+<span class="comment">----+-------------+-------+------------+------+---------------+------------+---------+-------------------+------+----------+-------------+</span></span><br><span class="line">|  1 | SIMPLE      | class | NULL       | ALL  | NULL          | NULL       | NULL    | NULL              |   20 |   100.00 | NULL        |</span><br><span class="line">|  1 | SIMPLE      | book  | NULL       | ref  | idx_b_card    | idx_b_card | 4       | runoob.class.card |    1 |   100.00 | Using index |</span><br><span class="line">|  1 | SIMPLE      | phone | NULL       | ref  | idx_p_card    | idx_p_card | 4       | runoob.class.card |    1 |   100.00 | Using index |</span><br><span class="line">+<span class="comment">----+-------------+-------+------------+------+---------------+------------+---------+-------------------+------+----------+-------------+</span></span><br><span class="line">3 rows in <span class="keyword">set</span>, <span class="number">1</span> <span class="keyword">warning</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure><hr><p>ã€SQL ä¼˜åŒ–ç»“è®ºã€‘</p><ul><li><p>å°½å¯èƒ½å‡å°‘ Join è¯­å¥ä¸­çš„ <code>Nested Loop</code> (åµŒå¥—å¾ªç¯)ã€‚</p></li><li><p>ä¼˜å…ˆ <code>Nested Loop</code> ä¸­çš„å†…å±‚å¾ª</p></li><li><p>æ°¸è¿œç”¨å°ç»“æœé›†é©±åŠ¨å¤§çš„ç»“æœé›†ã€‚</p></li><li><p>å½“æ— æ³•ä¿è¯è¢«é©±åŠ¨è¡¨çš„ Join æ¡ä»¶å­—æ®µè¢«ç´¢å¼•ä¸”å†…å­˜èµ„æºå……è¶³çš„å‰æä¸‹ï¼Œä¸è¦å¤ªåå•¬ <code>JoinBuffer</code> è®¾ç½®</p></li></ul><hr><p><a href="https://www.bilibili.com/video/av49181542/?p=208" target="_blank" rel="noopener">å‚è€ƒæ¥æºï¼šbilibili.MySQLé«˜çº§_explainä¹‹çƒ­èº«Case</a></p>]]></content>
      
      
      <categories>
          
          <category> æ•°æ®åº“ </category>
          
          <category> MySQL </category>
          
      </categories>
      
      
        <tags>
            
            <tag> MySQL </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>MySQLæ€§èƒ½ä¼˜åŒ–ä¹‹Explainæµ…æï¼ˆä¸‹ï¼‰</title>
      <link href="/2019/08/20/MySQL%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E4%B9%8BExplain%E6%B5%85%E6%9E%90%EF%BC%88%E4%B8%8B%EF%BC%89/"/>
      <url>/2019/08/20/MySQL%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E4%B9%8BExplain%E6%B5%85%E6%9E%90%EF%BC%88%E4%B8%8B%EF%BC%89/</url>
      
        <content type="html"><![CDATA[<p><strong>å†™åœ¨å‰é¢</strong>: æ¥ä¸Šç¯‡ <a href="https://inscode.github.io/2019/08/19/MySQL%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E4%B9%8BExplain%E6%B5%85%E6%9E%90%EF%BC%88%E4%B8%8A%EF%BC%89/">MySQLæ€§èƒ½ä¼˜åŒ–ä¹‹Explainæµ…æï¼ˆä¸Šï¼‰</a>ã€‚</p><a id="more"></a><hr><h4 id="1-explain-çš„ä½¿ç”¨åŠå…¶å­—æ®µè¯´æ˜"><a href="#1-explain-çš„ä½¿ç”¨åŠå…¶å­—æ®µè¯´æ˜" class="headerlink" title="1: explain çš„ä½¿ç”¨åŠå…¶å­—æ®µè¯´æ˜"></a>1: explain çš„ä½¿ç”¨åŠå…¶å­—æ®µè¯´æ˜</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- å¾—åˆ°çš„æ‰§è¡Œè®¡åˆ’å¦‚ä¸‹è¡¨</span></span><br><span class="line">mysql&gt; explain select * from employees;</span><br><span class="line">+<span class="comment">----+-------------+-----------+------------+------+---------------+------+---------+------+------+----------+-------+</span></span><br><span class="line">| id | select_type | table     | partitions | type | possible_keys | key  | key_len | ref  | rows | filtered | Extra |</span><br><span class="line">+<span class="comment">----+-------------+-----------+------------+------+---------------+------+---------+------+------+----------+-------+</span></span><br><span class="line">|  1 | SIMPLE      | employees | NULL       | ALL  | NULL          | NULL | NULL    | NULL |  107 |   100.00 | NULL  |</span><br><span class="line">+<span class="comment">----+-------------+-----------+------------+------+---------------+------+---------+------+------+----------+-------+</span></span><br><span class="line">1 row in <span class="keyword">set</span>, <span class="number">1</span> <span class="keyword">warning</span> (<span class="number">0.01</span> sec)</span><br></pre></td></tr></table></figure><h5 id="1-1-possible-keys-å­—æ®µ"><a href="#1-1-possible-keys-å­—æ®µ" class="headerlink" title="1.1: possible_keys å­—æ®µ"></a>1.1: possible_keys å­—æ®µ</h5><p><strong>å«ä¹‰æˆ–ç”¨é€”</strong>: æ˜¾ç¤ºå¯èƒ½åº”ç”¨åˆ°è¿™å¼ è¡¨ä¸­çš„ä¸€ä¸ªæˆ–å¤šä¸ªç´¢å¼•ã€‚æŸ¥è¯¢æ¶‰åŠåˆ°çš„å­—æ®µä¸Šè‹¥å­˜åœ¨ç´¢å¼•ï¼Œåˆ™è¯¥ç´¢å¼•åˆ—è¢«åˆ—å‡ºï¼Œä½†æ˜¯è¯¥ç´¢å¼•åˆ—ä¸ä¸€å®šè¢«å®é™…ä½¿ç”¨ã€‚</p><h5 id="1-2-keys-å­—æ®µ"><a href="#1-2-keys-å­—æ®µ" class="headerlink" title="1.2: keys å­—æ®µ"></a>1.2: keys å­—æ®µ</h5><p><strong>å«ä¹‰æˆ–ç”¨é€”</strong>: å®é™…ä½¿ç”¨çš„ç´¢å¼•ã€‚å¦‚æœä¸ºNullï¼Œåˆ™æ²¡æœ‰ä½¿ç”¨ç´¢å¼•ã€‚è‹¥æŸ¥è¯¢ä¸­ä½¿ç”¨äº†è¦†ç›–ç´¢å¼•ï¼Œåˆ™è¯¥ç´¢å¼•ä»…å‡ºç°åœ¨ <code>key</code> åˆ—ä¸­ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; explain select department_id,location_id from departments;</span><br><span class="line">+<span class="comment">----+-------------+-------------+------------+-------+---------------+-----------+---------+------+------+----------+-------------+</span></span><br><span class="line">| id | select_type | table       | partitions | type  | possible_keys | key       | key_len | ref  | rows | filtered | Extra       |</span><br><span class="line">+<span class="comment">----+-------------+-------------+------------+-------+---------------+-----------+---------+------+------+----------+-------------+</span></span><br><span class="line">|  1 | SIMPLE      | departments | NULL       | index | NULL          | loc_id_fk | 5       | NULL |   27 |   100.00 | Using index |</span><br><span class="line">+<span class="comment">----+-------------+-------------+------------+-------+---------------+-----------+---------+------+------+----------+-------------+</span></span><br></pre></td></tr></table></figure><h5 id="1-3-key-len-å­—æ®µ"><a href="#1-3-key-len-å­—æ®µ" class="headerlink" title="1.3: key_len å­—æ®µ"></a>1.3: key_len å­—æ®µ</h5><p><strong>å«ä¹‰æˆ–ç”¨é€”</strong>: è¡¨ç¤ºç´¢å¼•ä¸­å®é™…ç”¨åˆ°çš„å­—èŠ‚æ•°ï¼Œå¯é€šè¿‡è¯¥åˆ—è®¡ç®—æŸ¥è¯¢ä¸­ä½¿ç”¨çš„ç´¢å¼•é•¿åº¦ã€‚åœ¨ä¸æŸå¤±ç²¾åº¦çš„æƒ…å†µä¸‹ï¼Œé•¿åº¦è¶ŠçŸ­è¶Šå¥½ã€‚<code>key_len</code> æ˜¾ç¤ºçš„å€¼ä¸ºç´¢å¼•å­—æ®µçš„æœ€å¤§å¯èƒ½é•¿åº¦ï¼Œ<strong>å¹¶éå®é™…ä½¿ç”¨é•¿åº¦</strong>ï¼Œå³ <code>key_len</code> æ˜¯æ ¹æ®è¡¨å®šä¹‰è®¡ç®—è€Œå¾—ï¼Œä¸æ˜¯é€šè¿‡è¡¨å†…æ£€ç´¢è€Œå¾—ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- ä¸€ä¸ªæŸ¥è¯¢æ¡ä»¶</span></span><br><span class="line">mysql&gt; explain select * from employees where job_id="IT_PROG";</span><br><span class="line">+<span class="comment">----+-------------+-----------+------------+------+---------------+-----------+---------+-------+------+----------+-------+</span></span><br><span class="line">| id | select_type | table     | partitions | type | possible_keys | key       | key_len | ref   | rows | filtered | Extra |</span><br><span class="line">+<span class="comment">----+-------------+-----------+------------+------+---------------+-----------+---------+-------+------+----------+-------+</span></span><br><span class="line">|  1 | SIMPLE      | employees | NULL       | ref  | job_id_fk     | job_id_fk | 23      | const |    5 |   100.00 | NULL  |</span><br><span class="line">+<span class="comment">----+-------------+-----------+------------+------+---------------+-----------+---------+-------+------+----------+-------+</span></span><br><span class="line">1 row in <span class="keyword">set</span>, <span class="number">1</span> <span class="keyword">warning</span> (<span class="number">0.02</span> sec)</span><br><span class="line"></span><br><span class="line"><span class="comment">-- ä¸¤ä¸ªæŸ¥è¯¢æ¡ä»¶</span></span><br><span class="line">mysql&gt; <span class="keyword">explain</span> <span class="keyword">select</span> * <span class="keyword">from</span> employees <span class="keyword">where</span> job_id=<span class="string">"IT_PROG"</span> <span class="keyword">and</span> employee_id&gt;<span class="number">100</span>;</span><br><span class="line">+<span class="comment">----+-------------+-----------+------------+-------+-------------------+-----------+---------+------+------+----------+-----------------------+</span></span><br><span class="line">| id | select_type | table     | partitions | type  | possible_keys     | key       | key_len | ref  | rows | filtered | Extra                 |</span><br><span class="line">+<span class="comment">----+-------------+-----------+------------+-------+-------------------+-----------+---------+------+------+----------+-----------------------+</span></span><br><span class="line">|  1 | SIMPLE      | employees | NULL       | range | PRIMARY,job_id_fk | job_id_fk | 27      | NULL |    5 |   100.00 | Using index condition |</span><br><span class="line">+<span class="comment">----+-------------+-----------+------------+-------+-------------------+-----------+---------+------+------+----------+-----------------------+</span></span><br><span class="line">1 row in <span class="keyword">set</span>, <span class="number">1</span> <span class="keyword">warning</span> (<span class="number">0.01</span> sec)</span><br></pre></td></tr></table></figure><h5 id="1-4-ref-å­—æ®µ"><a href="#1-4-ref-å­—æ®µ" class="headerlink" title="1.4: ref å­—æ®µ"></a>1.4: ref å­—æ®µ</h5><p><strong>å«ä¹‰æˆ–ç”¨é€”</strong>: æ˜¾ç¤ºç´¢å¼•çš„é‚£ä¸€åˆ—è¢«ä½¿ç”¨äº†ï¼Œå¦‚æœå¯èƒ½çš„è¯ï¼Œæ˜¯ä¸€ä¸ªå¸¸æ•°ï¼Œ</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- employees.job_id='AC_MGR'è§£æä¸ºä¸€ä¸ªå¸¸é‡const</span></span><br><span class="line">mysql&gt; explain select * from employees,departments where employees.department_id = departments.department_id and employees.job_id='AC_MGR';</span><br><span class="line">+<span class="comment">----+-------------+-------------+------------+--------+----------------------+-----------+---------+-------------------------------------+------+----------+-------------+</span></span><br><span class="line">| id | select_type | table       | partitions | type   | possible_keys        | key       | key_len | ref                                 | rows | filtered | Extra       |</span><br><span class="line">+<span class="comment">----+-------------+-------------+------------+--------+----------------------+-----------+---------+-------------------------------------+------+----------+-------------+</span></span><br><span class="line">|  1 | SIMPLE      | employees   | NULL       | ref    | dept_id_fk,job_id_fk | job_id_fk | 23      | const                               |    1 |   100.00 | Using where |</span><br><span class="line">|  1 | SIMPLE      | departments | NULL       | eq_ref | PRIMARY              | PRIMARY   | 4       | myemployees.employees.department_id |    1 |   100.00 | NULL        |</span><br><span class="line">+<span class="comment">----+-------------+-------------+------------+--------+----------------------+-----------+---------+-------------------------------------+------+----------+-------------+</span></span><br></pre></td></tr></table></figure><h5 id="1-5-rows-å­—æ®µ"><a href="#1-5-rows-å­—æ®µ" class="headerlink" title="1.5: rows å­—æ®µ"></a>1.5: rows å­—æ®µ</h5><p><strong>å«ä¹‰æˆ–ç”¨é€”</strong>: æ¯å¼ è¡¨æœ‰å¤šå°‘è¡Œè¢«ä¼˜åŒ–å™¨æŸ¥è¯¢ï¼ˆå€¼è¶Šå°‘è¶Šå¥½ï¼‰ã€‚æ­¤æ•°å­—æ˜¯ä¼°ç®—å€¼ï¼Œå¯èƒ½å¹¶ä¸æ€»æ˜¯å‡†ç¡®çš„</p><h5 id="1-6-Extra-å­—æ®µ"><a href="#1-6-Extra-å­—æ®µ" class="headerlink" title="1.6: Extra å­—æ®µ"></a>1.6: Extra å­—æ®µ</h5><ul><li><p><code>Using filesort</code>: è¯´æ˜ <code>MySQL</code> ä¼šå¯¹æ•°æ®ä½¿ç”¨ä¸€ä¸ª <strong>å¤–éƒ¨çš„ç´¢å¼•æ’åº</strong>ï¼Œè€Œä¸æ˜¯æŒ‰ç…§è¡¨å†…çš„ç´¢å¼•é¡ºåºè¿›è¡Œè¯»å–ã€‚<code>MySQL</code> ä¸­æ— æ³•åˆ©ç”¨ç´¢å¼•å®Œæˆçš„æ’åºç§°ä¹‹ä¸º <strong>æ–‡ä»¶æ’åº</strong>ã€‚å‡ºç°æ—¶è¡¨ç¤ºéœ€è¦ä¼˜åŒ–äº†</p>  <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show index from apps;</span><br><span class="line">+<span class="comment">-------+------------+--------------------------+--------------+-------------+-----------+-------------+----------+--------+------+------------+---------+---------------+</span></span><br><span class="line">| Table | Non_unique | Key_name                 | Seq_in_index | Column_name | Collation | Cardinality | Sub_part | Packed | Null | Index_type | <span class="keyword">Comment</span> | Index_comment |</span><br><span class="line">+<span class="comment">-------+------------+--------------------------+--------------+-------------+-----------+-------------+----------+--------+------+------------+---------+---------------+</span></span><br><span class="line">| apps  |          <span class="number">0</span> | PRIMARY                  |            <span class="number">1</span> | <span class="keyword">id</span>          | A         |           <span class="number">5</span> |     <span class="literal">NULL</span> | <span class="literal">NULL</span>   |      | BTREE      |         |               |</span><br><span class="line">| apps  |          <span class="number">1</span> | idx_url_country_language |            <span class="number">1</span> | <span class="keyword">url</span>         | A         |           <span class="number">5</span> |     <span class="literal">NULL</span> | <span class="literal">NULL</span>   |      | BTREE      |         |               |</span><br><span class="line">| apps  |          <span class="number">1</span> | idx_url_country_language |            <span class="number">2</span> | country     | A         |           <span class="number">5</span> |     <span class="literal">NULL</span> | <span class="literal">NULL</span>   |      | BTREE      |         |               |</span><br><span class="line">| apps  |          <span class="number">1</span> | idx_url_country_language |            <span class="number">3</span> | <span class="keyword">language</span>    | A         |           <span class="number">5</span> |     <span class="literal">NULL</span> | <span class="literal">NULL</span>   |      | BTREE      |         |               |</span><br><span class="line">+<span class="comment">-------+------------+--------------------------+--------------+-------------+-----------+-------------+----------+--------+------+------------+---------+---------------+</span></span><br><span class="line"><span class="number">4</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line"><span class="comment">-- ç»„åˆç´¢å¼•æ˜¯ idx_url_country_languageï¼Œ ä¸‹é¢çš„SQL ä¸­é—´éš”äº†ç»„åˆç´¢å¼•çš„ country å­—æ®µ</span></span><br><span class="line">mysql&gt; <span class="keyword">explain</span> <span class="keyword">select</span> * <span class="keyword">from</span> apps <span class="keyword">where</span> <span class="keyword">url</span>=<span class="string">"https://golang.org"</span> <span class="keyword">order</span> <span class="keyword">by</span> <span class="keyword">language</span>;</span><br><span class="line">+<span class="comment">----+-------------+-------+------------+------+--------------------------+--------------------------+---------+-------+------+----------+---------------------------------------+</span></span><br><span class="line">| id | select_type | table | partitions | type | possible_keys            | key                      | key_len | ref   | rows | filtered | Extra                                 |</span><br><span class="line">+<span class="comment">----+-------------+-------+------------+------+--------------------------+--------------------------+---------+-------+------+----------+---------------------------------------+</span></span><br><span class="line">|  1 | SIMPLE      | apps  | NULL       | ref  | idx_url_country_language | idx_url_country_language | 767     | const |    1 |   100.00 | Using index condition; Using filesort |</span><br><span class="line">+<span class="comment">----+-------------+-------+------------+------+--------------------------+--------------------------+---------+-------+------+----------+---------------------------------------+</span></span><br><span class="line"></span><br><span class="line">mysql&gt; explain select * from apps where url="https://golang.org" order by country,language;</span><br><span class="line">+<span class="comment">----+-------------+-------+------------+------+--------------------------+--------------------------+---------+-------+------+----------+-----------------------+</span></span><br><span class="line">| id | select_type | table | partitions | type | possible_keys            | key                      | key_len | ref   | rows | filtered | Extra                 |</span><br><span class="line">+<span class="comment">----+-------------+-------+------------+------+--------------------------+--------------------------+---------+-------+------+----------+-----------------------+</span></span><br><span class="line">|  1 | SIMPLE      | apps  | NULL       | ref  | idx_url_country_language | idx_url_country_language | 767     | const |    1 |   100.00 | Using index condition |</span><br><span class="line">+<span class="comment">----+-------------+-------+------------+------+--------------------------+--------------------------+---------+-------+------+----------+-----------------------+</span></span><br></pre></td></tr></table></figure></li><li><p><code>Using temporary</code>: ä½¿ç”¨ä¸´æ—¶è¡¨ä¿å­˜ä¸­é—´æŸ¥è¯¢ç»“æœï¼ŒMySQL åœ¨å¯¹ç»“æœæ’åºæ—¶ä½¿ç”¨ä¸´æ—¶è¡¨ï¼Œå¸¸è§äºæ’åº <code>order by</code> å’Œ åˆ†ç»„æŸ¥è¯¢ <code>group by</code>ã€‚å‡ºç°æ—¶è¡¨ç¤º <strong>æ€¥éœ€ä¼˜åŒ–</strong> äº†</p>  <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; explain select country from apps group by country;</span><br><span class="line">+<span class="comment">----+-------------+-------+------------+-------+--------------------------+--------------------------+---------+------+------+----------+----------------------------------------------+</span></span><br><span class="line">| id | select_type | table | partitions | type  | possible_keys            | key                      | key_len | ref  | rows | filtered | Extra                                        |</span><br><span class="line">+<span class="comment">----+-------------+-------+------------+-------+--------------------------+--------------------------+---------+------+------+----------+----------------------------------------------+</span></span><br><span class="line">|  1 | SIMPLE      | apps  | NULL       | index | idx_url_country_language | idx_url_country_language | 895     | NULL |    5 |   100.00 | Using index; Using temporary; Using filesort |</span><br><span class="line">+<span class="comment">----+-------------+-------+------------+-------+--------------------------+--------------------------+---------+------+------+----------+----------------------------------------------+</span></span><br></pre></td></tr></table></figure></li><li><p><code>Using index</code>: è¡¨ç¤ºç›¸åº”çš„ select æ“ä½œä½¿ç”¨äº†è¦†ç›–ç´¢å¼•ï¼ˆ<code>Covering index</code>ï¼‰,é¿å…è®¿é—®è¡¨çš„æ•°æ®è¡Œï¼Œæ•ˆç‡è¿˜é˜”ä»¥ã€‚å¦‚æœè¿˜åŒæ—¶å‡ºç°äº† <code>using where</code>ï¼Œè¡¨æ˜ç´¢å¼•è¿˜è¢«ç”¨æ¥æ‰§è¡Œç´¢å¼•å€¼çš„æŸ¥æ‰¾ã€‚å¦‚æœæ²¡æœ‰åŒæ—¶å‡ºç° <code>using where</code>ï¼Œè¡¨æ˜ç´¢å¼•åªæ˜¯ç”¨æ¥è¯»å–æ•°æ®è€Œéæ‰§è¡ŒæŸ¥è¯¢æ“ä½œã€‚</p>  <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; explain select employee_id from employees where employee_id order by  employee_id;</span><br><span class="line">+<span class="comment">----+-------------+-----------+------------+-------+---------------+---------+---------+------+------+----------+--------------------------+</span></span><br><span class="line">| id | select_type | table     | partitions | type  | possible_keys | key     | key_len | ref  | rows | filtered | Extra                    |</span><br><span class="line">+<span class="comment">----+-------------+-----------+------------+-------+---------------+---------+---------+------+------+----------+--------------------------+</span></span><br><span class="line">|  1 | SIMPLE      | employees | NULL       | index | NULL          | PRIMARY | 4       | NULL |  107 |    90.00 | Using where; Using index |</span><br><span class="line">+<span class="comment">----+-------------+-----------+------------+-------+---------------+---------+---------+------+------+----------+--------------------------+</span></span><br></pre></td></tr></table></figure><pre><code>è¦†ç›–ç´¢å¼•ï¼šMySQL å¯ä»¥åˆ©ç”¨ç´¢å¼•è¿”å› `select` æŸ¥è¯¢çš„å­—æ®µï¼Œè€Œä¸å¿…æ ¹æ®ç´¢å¼•å†æ¬¡å»è¯»å–æ•°æ®æ–‡ä»¶ã€‚ä¹Ÿå°±æ˜¯è¯´æŸ¥è¯¢çš„åˆ—æ˜¯ç´¢å¼•çš„ä¸€éƒ¨åˆ†ï¼Œé‚£ä¹ˆæŸ¥è¯¢å°±åªåœ¨ç´¢å¼•ä¸Šè¿›è¡Œã€‚</code></pre></li><li><p><code>using join buffer</code>: ä½¿ç”¨äº†è¿æ¥ç¼“å­˜</p></li><li><p><code>impossible where</code>: where å­—å¥çš„å€¼æ€»æ˜¯ falseï¼Œä¸èƒ½ç”¨æ¥è·å–ä»»ä½•å…ƒç¥–</p>  <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; explain select * from employees where employee_id= 1 and employee_id=2;</span><br><span class="line">+<span class="comment">----+-------------+-------+------------+------+---------------+------+---------+------+------+----------+------------------+</span></span><br><span class="line">| id | select_type | table | partitions | type | possible_keys | key  | key_len | ref  | rows | filtered | Extra            |</span><br><span class="line">+<span class="comment">----+-------------+-------+------------+------+---------------+------+---------+------+------+----------+------------------+</span></span><br><span class="line">|  1 | SIMPLE      | NULL  | NULL       | NULL | NULL          | NULL | NULL    | NULL | NULL |     NULL | Impossible WHERE |</span><br><span class="line">+<span class="comment">----+-------------+-------+------------+------+---------------+------+---------+------+------+----------+------------------+</span></span><br></pre></td></tr></table></figure></li></ul>]]></content>
      
      
      <categories>
          
          <category> æ•°æ®åº“ </category>
          
          <category> MySQL </category>
          
      </categories>
      
      
        <tags>
            
            <tag> MySQL </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>MySQLæ€§èƒ½ä¼˜åŒ–ä¹‹Explainæµ…æï¼ˆä¸Šï¼‰</title>
      <link href="/2019/08/19/MySQL%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E4%B9%8BExplain%E6%B5%85%E6%9E%90%EF%BC%88%E4%B8%8A%EF%BC%89/"/>
      <url>/2019/08/19/MySQL%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E4%B9%8BExplain%E6%B5%85%E6%9E%90%EF%BC%88%E4%B8%8A%EF%BC%89/</url>
      
        <content type="html"><![CDATA[<p><strong>å†™åœ¨å‰é¢</strong>: åœ¨è½¯ä»¶å¼€å‘ä¸­ï¼Œéµå¾ªç€ <code>first finish then perfect</code> çš„åŸåˆ™ã€‚å‰æœŸæˆ‘ä»¬å¾€å¾€ä¼šæ›´åŠ å…³æ³¨ç¨‹åºåŠŸèƒ½çš„å®ç°ï¼Œç¼–å†™çš„ <code>SQL</code> è¯­å¥ä¹Ÿå¤šä¸ºæ»¡è¶³ä¸šåŠ¡æ‰€éœ€çš„å¢åˆ æ”¹æŸ¥ã€‚å¦‚æœè¿æ°”è¿˜ä¸é”™ï¼Œä¸šåŠ¡åšèµ·æ¥äº†ï¼Œæ•°æ®é‡è¾¾åˆ°ä¸€å®šé‡çº§æ—¶ï¼Œæˆ‘ä»¬å‘ç°ä¸€ä¸ªè¯·æ±‚çš„å“åº”æ—¶é—´ä¼šè¶Šæ¥è¶Šéš¾ä»¥æ¥å—ï¼Œå…¶ä¸­æŸäº›ä¸å†åˆç†çš„ <code>SQL</code> å¾€å¾€ä¼šæˆä¸ºæ•´ä¸ªè¯·æ±‚å“åº”ä¸­æ€§èƒ½æ¶ˆè€—å¤§æˆ·ï¼Œç”šè‡³æˆä¸ºæ€§èƒ½ç“¶é¢ˆï¼Œé‚£ä¹ˆæ­¤æ—¶å¯¹ <code>SQL</code> è¯­å¥çš„ä¼˜åŒ–å°±æ˜¾å¾—æ ¼å¤–é‡è¦äº†ã€‚è¦ä¼˜åŒ– <code>SQL</code> å°±éœ€è¦å®šä½ <code>SQL</code> å­˜åœ¨çš„é—®é¢˜ã€‚<code>MySQL</code> æä¾›äº† <code>explain  + sql</code> å‘½ä»¤æ¥è·å– <code>SQL</code> è¯­å¥æ‰§è¡Œè®¡åˆ’çš„ä¿¡æ¯ï¼ŒåŒ…æ‹¬æœ‰å…³å¦‚ä½•è¿æ¥è¡¨ä»¥åŠä»¥ä½•ç§é¡ºåºè¿æ¥è¡¨ã€‚ä»¥ä¸‹ä¸º <code>explain</code> å­¦ä¹ ä¸­æ‰€åšç¬”è®°ï¼Œè®°å½•äºæ­¤ğŸ“ä»¥ä¾¿ä»Šåç¿»é˜…ã€‚</p><p>é‰´äºç¯‡å¹…: è¿™é‡Œè®°å½•æˆªè‡³ <code>explain</code> ä¸­ <code>type</code> å‰çš„å­—æ®µ</p><a id="more"></a><p>å¤‡æ³¨: æ–‡ä¸­ç”¨åˆ°çš„sqlæ•°æ®æ¥è‡ª <a href="https://github.com/inscode/inscode.github.io/blob/master/blog/source/static/myemployees.sql" target="_blank" rel="noopener">employees.sql</a></p><hr><h4 id="1-explain-èƒ½è·å–åˆ°é‚£äº›ä¿¡æ¯ï¼Ÿ"><a href="#1-explain-èƒ½è·å–åˆ°é‚£äº›ä¿¡æ¯ï¼Ÿ" class="headerlink" title="1: explain èƒ½è·å–åˆ°é‚£äº›ä¿¡æ¯ï¼Ÿ"></a>1: explain èƒ½è·å–åˆ°é‚£äº›ä¿¡æ¯ï¼Ÿ</h4><ul><li><p>è¡¨çš„è¯»å–é¡ºåº</p></li><li><p>è¡¨æ•°æ®è¯»å–æ“ä½œï¼ˆ<code>select</code>ï¼‰çš„ç±»å‹</p></li><li><p>é‚£äº›æ‰€æœ‰é˜”ä»¥è¢«ä½¿ç”¨</p></li><li><p>é‚£äº›ç´¢å¼•å®é™…è¢«ä½¿ç”¨</p></li><li><p>è¡¨ä¹‹é—´çš„å¼•ç”¨</p></li><li><p>æ¯å¼ è¡¨æœ‰å¤šå°‘è¡Œè¢«ä¼˜åŒ–å™¨æŸ¥è¯¢</p></li></ul><h4 id="2-explain-çš„ä½¿ç”¨åŠå…¶å­—æ®µè¯´æ˜"><a href="#2-explain-çš„ä½¿ç”¨åŠå…¶å­—æ®µè¯´æ˜" class="headerlink" title="2: explain çš„ä½¿ç”¨åŠå…¶å­—æ®µè¯´æ˜"></a>2: explain çš„ä½¿ç”¨åŠå…¶å­—æ®µè¯´æ˜</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- å¾—åˆ°çš„æ‰§è¡Œè®¡åˆ’å¦‚ä¸‹è¡¨</span></span><br><span class="line">mysql&gt; explain select * from employees;</span><br><span class="line">+<span class="comment">----+-------------+-----------+------------+------+---------------+------+---------+------+------+----------+-------+</span></span><br><span class="line">| id | select_type | table     | partitions | type | possible_keys | key  | key_len | ref  | rows | filtered | Extra |</span><br><span class="line">+<span class="comment">----+-------------+-----------+------------+------+---------------+------+---------+------+------+----------+-------+</span></span><br><span class="line">|  1 | SIMPLE      | employees | NULL       | ALL  | NULL          | NULL | NULL    | NULL |  107 |   100.00 | NULL  |</span><br><span class="line">+<span class="comment">----+-------------+-----------+------------+------+---------------+------+---------+------+------+----------+-------+</span></span><br><span class="line">1 row in <span class="keyword">set</span>, <span class="number">1</span> <span class="keyword">warning</span> (<span class="number">0.01</span> sec)</span><br></pre></td></tr></table></figure><h5 id="2-1-id-å­—æ®µ"><a href="#2-1-id-å­—æ®µ" class="headerlink" title="2.1: id å­—æ®µ"></a>2.1: id å­—æ®µ</h5><p><strong>å«ä¹‰æˆ–ç”¨é€”</strong>: select æŸ¥è¯¢çš„åºåˆ—å·ï¼ŒåŒ…å«ä¸€ç»„æ•°å­—ï¼Œè¡¨ç¤ºæŸ¥è¯¢ä¸­æ‰§è¡Œ select å­—å¥æˆ–æ˜¯æ“ä½œè¡¨çš„é¡ºåº</p><p><strong>id çš„ä¸‰ç§æƒ…å½¢</strong></p><ul><li><p>id ç›¸åŒï¼Œæ‰§è¡Œé¡ºåºè‡ªä¸Šè€Œä¸‹</p>  <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- æŸ¥è¯¢å‘˜å·¥åï¼Œéƒ¨é—¨å</span></span><br><span class="line">mysql&gt; explain SELECT employees.employee_id,employees.last_name, departments.department_name</span><br><span class="line">    -&gt; from employees</span><br><span class="line">    -&gt; inner join departments</span><br><span class="line">    -&gt; on employees.department_id = departments.department_id;</span><br><span class="line">+<span class="comment">----+-------------+-------------+------------+------+---------------+------------+---------+---------------------------------------+------+----------+-------+</span></span><br><span class="line">| id | select_type | table       | partitions | type | possible_keys | key        | key_len | ref                                   | rows | filtered | Extra |</span><br><span class="line">+<span class="comment">----+-------------+-------------+------------+------+---------------+------------+---------+---------------------------------------+------+----------+-------+</span></span><br><span class="line">|  1 | SIMPLE      | departments | NULL       | ALL  | PRIMARY       | NULL       | NULL    | NULL                                  |   27 |   100.00 | NULL  |</span><br><span class="line">|  1 | SIMPLE      | employees   | NULL       | ref  | dept_id_fk    | dept_id_fk | 5       | myemployees.departments.department_id |    9 |   100.00 | NULL  |</span><br><span class="line">+<span class="comment">----+-------------+-------------+------------+------+---------------+------------+---------+---------------------------------------+------+----------+-------+</span></span><br><span class="line">2 rows in <span class="keyword">set</span>, <span class="number">1</span> <span class="keyword">warning</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure><p>  è¯´æ˜: è¡¨è¯»å–é¡ºåºæ˜¯å…ˆ <code>departments</code> å <code>departments</code>ã€‚</p></li><li><p>id ä¸åŒï¼Œå¦‚æœæ˜¯å­æŸ¥è¯¢ï¼Œid çš„åºå·ä¼šé€’å¢ï¼Œid å€¼è¶Šå¤§å…¶ä¼˜å…ˆçº§è¶Šé«˜ï¼Œå°±è¶Šå…ˆè¢«æ‰§è¡Œã€‚</p>  <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">mysql&gt; explain select * from employees where salary = (select max(salary) from employees);</span><br><span class="line">+<span class="comment">----+-------------+-----------+------------+------+---------------+------+---------+------+------+----------+-------------+</span></span><br><span class="line">| id | select_type | table     | partitions | type | possible_keys | key  | key_len | ref  | rows | filtered | Extra       |</span><br><span class="line">+<span class="comment">----+-------------+-----------+------------+------+---------------+------+---------+------+------+----------+-------------+</span></span><br><span class="line">|  1 | PRIMARY     | employees | NULL       | ALL  | NULL          | NULL | NULL    | NULL |  107 |    10.00 | Using where |</span><br><span class="line">|  2 | SUBQUERY    | employees | NULL       | ALL  | NULL          | NULL | NULL    | NULL |  107 |   100.00 | NULL        |</span><br><span class="line">+<span class="comment">----+-------------+-----------+------------+------+---------------+------+---------+------+------+----------+-------------+</span></span><br><span class="line">2 rows in <span class="keyword">set</span>, <span class="number">1</span> <span class="keyword">warning</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure><p>  è¯´æ˜: è¡¨æ‰§è¡Œé¡ºåºæ˜¯å…ˆæ‰§è¡Œ id ä¸º 2 çš„å­æŸ¥è¯¢åæ‰§è¡Œ id ä¸º 1 çš„ä¸»æŸ¥è¯¢ã€‚</p></li><li><p>id ç›¸åŒä¸åŒï¼ŒåŒæ—¶å­˜åœ¨ï¼ˆâ“è¿™æ˜¯ä»€ä¹ˆé¬¼ğŸ‘»ï¼‰</p>  <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; æ²¡æ‰¾åˆ°ä¾‹å­ï¼Œä¸‹é¢å°±åªè¡¨ç¤ºä¸€ä¸‹äº†ğŸ˜‚ğŸ˜‚ğŸ˜‚(åªå…³æ³¨ id å°±è¡Œ)</span><br><span class="line">+<span class="comment">----+-------------+-----------+------------+------+---------------+------+---------+------+------+----------+-------------+</span></span><br><span class="line">| id | select_type | table     | partitions | type | possible_keys | key  | key_len | ref  | rows | filtered | Extra       |</span><br><span class="line">+<span class="comment">----+-------------+-----------+------------+------+---------------+------+---------+------+------+----------+-------------+</span></span><br><span class="line">|  1 | PRIMARY     | employees | NULL       | ALL  | NULL          | NULL | NULL    | NULL |  107 |    10.00 | Using where |</span><br><span class="line">|  1 | PRIMARY     | employees | NULL       | ALL  | NULL          | NULL | NULL    | NULL |  107 |   100.00 | NULL        |</span><br><span class="line">|  2 | SUBQUERY    | employees | NULL       | ALL  | NULL          | NULL | NULL    | NULL |  107 |   100.00 | NULL        |</span><br><span class="line">+<span class="comment">----+-------------+-----------+------------+------+---------------+------+---------+------+------+----------+-------------+</span></span><br><span class="line">2 rows in <span class="keyword">set</span>, <span class="number">1</span> <span class="keyword">warning</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure><p>  è¯´æ˜: id å­—æ®µä¸­æ•°å­—å¤§çš„å…ˆæ‰§è¡Œï¼Œå³æ˜¯ <code>2å…ˆæ‰§è¡Œ</code>ï¼Œç„¶åå­˜åœ¨ä¸¤ä¸ªè¯„ä»·çš„ 1ï¼ŒæŒ‰ <code>è‡ªä¸Šè€Œä¸‹çš„å…ˆåé¡ºåºæ‰§è¡Œ</code>ã€‚</p></li></ul><h5 id="2-2-select-type-å­—æ®µ"><a href="#2-2-select-type-å­—æ®µ" class="headerlink" title="2.2: select_type å­—æ®µ"></a>2.2: <code>select_type</code> å­—æ®µ</h5><p><strong>å«ä¹‰æˆ–ç”¨é€”</strong>: è¡¨ç¤º <code>SELECT</code> çš„ç±»å‹ï¼Œä¸»è¦ç”¨äºåŒºåˆ« æ™®é€šæŸ¥è¯¢ã€è”åˆæŸ¥è¯¢ã€å­æŸ¥è¯¢ç­‰å¤æ‚æŸ¥è¯¢ã€‚å¸¸è§çš„å–å€¼å¦‚ä¸‹</p><ul><li><p><strong>1-SIMPLE:</strong>  ç®€å• select æŸ¥è¯¢ï¼Œä¸åŒ…å«å­æŸ¥è¯¢æˆ–è€…è¿æ¥æŸ¥è¯¢ï¼ˆunionï¼‰</p></li><li><p><strong>2-PRIMARY:</strong>  ä¸»æŸ¥è¯¢ï¼Œå³æ˜¯å¤–å±‚çš„æŸ¥è¯¢ï¼ˆæŸ¥è¯¢ä¸­åŒ…å«äº†å­æŸ¥è¯¢ï¼‰ï¼ŒPRIMARY æ˜¯æœ€ååŠ è½½çš„æŸ¥è¯¢</p></li><li><p><strong>3-SUBQUERY:</strong>  åœ¨ SELECT æˆ– where æŸ¥è¯¢åŒ…å«äº† å­æŸ¥è¯¢</p></li><li><p><strong>4-DERIVED:</strong>  åœ¨ From åˆ—è¡¨ä¸­åŒ…å«çš„å­æŸ¥è¯¢è¢«æ ‡è®°ä¸º DEVIRED(è¡ç”Ÿ)ã€‚MySQLä¼šé€’å½’æ‰§è¡Œè¿™äº›å­æŸ¥è¯¢ï¼ŒæŠŠç»“æœæ”¾åœ¨ä¸´æ—¶è¡¨ä¸­ï¼ˆä¼šå¢åŠ ç³»ç»Ÿæ¶ˆè€—ï¼‰</p></li><li><p><strong>5-UNION:</strong>  è‹¥ç¬¬äºŒä¸ª SELECT å‡ºç°åœ¨ UNION ä¹‹åï¼Œåˆ™æ ‡è®°ä¸º UNION; è‹¥ UNION åŒ…å«åœ¨ FROM å­—å¥çš„å­æŸ¥è¯¢ä¸­ï¼Œå¤–å±‚çš„ SELECT è¢«æ ‡è®° DEVIRED</p></li><li><p><strong>6-UNION RESULT:</strong>  ä¸¤ç§ UNION ç»“æœçš„åˆå¹¶</p>  <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; explain select * from employees where email like '%a%' union select * from employees where department_id&gt;90;</span><br><span class="line">+<span class="comment">----+--------------+------------+------------+-------+---------------+------------+---------+------+------+----------+-----------------------+</span></span><br><span class="line">| id  | select_type  | table      | partitions | type  | possible_keys | key        | key_len | ref  | rows | filtered | Extra                 |</span><br><span class="line">+<span class="comment">-----+--------------+------------+------------+-------+---------------+------------+---------+------+------+----------+-----------------------+</span></span><br><span class="line">|  1  | PRIMARY      | employees  | NULL       | ALL   | NULL          | NULL       | NULL    | NULL |  107 |    11.11 | Using where           |</span><br><span class="line">|  2  | UNION        | employees  | NULL       | range | dept_id_fk    | dept_id_fk | 5       | NULL |    8 |   100.00 | Using index condition |</span><br><span class="line">| NULL| UNION RESULT | &lt;union1,2&gt; | NULL       | ALL   | NULL          | NULL       | NULL    | NULL | NULL |     NULL | Using temporary       |</span><br><span class="line">+<span class="comment">----+--------------+------------+------------+-------+---------------+------------+---------+------+------+----------+-----------------------+</span></span><br><span class="line">3 rows in <span class="keyword">set</span>, <span class="number">1</span> <span class="keyword">warning</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure></li></ul><h5 id="2-3-table-å­—æ®µ"><a href="#2-3-table-å­—æ®µ" class="headerlink" title="2.3: table å­—æ®µ"></a>2.3: <code>table</code> å­—æ®µ</h5><p><strong>å«ä¹‰æˆ–ç”¨é€”</strong>: è¾“å‡ºç»“æœé›†çš„è¡¨ï¼ˆæŸ¥è¯¢ç»“æœçš„æ¥æºè¡¨ï¼‰</p><h5 id="2-4-type-å­—æ®µ"><a href="#2-4-type-å­—æ®µ" class="headerlink" title="2.4: type å­—æ®µ"></a>2.4: <code>type</code> å­—æ®µ</h5><p><strong>å«ä¹‰æˆ–ç”¨é€”</strong>: æ˜¾ç¤ºæŸ¥è¯¢ä½¿ç”¨äº†ä½•ç§è¿æ¥ç±»å‹ã€‚ç»“æœå€¼ä»æœ€å¥½åˆ°æœ€åä¾æ¬¡å¦‚ä¸‹ï¼Œé€šå¸¸æ¥è¯´ä¿è¯ type å€¼èƒ½è¾¾åˆ° Rangeã€‚</p><p><strong><code>system</code> &gt; <code>const</code> &gt; <code>eq_ref</code> &gt; <code>ref</code> &gt; <code>range</code> &gt; <code>index</code> &gt; <code>all</code></strong></p><ul><li><p><strong>1-system:</strong>  å•è¡¨åªæœ‰ä¸€è¡Œè®°å½•ï¼ˆç­‰äºç³»ç»Ÿè¡¨ï¼‰ï¼Œæ˜¯constè¿æ¥ç±»å‹çš„ç‰¹ä¾‹ã€‚å¯ä»¥å¿½ç•¥ä¸è®¡</p></li><li><p><strong>2-const:</strong>  è¯¥è¡¨æœ€å¤šåªæœ‰ä¸€ä¸ªåŒ¹é…è¡Œï¼Œåœ¨æŸ¥è¯¢å¼€å¤´è¯»å–ã€‚å› ä¸ºåªæœ‰ä¸€è¡Œï¼Œæ‰€ä»¥ä¼˜åŒ–å™¨çš„å…¶ä½™éƒ¨åˆ†å¯ä»¥å°†æ­¤è¡Œä¸­åˆ—çš„å€¼è§†ä¸ºå¸¸é‡ã€‚constè¡¨éå¸¸å¿«ï¼Œå› ä¸ºå®ƒä»¬åªè¯»ä¸€æ¬¡ã€‚const å°† PRIMARY KEYæˆ– UNIQUEç´¢å¼•çš„æ‰€æœ‰éƒ¨åˆ†ä¸å¸¸é‡å€¼è¿›è¡Œæ¯”è¾ƒæ—¶ä½¿ç”¨ã€‚</p>  <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- ä¸»é”® employee_id = 100 æ˜¯ä¸€ä¸ªå¸¸é‡ï¼Œå¯¹åº”ä¸€æ¡è®°å½•ï¼Œ type ä¸º const</span></span><br><span class="line">mysql&gt; explain select * from (select * from employees where employee_id = 100) as tmp;</span><br><span class="line">+<span class="comment">----+-------------+-----------+------------+-------+---------------+---------+---------+-------+------+----------+-------+</span></span><br><span class="line">| id | select_type | table     | partitions | type  | possible_keys | key     | key_len | ref   | rows | filtered | Extra |</span><br><span class="line">+<span class="comment">----+-------------+-----------+------------+-------+---------------+---------+---------+-------+------+----------+-------+</span></span><br><span class="line">|  1 | SIMPLE      | employees | NULL       | const | PRIMARY       | PRIMARY | 4       | const |    1 |   100.00 | NULL  |</span><br><span class="line">+<span class="comment">----+-------------+-----------+------------+-------+---------------+---------+---------+-------+------+----------+-------+</span></span><br></pre></td></tr></table></figure></li><li><p><strong>3-eq_ref:</strong>  å”¯ä¸€æ€§ç´¢å¼•ï¼ˆ<code>PRIMARY KEY</code> æˆ– <code>UNIQUE NOT NULL</code>ï¼‰æ‰«æï¼Œå¯¹äºæ¯ä¸ªç´¢å¼•é”®ï¼Œè¡¨ä¸­åªæœ‰ä¸€ä¸ªè®°å½•ä¸ä¹‹åŒ¹é…ã€‚å¸¸è§äºä¸»é”®æˆ–å”¯ä¸€ç´¢å¼•</p>  <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- job_id='AC_MGR' åœ¨employeesè¡¨ä¸­åªæœ‰ä¸€æ¡è®°å½•;</span></span><br><span class="line">mysql&gt; explain select * from employees,departments where employees.job_id='AC_MGR' and departments.department_id = employees.department_id;</span><br><span class="line">+<span class="comment">----+-------------+-------------+------------+--------+----------------------+-----------+---------+-------------------------------------+------+----------+-------------+</span></span><br><span class="line">| id | select_type | table       | partitions | type   | possible_keys        | key       | key_len | ref                                 | rows | filtered | Extra       |</span><br><span class="line">+<span class="comment">----+-------------+-------------+------------+--------+----------------------+-----------+---------+-------------------------------------+------+----------+-------------+</span></span><br><span class="line">|  1 | SIMPLE      | employees   | NULL       | ref    | dept_id_fk,job_id_fk | job_id_fk | 23      | const                               |    1 |   100.00 | Using where |</span><br><span class="line">|  1 | SIMPLE      | departments | NULL       | eq_ref | PRIMARY              | PRIMARY   | 4       | myemployees.employees.department_id |    1 |   100.00 | NULL        |</span><br><span class="line">+<span class="comment">----+-------------+-------------+------------+--------+----------------------+-----------+---------+-------------------------------------+------+----------+-------------+</span></span><br></pre></td></tr></table></figure></li><li><p><strong>4-ref:</strong>  éå”¯ä¸€æ€§ç´¢å¼•æ‰«æ, è¿”å›åŒ¹é…æŸä¸ªå•ç‹¬å€¼çš„æ‰€æœ‰è¡Œè®°å½•ã€‚</p>  <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- job_id æ˜¯ä¸€ä¸ªç´¢å¼•ï¼Œé…ç½®job_id = 'SA_REP' çš„æ‰€æœ‰è®°å½•</span></span><br><span class="line">mysql&gt; explain select * from employees where job_id='SA_REP';</span><br><span class="line">+<span class="comment">----+-------------+-----------+------------+------+---------------+-----------+---------+-------+------+----------+-------+</span></span><br><span class="line">| id | select_type | table     | partitions | type | possible_keys | key       | key_len | ref   | rows | filtered | Extra |</span><br><span class="line">+<span class="comment">----+-------------+-----------+------------+------+---------------+-----------+---------+-------+------+----------+-------+</span></span><br><span class="line">|  1 | SIMPLE      | employees | NULL       | ref  | job_id_fk     | job_id_fk | 23      | const |   30 |   100.00 | NULL  |</span><br><span class="line">+<span class="comment">----+-------------+-----------+------------+------+---------------+-----------+---------+-------+------+----------+-------+</span></span><br></pre></td></tr></table></figure></li><li><p><strong>5-range:</strong> ç´¢å¼•ä»…æ£€ç´¢ç»™å®šèŒƒå›´å†…çš„è¡Œï¼Œä½¿ç”¨ç´¢å¼•é€‰æ‹©è¡Œ   </p>  <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- ä½¿ç”¨ =ï¼Œ &lt;&gt;ï¼Œ &gt;ï¼Œ &gt;=ï¼Œ &lt;ï¼Œ &lt;=ï¼Œ IS NULLï¼Œ &lt;=&gt;ï¼Œ BETWEENï¼Œ LIKEï¼Œæˆ– IN()è¿ç®—ç¬¦</span></span><br><span class="line">mysql&gt; explain select * from employees where employee_id&gt;100;</span><br><span class="line">+<span class="comment">----+-------------+-----------+------------+-------+---------------+---------+---------+------+------+----------+-------------+</span></span><br><span class="line">| id | select_type | table     | partitions | type  | possible_keys | key     | key_len | ref  | rows | filtered | Extra       |</span><br><span class="line">+<span class="comment">----+-------------+-----------+------------+-------+---------------+---------+---------+------+------+----------+-------------+</span></span><br><span class="line">|  1 | SIMPLE      | employees | NULL       | range | PRIMARY       | PRIMARY | 4       | NULL |  106 |   100.00 | Using where |</span><br><span class="line">+<span class="comment">----+-------------+-----------+------------+-------+---------------+---------+---------+------+------+----------+-------------+</span></span><br></pre></td></tr></table></figure></li><li><p><strong>6-index:</strong> <code>index</code> ä¸ <code>all</code> çš„åŒºåˆ«ä¸º <code>index</code> ç±»å‹åªéå†ç´¢å¼•æ•°ğŸŒ²ï¼Œæ‰€ä»¥æ¯” <code>all</code> å¿«ã€‚å› ä¸ºç´¢å¼•æ–‡ä»¶é€šå¸¸æ¯”æ•°æ®æ–‡ä»¶å°ï¼Œè™½ç„¶ä¸¤è€…éƒ½æ˜¯æ‰«æå…¨è¡¨ï¼Œä½†æ˜¯ <code>index</code> ä»ç´¢å¼•ä¸­è¯»å–ï¼Œè€Œ <code>all</code> æ˜¯ä»ç¡¬ç›˜ä¸­è¯»å–ã€‚</p>  <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- æŸ¥çœ‹è¡¨ departments çš„ç´¢å¼•æƒ…å†µ</span></span><br><span class="line">mysql&gt; show index from departments;</span><br><span class="line">+<span class="comment">-------------+------------+-----------+--------------+---------------+-----------+-------------+----------+--------+------+------------+---------+---------------+</span></span><br><span class="line">| Table       | Non_unique | Key_name  | Seq_in_index | Column_name   | Collation | Cardinality | Sub_part | Packed | Null | Index_type | <span class="keyword">Comment</span> | Index_comment |</span><br><span class="line">+<span class="comment">-------------+------------+-----------+--------------+---------------+-----------+-------------+----------+--------+------+------------+---------+---------------+</span></span><br><span class="line">| departments |          <span class="number">0</span> | PRIMARY   |            <span class="number">1</span> | department_id | A         |          <span class="number">27</span> |     <span class="literal">NULL</span> | <span class="literal">NULL</span>   |      | BTREE      |         |               |</span><br><span class="line">| departments |          <span class="number">1</span> | loc_id_fk |            <span class="number">1</span> | location_id   | A         |           <span class="number">7</span> |     <span class="literal">NULL</span> | <span class="literal">NULL</span>   | YES  | BTREE      |         |               |</span><br><span class="line">+<span class="comment">-------------+------------+-----------+--------------+---------------+-----------+-------------+----------+--------+------+------------+---------+---------------+</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- è¦†ç›–ç´¢å¼•</span></span><br><span class="line">mysql&gt; <span class="keyword">explain</span> <span class="keyword">select</span> department_id, location_id <span class="keyword">from</span> departments;</span><br><span class="line">+<span class="comment">----+-------------+-------------+------------+-------+---------------+-----------+---------+------+------+----------+-------------+</span></span><br><span class="line">| id | select_type | table       | partitions | type  | possible_keys | key       | key_len | ref  | rows | filtered | Extra       |</span><br><span class="line">+<span class="comment">----+-------------+-------------+------------+-------+---------------+-----------+---------+------+------+----------+-------------+</span></span><br><span class="line">|  1 | SIMPLE      | departments | NULL       | index | NULL          | loc_id_fk | 5       | NULL |   27 |   100.00 | Using index |</span><br><span class="line">+<span class="comment">----+-------------+-------------+------------+-------+---------------+-----------+---------+------+------+----------+-------------+</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- manager_idä¸æ˜¯ç´¢å¼•å­—æ®µ</span></span><br><span class="line">mysql&gt; explain select department_id, location_id, manager_id from departments;</span><br><span class="line">+<span class="comment">----+-------------+-------------+------------+------+---------------+------+---------+------+------+----------+-------+</span></span><br><span class="line">| id | select_type | table       | partitions | type | possible_keys | key  | key_len | ref  | rows | filtered | Extra |</span><br><span class="line">+<span class="comment">----+-------------+-------------+------------+------+---------------+------+---------+------+------+----------+-------+</span></span><br><span class="line">|  1 | SIMPLE      | departments | NULL       | ALL  | NULL          | NULL | NULL    | NULL |   27 |   100.00 | NULL  |</span><br><span class="line">+<span class="comment">----+-------------+-------------+------------+------+---------------+------+---------+------+------+----------+-------+</span></span><br></pre></td></tr></table></figure></li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">explain select * from employees where salary=&apos;20000&apos;;</span><br></pre></td></tr></table></figure><hr><p>æœªå®Œå¾…ç»­</p>]]></content>
      
      
      <categories>
          
          <category> æ•°æ®åº“ </category>
          
          <category> MySQL </category>
          
      </categories>
      
      
        <tags>
            
            <tag> MySQL </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ•°å­¦æ€ç»´ä¿®ç‚¼ä¸€: æ•°æ®çš„è¡¨ç¤º</title>
      <link href="/2019/08/18/%E6%95%B0%E5%AD%A6%E6%80%9D%E7%BB%B4%E4%BF%AE%E7%82%BC%E4%B8%80-%E6%95%B0%E6%8D%AE%E7%9A%84%E8%A1%A8%E7%A4%BA/"/>
      <url>/2019/08/18/%E6%95%B0%E5%AD%A6%E6%80%9D%E7%BB%B4%E4%BF%AE%E7%82%BC%E4%B8%80-%E6%95%B0%E6%8D%AE%E7%9A%84%E8%A1%A8%E7%A4%BA/</url>
      
        <content type="html"><![CDATA[<p>å†™åœ¨å‰é¢: ä»¥ä¸‹ä¸ºä¹¦ç±ğŸ“š <strong>ã€Šç¨‹åºå‘˜çš„æ•°å­¦æ€ç»´ä¿®ç‚¼ã€‹</strong> ç¬¬1ç«  <strong>&lt;æ•°æ®çš„è¡¨ç¤º&gt;</strong> è¯»ä¹¦è®°å½•ã€‚</p><a id="more"></a><h3 id="1-8-å’Œ-8-0-ç›¸ç­‰å—ï¼Ÿå«ä¹‰ç›¸åŒå—ï¼Ÿ"><a href="#1-8-å’Œ-8-0-ç›¸ç­‰å—ï¼Ÿå«ä¹‰ç›¸åŒå—ï¼Ÿ" class="headerlink" title="1: 8 å’Œ 8.0 ç›¸ç­‰å—ï¼Ÿå«ä¹‰ç›¸åŒå—ï¼Ÿ"></a>1: 8 å’Œ 8.0 ç›¸ç­‰å—ï¼Ÿå«ä¹‰ç›¸åŒå—ï¼Ÿ</h3><ul><li><p>ä»æ•°å€¼å¤§å°æ¯”è¾ƒæ¥è¯´ï¼Œ8.0 å’Œ 8 æ˜¯ç›¸ç­‰çš„ã€‚</p></li><li><p>åœ¨è¿‘ä¼¼æ•°çš„è¡¨ç¤ºä¸­ï¼Œæ•°å­— 8 è¡¨ç¤ºæ•°æ®å€¼ç²¾ç¡®åˆ°ä¸ªä½ï¼Œå¦‚ 7.9ã€8.2 ç­‰æ•°ç²¾ç¡®åˆ°ä¸ªä½éƒ½è¡¨ç¤ºä¸º 8ã€‚è€Œ 8.0 åˆ™è¡¨ç¤ºæ•°æ®ç²¾ç¡®åˆ°ååˆ†ä½ï¼ˆå°æ•°ç‚¹åä¸€ä½ï¼‰ï¼Œå¦‚ 8.02ã€7.99 ç­‰ç²¾ç¡®åˆ°ååˆ†ä½éƒ½è¡¨ç¤ºä¸º 8.0ã€‚å› æ­¤ä»è¿™ä¸ªè§’åº¦çœ‹ä¸¤è€…æ˜¯ä¸åŒçš„</p></li><li><p>ps: çœ‹é—®é¢˜å¾—åˆ†åœºæ™¯â“â“â“</p></li></ul><h3 id="2-è¿›åˆ¶çš„è¡¨ç¤º"><a href="#2-è¿›åˆ¶çš„è¡¨ç¤º" class="headerlink" title="2: è¿›åˆ¶çš„è¡¨ç¤º"></a>2: è¿›åˆ¶çš„è¡¨ç¤º</h3><p><strong>2.1: äºŒäººç±»ä¸ºä»€ä¹ˆä¹ æƒ¯åè¿›åˆ¶ï¼Ÿ</strong></p><ul><li><p>äººç±»æœ€å¼€å§‹è®¡æ•°æ—¶ï¼Œé¦–å…ˆæƒ³åˆ°çš„æ˜¯ç”¨ <code>æ•°æ‰‹æŒ‡</code> çš„æ–¹å¼æ¥è®¡æ•°ï¼Œæ»¡ 10 ä¸ªä»¥åå†å€Ÿä¸€åŒæ‰‹ï¼Œè¿™ç§ <code>ä¾¿æ·æ€§</code> ä½¿å¾—äººç±»ä¹ æƒ¯äºä½¿ç”¨åè¿›åˆ¶ã€‚</p></li><li><p>åè¿›åˆ¶å¯¹æ¯”å…¶ä»–è¿›åˆ¶ï¼ˆå¦‚äºŒè¿›åˆ¶ï¼‰æ›´ç®€æ´ï¼Œæ›´æ˜“è¯†åˆ«ã€‚</p></li></ul><p><strong>2.2: è®¡ç®—æœºä¸ºä»€ä¹ˆè¦ä½¿ç”¨äºŒè¿›åˆ¶ï¼Ÿ</strong></p><ul><li><p>å¦‚æœè®¡ç®—æœºä½¿ç”¨ <code>åè¿›åˆ¶</code>ï¼Œé‚£ä¹ˆéœ€è¦è®©ç”µè„‘èƒ½è¯†åˆ« <code>åè¿›åˆ¶</code> ä¸­çš„åä¸ªæ•°å­—ã€‚å‡è®¾æœ€é«˜ç”µå‹æ˜¯ <code>12V</code>ï¼Œé‚£ä¹ˆ10ä¸ªæ•°å­—ä¸­æ¯ä¸ªæ•°ç ï¼ˆ0~9ï¼‰åˆ†é…åˆ°çš„ç”µå‹åŒºé—´æ˜¯ <code>12 / 9 â‰ˆ 1.3(v)</code>ã€‚è¿™æ ·å¯¼è‡´æ•°ç ä¹‹é—´çš„ç”µå‹é—´éš”å°ï¼Œå¦‚æœå¤–ç•Œå¹²æ‰°é€ æˆç”µå‹å¤§å¹…å˜åŒ–ï¼Œæ•°æ®æ ‡è¯†å°±ä¸å¤ªå‡†ç¡®äº†ã€‚å¦å¤–æœ€å¤§çš„é—®é¢˜æ˜¯ç¡¬ä»¶ä¸Šè¦æ ‡è¯†åç§çŠ¶æ€çš„è¯ï¼Œå…¶ç”µè·¯æ„é€ çš„å¤æ‚åº¦å°±éå¸¸å¤æ‚äº†</p></li><li><p>äºŒè¿›åˆ¶çš„æŠ€æœ¯å®ç°æ¯”è¾ƒç®€å•ã€‚é€»è¾‘ç”µè·¯é€šå¸¸å°±åªæœ‰ä¸¤ç§çŠ¶æ€ [å¼€ or å…³]</p></li><li><p>è¿ç®—è§„åˆ™ç®€å•ï¼Œåˆ©äºç®€åŒ–è®¡ç®—æœºå†…éƒ¨ç»“æ„ï¼Œæé«˜è¿ç®—é€Ÿåº¦</p></li><li><p>é€‚åˆäºé€»è¾‘è¿ç®—</p></li><li><p>äºŒè¿›åˆ¶æ˜“äºå’Œåˆ«çš„è¿›åˆ¶è¿›è¡Œè½¬æ¢</p></li><li><p>æŠ—å¹²æ‰°èƒ½åŠ›å¼ºğŸ‘ã€‚å› ä¸ºæ¯ä½æ•°ç åªæœ‰é«˜ä½ä¸¤ç§çŠ¶æ€ï¼Œå½“å—åˆ°ä¸€å®šç¨‹åº¦çš„å¹²æ‰°æ—¶ï¼Œä»èƒ½å¯é çš„åˆ†è¾¨å‡ºæ˜¯ <code>é«˜ç”µå¹³</code>è¿˜æ˜¯ <code>ä½ç”µå¹³</code>    </p></li></ul><p><strong>2.3: äºŒè¿›åˆ¶çš„è¿ç®—</strong></p><ul><li><p>åŠ æ³•</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">0 + 0 = 0</span><br><span class="line">0 + 1 = 1</span><br><span class="line">1 + 0 = 1</span><br><span class="line">1 + 1 = 10(é€¢2è¿›1)</span><br></pre></td></tr></table></figure></li><li><p>å‡æ³•</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">0 - 0 = 0</span><br><span class="line">0 - 1 = 1ï¼ˆå€Ÿ1å½“2ï¼‰</span><br><span class="line">1 - 0 = 1</span><br><span class="line">1 - 1 = 0</span><br></pre></td></tr></table></figure></li><li><p>ä¹˜æ³•</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">0 * 0 = 0</span><br><span class="line">0 * 1 = 0</span><br><span class="line">1 * 0 = 0</span><br><span class="line">1 * 1 = 1</span><br></pre></td></tr></table></figure></li><li><p>é™¤æ³•</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">0 / 0 (æ— æ„ä¹‰)</span><br><span class="line">0 / 1 = 0</span><br><span class="line">1 / 0 (æ— æ„ä¹‰)</span><br><span class="line">1 / 1 = 1</span><br></pre></td></tr></table></figure></li></ul>]]></content>
      
      
      <categories>
          
          <category> æ•°å­¦ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ•°å­¦ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>MySQL ç´¢å¼•é‚£äº›äº‹å„¿ä¸€</title>
      <link href="/2019/08/17/MySQL-%E7%B4%A2%E5%BC%95%E9%82%A3%E4%BA%9B%E4%BA%8B%E5%84%BF/"/>
      <url>/2019/08/17/MySQL-%E7%B4%A2%E5%BC%95%E9%82%A3%E4%BA%9B%E4%BA%8B%E5%84%BF/</url>
      
        <content type="html"><![CDATA[<p><strong>ç´¢å¼•å®šä¹‰</strong>: ç´¢å¼•æ˜¯å¸®åŠ© <code>MySQL</code> é«˜æ•ˆè·å–æ•°æ®çš„ <strong>æ•°æ®ç»“æ„</strong>ï¼ˆå®˜æ–¹ï¼‰ã€‚ç®€å•ç†è§£å°±æ˜¯ <code>æ’å¥½åºçš„å¿«é€ŸæŸ¥æ‰¾æ•°æ®ç»“æ„</code>ã€‚</p><a id="more"></a><p>åœ¨æ•°æ®åº“ç³»ç»Ÿä¸­ï¼Œé™¤äº†ä¿å­˜æ•°æ®ä¹‹å¤–ï¼Œæ•°æ®åº“ç³»ç»Ÿè¿˜ç»´æŠ¤ç€ <code>æ»¡è¶³ç‰¹å®šæŸ¥æ‰¾ç®—æ³•</code> çš„ <code>æ•°æ®ç»“æ„</code>ï¼Œè¿™äº›æ•°æ®ç»“æ„ä»¥æŸç§æ–¹å¼å¼•ç”¨ï¼ˆæŒ‡å‘ï¼‰æ•°æ®ï¼Œè¿™æ ·å°±å¯ä»¥åœ¨è¿™äº›æ•°æ®ç»“æ„ä¸Šå®ç°é«˜çº§æŸ¥æ‰¾ç®—æ³•ï¼Œè¿™ç§æ•°æ®ç»“æ„å°±æˆä¸ºç´¢å¼•ã€‚</p><p>é€šå¸¸æ¥è¯´ç´¢å¼•æœ¬èº«ä¹Ÿæ˜¯ä¼šå ç”¨å¾ˆå¤§çš„å­˜å‚¨ç©ºé—´ï¼Œä¸å¯èƒ½å…¨éƒ¨å­˜å‚¨åœ¨å†…å­˜ä¸­ã€‚å› æ­¤ç´¢å¼•å¾€å¾€ä»¥ç´¢å¼•æ–‡ä»¶å½¢å¼å­˜å‚¨åœ¨ç£ç›˜ä¸Šã€‚</p><h4 id="ä¸€-ç´¢å¼•ä¼˜ç¼ºç‚¹"><a href="#ä¸€-ç´¢å¼•ä¼˜ç¼ºç‚¹" class="headerlink" title="ä¸€: ç´¢å¼•ä¼˜ç¼ºç‚¹"></a>ä¸€: ç´¢å¼•ä¼˜ç¼ºç‚¹</h4><ul><li><p>ä¼˜ç‚¹:</p><ul><li><p>ç±»ä¼¼äºä¹¦ç±çš„ç›®å½•ç´¢å¼•ï¼Œæé«˜äº†æ•°æ®æ£€ç´¢çš„æ•ˆç‡ï¼Œé™ä½æ•°æ®åº“ <code>IO</code> æˆæœ¬</p></li><li><p>é€šè¿‡ç´¢å¼•åˆ—å¯¹æ•°æ®è¿›è¡Œæ’åºï¼Œé™ä½æ•°æ®æ’åºçš„æˆæœ¬ï¼Œä»è€Œé™ä½ <code>CPU</code> è®¡ç®—çš„æ¶ˆè€—</p></li></ul></li><li><p>ç¼ºç‚¹:</p><ul><li><p>å®é™…ä¸Š <code>ç´¢å¼•ä¹Ÿæ˜¯ä¸€å¼ è¡¨</code>ï¼Œè¯¥è¡¨ä¿ç•™äº†ä¸»é”®å’Œç´¢å¼•å­—æ®µï¼Œå¹¶æŒ‡å‘å®ä½“è¡¨çš„è®°å½•ã€‚</p></li><li><p>ç´¢å¼•è™½ç„¶æé«˜äº†æŸ¥è¯¢é€Ÿåº¦ï¼Œä½†åŒæ—¶ä¹Ÿé™ä½äº†æ›´æ–°è¡¨çš„é€Ÿåº¦ï¼Œå¦‚å½“å¯¹è¡¨è¿›è¡Œ insert, update, delete æ“ä½œæ—¶ã€‚å› ä¸ºæ›´æ–°è¡¨æ—¶ï¼Œéœ€è¦é‡å»ºç´¢å¼•ã€‚</p></li></ul></li></ul><h4 id="äºŒ-ç´¢å¼•åˆ†ç±»"><a href="#äºŒ-ç´¢å¼•åˆ†ç±»" class="headerlink" title="äºŒ: ç´¢å¼•åˆ†ç±»"></a>äºŒ: ç´¢å¼•åˆ†ç±»</h4><ul><li><p>å•å€¼ç´¢å¼•: ä¸€ä¸ªç´¢å¼•å€¼åŒ…å«ä¸€ä¸ªåˆ—ï¼Œä¸€ä¸ªè¡¨å¯ä»¥æœ‰å¤šä¸ªå•åˆ—ç´¢å¼•</p></li><li><p>å”¯ä¸€ç´¢å¼•: ç´¢å¼•åˆ—çš„å€¼å¿…é¡»å”¯ä¸€ï¼Œå•å…è®¸ç©ºå€¼</p></li><li><p>å¤åˆç´¢å¼•: ä¸€ä¸ªç´¢å¼•åŒ…å«å¤šä¸ªåˆ—</p></li></ul><h4 id="ä¸‰-ç´¢å¼•åˆ›å»ºã€åˆ é™¤åŠæŸ¥çœ‹"><a href="#ä¸‰-ç´¢å¼•åˆ›å»ºã€åˆ é™¤åŠæŸ¥çœ‹" class="headerlink" title="ä¸‰: ç´¢å¼•åˆ›å»ºã€åˆ é™¤åŠæŸ¥çœ‹"></a>ä¸‰: ç´¢å¼•åˆ›å»ºã€åˆ é™¤åŠæŸ¥çœ‹</h4><ul><li><p>åˆ›å»º</p><p>  <code>create [unique] index indexName on tableName(colName(length))</code></p><p>  <code>alter table tableName add [unique] index indexName(colName1, ... , colNameN)</code></p></li><li><p>åˆ é™¤</p><p>  <code>Drop index indexName on tableName</code></p></li><li><p>æŸ¥çœ‹</p><p>  <code>show index from taleName</code></p></li></ul><h4 id="å››-ç´¢å¼•çš„ä½¿ç”¨åœºæ™¯"><a href="#å››-ç´¢å¼•çš„ä½¿ç”¨åœºæ™¯" class="headerlink" title="å››: ç´¢å¼•çš„ä½¿ç”¨åœºæ™¯"></a>å››: ç´¢å¼•çš„ä½¿ç”¨åœºæ™¯</h4><ul><li><p>ä½¿ç”¨ç´¢å¼•</p><ul><li><p>1: ä¸»é”®è‡ªåŠ¨å»ºç«‹å”¯ä¸€ç´¢å¼•</p></li><li><p>2: é¢‘ç¹ä½œä¸ºæŸ¥è¯¢æ¡ä»¶çš„å­—æ®µåº”è¯¥å»ºç«‹ç´¢å¼•</p></li><li><p>3: æŸ¥è¯¢ä¸­å·²å…¶ä»–è¡¨å…³è”çš„å­—æ®µï¼Œå¤–é”®å…³ç³»å»ºç«‹ç´¢å¼•</p></li><li><p>4: é¢‘ç¹æ›´æ–°çš„ä¸é€‚åˆå»ºç«‹ç´¢å¼•</p></li><li><p>5: æŸ¥è¯¢ä¸­æ’åºçš„å­—æ®µå»ºç«‹ç´¢å¼•å¯æé«˜æ’åºé€Ÿåº¦</p></li><li><p>6: æŸ¥è¯¢ä¸­ç»Ÿè®¡æˆ–è€…åˆ†ç»„å­—æ®µ</p></li></ul></li></ul><ul><li><p>ä¸ä½¿ç”¨ç´¢å¼•</p><ul><li><p>1: è¡¨è®°å½•å¤ªå°‘</p></li><li><p>2: ç»å¸¸å¢åˆ æ”¹çš„å­—æ®µ</p></li><li><p>3: æ•°æ®é‡å¤ä¸”åˆ†å¸ƒå¹³å‡çš„è¡¨å­—æ®µï¼ˆå¦‚æ€§åˆ«ï¼‰ï¼Œè¿™ç§åœºæ™¯ä¸‹å»ºç«‹ç´¢å¼•æ²¡æœ‰ä»»ä½•æ•ˆæœã€‚</p><ul><li><code>ç´¢å¼•çš„é€‰æ‹©æ€§</code> æ˜¯æŒ‡ç´¢å¼•åˆ—ä¸­çš„ä¸åŒå€¼çš„æ•°ç›®ä¸è¡¨ä¸­è®°å½•æ•°çš„æ¯”ã€‚å¦‚æœä¸€ä¸ªè¡¨æœ‰ 2000 æ¡è®°å½•ï¼Œè¡¨ç´¢å¼•åˆ—æœ‰ 1980 ä¸ªä¸åŒçš„å€¼ã€‚<code>ç´¢å¼•çš„é€‰æ‹©æ€§ä¸º 1980 / 2000 = 0.99</code>ï¼›ç´¢å¼•çš„é€‰æ‹©æ€§è¶Šæ¥è¿‘1ï¼Œè¿™ä¸ªç´¢å¼•çš„æ•ˆç‡è¶Šé«˜ã€‚</li></ul></li></ul></li></ul><h4 id="äº”-B-Tree-æ£€ç´¢åŸç†"><a href="#äº”-B-Tree-æ£€ç´¢åŸç†" class="headerlink" title="äº”: B Tree æ£€ç´¢åŸç†"></a>äº”: <code>B Tree</code> æ£€ç´¢åŸç†</h4><p><img src="/images/blog/201908/6-MySQL-Btree%E6%A3%80%E7%B4%A2%E5%8E%9F%E7%90%86.jpeg" alt="6-MySQL Btreeæ£€ç´¢åŸç†"></p><p>ã€<strong>åˆå§‹åŒ–ä»‹ç»</strong>ã€‘</p><p>è¿™æ˜¯ä¸€ä¸ª <code>B+æ ‘ğŸŒ²</code> , ç»¿è‰²çš„è‰²å—æ˜¯ä¸€ä¸ªä¸ªçš„ç£ç›˜å—ï¼Œæ¯ä¸ªç£ç›˜å—åŒ…æ‹¬å‡ ä¸ªæ•°æ®é¡¹ï¼ˆè“è‰²è‰²å—ï¼‰å’ŒæŒ‡é’ˆï¼ˆæ©™è‰²è‰²å—ï¼‰ã€‚å¦‚ç£ç›˜å—1åŒ…å«æ•°æ®é¡¹ 17 å’Œ 35ï¼ŒåŒ…å«æŒ‡é’ˆ <code>P1,P2,P3</code>ã€‚P1æŒ‡å‘å°äº17çš„ç£ç›˜å—ï¼ŒP2æŒ‡å‘17å’Œ35ä¹‹é—´çš„ç£ç›˜å—ï¼ŒP3è¡¨ç¤ºå¤§äº35çš„ç£ç›˜å—ã€‚</p><p>çœŸå®çš„æ•°æ®å­˜åœ¨äºå¶å­ğŸƒèŠ‚ç‚¹ï¼Œå³æ˜¯ <code>3, 5, 9, 10, 13, 15, 28, 29, 36, 60, 75, 79, 90, 99</code></p><p>éå¶å­èŠ‚ç‚¹ä¸å­˜å‚¨çœŸå®çš„æ•°æ®ï¼Œåªå­˜å‚¨æŒ‡å‘æœç´¢æ–¹å‘çš„æ•°æ®é¡¹</p><p>ã€<strong>æŸ¥æ‰¾è¿‡ç¨‹ï¼Œä»¥æ•°å­—29ä¸¾ä¾‹</strong>ã€‘</p><p>1: é¦–å…ˆæŠŠç£ç›˜å—1ç”±ç£ç›˜åŠ è½½åˆ°å†…å­˜ä¸­ï¼Œæ­¤æ—¶å‘ç”Ÿ <code>ç¬¬ä¸€æ¬¡IO</code>ï¼Œåœ¨å†…å­˜ä¸­ä½¿ç”¨äºŒåˆ†æŸ¥æ‰¾ç¡®å®š29åœ¨17å’Œ35ä¹‹é—´ï¼Œä»è€Œç¡®å®šä½¿ç”¨ç£ç›˜å—1çš„P2æŒ‡é’ˆã€‚</p><p>2: ç”±äºP2æŒ‡å‘ç£ç›˜å—3ï¼Œæ­¤æ—¶å°†ç£ç›˜å—3ç”±ç£ç›˜åŠ è½½è‡³å†…å­˜ä¸­ï¼Œå‘ç”Ÿ <code>ç¬¬äºŒæ¬¡IO</code>ã€‚</p><p>3: 29åœ¨26å’Œ30ä¹‹é—´ï¼Œä»è€Œç¡®å®šä½¿ç”¨ç£ç›˜å—3çš„P2æŒ‡é’ˆï¼Œé€šè¿‡æŒ‡é’ˆåŠ è½½ç£ç›˜å—8åˆ°å†…å­˜ä¸­ï¼Œå‘ç”Ÿ <code>ç¬¬ä¸‰æ¬¡IO</code>ï¼ŒåŒæ—¶å†…å­˜ä¸­ä½¿ç”¨äºŒåˆ†æŸ¥æ‰¾æ‰¾åˆ°29ã€‚</p><hr><p><strong>Q1: ä¸ºä»€ä¹ˆæ•°æ®è¡¨è®°å½•çš„åˆ é™¤å¤šä½¿ç”¨è½¯åˆ é™¤ï¼Ÿ</strong></p><ul><li><p>ä¿ç•™æ•°æ®è®°å½•ï¼Œä¸ºäº†æ•°æ®åˆ†æ</p></li><li><p>ä¸ºäº†ä¿ç•™åŸæ¥åŸæ¥ç´¢å¼•ï¼ŒåŸå› åˆ é™¤å…ƒç´ éœ€è¦é‡å»ºç´¢å¼•</p></li></ul><!--more-->]]></content>
      
      
      <categories>
          
          <category> æ•°æ®åº“ </category>
          
          <category> MySQL </category>
          
      </categories>
      
      
        <tags>
            
            <tag> MySQL </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>MySQLæ¶æ„ä½“ç³»åŠSQLæŸ¥è¯¢æ‰§è¡Œæµç¨‹åˆæ¢</title>
      <link href="/2019/08/17/MySQL%E6%9E%B6%E6%9E%84%E4%BD%93%E7%B3%BB%E5%8F%8ASQL%E6%9F%A5%E8%AF%A2%E6%89%A7%E8%A1%8C%E6%B5%81%E7%A8%8B%E5%88%9D%E6%8E%A2/"/>
      <url>/2019/08/17/MySQL%E6%9E%B6%E6%9E%84%E4%BD%93%E7%B3%BB%E5%8F%8ASQL%E6%9F%A5%E8%AF%A2%E6%89%A7%E8%A1%8C%E6%B5%81%E7%A8%8B%E5%88%9D%E6%8E%A2/</url>
      
        <content type="html"><![CDATA[<p>ç®€è¿°: è‡ªå·¥ä½œä»¥æ¥ï¼Œå¤§éƒ¨åˆ†çš„æ—¶é—´æ¥è§¦çš„å…³ç³»å‹éƒ½æ˜¯ <code>MySQL</code> æ•°æ®åº“ç³»ç»Ÿï¼Œä½†ä½¿ç”¨éƒ½æ¯”è¾ƒæµ…æ˜¾åŸºç¡€(<code>CRUD</code>)ã€‚æœ€è¿‘æ‰“ç®—é‡æ–°æ·±å…¥å­¦ä¹ ä¸‹ <code>MySQL</code>ï¼Œå®‰è£…çš„ç‰ˆæœ¬æ˜¯ <code>5.7.21</code>ï¼Œå­¦ä¹ è®°å½•äºæ­¤ï¼Œä¾¿æ—¥åæ¸©ä¹ æŸ¥çœ‹ã€‚</p><p>é¦–å…ˆæ¥çœ‹çœ‹ <code>MySQL</code> çš„æ¶æ„å›¾ï¼Œç„¶åä¾æ¬¡æ¥çœ‹çœ‹æ¯ä¸€éƒ¨åˆ†æ˜¯åšä»€ä¹ˆçš„ã€‚</p><a id="more"></a><p><img src="/images/blog/201908/3-MySQL%E4%BD%93%E7%B3%BB%E6%9E%B6%E6%9E%84%E5%9B%BE.jpg" alt></p><h4 id="1ï¼šClient"><a href="#1ï¼šClient" class="headerlink" title="1ï¼šClient"></a>1ï¼šClient</h4><p><code>è¿æ¥å™¨ï¼ˆConnectorsï¼‰</code>ï¼Œä¹Ÿå°±æ˜¯é€šå¸¸æ‰€è¯´çš„ MySQL å®¢æˆ·ç«¯ã€‚ä¸åŒçš„ç¼–ç¨‹è¯­è¨€æä¾›äº†å¯¹åº”çš„ <code>API</code> ä¸ MySQL æœåŠ¡ç³»ç»Ÿè¿›è¡Œäº¤äº’é€šè®¯ã€‚</p><ul><li>é€šè¿‡ <code>show variables like &#39;%connection%;</code> æ¥æŸ¥çœ‹ MySQl æœåŠ¡å™¨çš„è¿æ¥ä¿¡æ¯ã€‚é»˜è®¤æœ€å¤§è¿æ¥æ•°æ˜¯151ã€‚</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show variables like &apos;%connection%&apos;;</span><br><span class="line">+--------------------------+-----------------+</span><br><span class="line">| Variable_name            | Value           |</span><br><span class="line">+--------------------------+-----------------+</span><br><span class="line">| character_set_connection | utf8            |</span><br><span class="line">| collation_connection     | utf8_general_ci |</span><br><span class="line">| max_connections          | 151             |</span><br><span class="line">| max_user_connections     | 0               |</span><br><span class="line">+--------------------------+-----------------+</span><br></pre></td></tr></table></figure><h4 id="2ï¼šMySQL-Server"><a href="#2ï¼šMySQL-Server" class="headerlink" title="2ï¼šMySQL Server"></a>2ï¼šMySQL Server</h4><p>Server å±‚æ˜¯ MySQL æä¾›æœåŠ¡çš„æ ¸å¿ƒã€‚ä¸»è¦åˆ†ä¸ºä»¥ä¸‹å‡ ä¸ªæ¨¡å—ï¼ˆæŸ¥è¯¢ç¼“å­˜ <code>MySQL8.0</code> ç‰ˆæœ¬è¢«åˆ é™¤ï¼Œæ•…æ­¤ä¸åšè®°å½•ğŸ“ï¼‰</p><h5 id="2-1ï¼šConnection-Poolï¼ˆè¿æ¥æ± ï¼‰"><a href="#2-1ï¼šConnection-Poolï¼ˆè¿æ¥æ± ï¼‰" class="headerlink" title="2.1ï¼šConnection Poolï¼ˆè¿æ¥æ± ï¼‰"></a>2.1ï¼šConnection Poolï¼ˆè¿æ¥æ± ï¼‰</h5><p>è¿æ¥æ± ä¸»è¦å®ç°ä»¥ä¸‹åŠŸèƒ½</p><h6 id="2-1-1ï¼šAuthenticationï¼ˆè¿›è¡Œèº«ä»½éªŒè¯ï¼‰"><a href="#2-1-1ï¼šAuthenticationï¼ˆè¿›è¡Œèº«ä»½éªŒè¯ï¼‰" class="headerlink" title="2.1.1ï¼šAuthenticationï¼ˆè¿›è¡Œèº«ä»½éªŒè¯ï¼‰**"></a>2.1.1ï¼šAuthenticationï¼ˆè¿›è¡Œèº«ä»½éªŒè¯ï¼‰**</h6><p><code>terminal</code> ä¸‹è¿æ¥å‘½ä»¤å¦‚ä¸‹ <code>mysql -u root -h localhost - p</code>ã€‚å¦‚æœç”¨æˆ·åå¯†ç è®¤è¯é€šè¿‡ï¼Œè¿æ¥å™¨ä¼šåˆ° <code>æƒé™è¡¨</code> é‡Œé¢æŸ¥å‡ºç”¨æˆ·æ‹¥æœ‰çš„æƒé™ã€‚ä¹‹åï¼Œè¿™ä¸ªè¿æ¥é‡Œé¢çš„æƒé™åˆ¤æ–­é€»è¾‘ï¼Œéƒ½å°†ä¾èµ–äºæ­¤æ—¶è¯»åˆ°çš„æƒé™ã€‚</p><p>ä¸€æ—¦ä¸€ä¸ªç”¨æˆ·æˆåŠŸå»ºç«‹è¿æ¥åï¼Œå³ä½¿ä½ ç”¨ç®¡ç†å‘˜è´¦å·å¯¹è¿™ä¸ªç”¨æˆ·çš„æƒé™åšäº†ä¿®æ”¹ï¼Œä¹Ÿä¸ä¼šå½±å“å·²ç»å­˜åœ¨è¿æ¥çš„æƒé™ã€‚ä¿®æ”¹å®Œæˆåï¼Œåªæœ‰å†æ–°å»ºçš„è¿æ¥æ‰ä¼šä½¿ç”¨æ–°çš„æƒé™è®¾ç½®ã€‚</p><p>è¿æ¥å®Œæˆåå¦‚æœæ²¡æœ‰ä½¿ç”¨ï¼Œè¯¥è¿æ¥å°±å¤„äº <code>Sleep</code> çŠ¶æ€ã€‚å¦‚æœè¶…è¿‡ MySQL æœåŠ¡å™¨é…ç½®çš„ <code>wait_time</code> å€¼ï¼Œå¯é€šè¿‡ <code>show variables like &#39;%wait%&#39;;</code> æŸ¥çœ‹è¯¥å€¼ï¼Œé»˜è®¤æ˜¯ <code>28800</code> ç§’ï¼Œè¯¥è¿æ¥å°±ä¼šè¢«å›æ”¶ï¼Œä½¿ç”¨æ—¶å°±éœ€è¦é‡æ–°å»ºç«‹è¿æ¥äº†ã€‚</p><p>å¦‚æœå®¢æˆ·ç«¯æŒç»­æœ‰è¯·æ±‚ï¼Œåˆ™ä¸€ç›´ä½¿ç”¨åŒä¸€ä¸ªè¿æ¥ï¼Œåˆ™ç§°è¯¥è¿æ¥ä¸ºé•¿è¿æ¥ã€‚çŸ­è¿æ¥åˆ™æ˜¯æŒ‡æ¯æ¬¡æ‰§è¡Œå®Œå¾ˆå°‘çš„å‡ æ¬¡æŸ¥è¯¢å°±æ–­å¼€è¿æ¥ï¼Œä¸‹æ¬¡æŸ¥è¯¢å†é‡æ–°å»ºç«‹ä¸€ä¸ªã€‚ç”±äºå»ºç«‹è¿æ¥æ¯”è¾ƒå¤æ‚ï¼Œåº”å½“å‡å°‘è¿æ¥çš„æ“ä½œè€Œä½¿ç”¨é•¿è¿æ¥ã€‚ä½†æ˜¯è¿‡å¤šä½¿ç”¨é•¿è¿æ¥ä¼šä½¿å¾—å†…å­˜é£™å‡ï¼ˆå› ä¸º MySQL åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ä¸´æ—¶ä½¿ç”¨çš„å†…å­˜æ˜¯ç®¡ç†åœ¨è¿æ¥å¯¹è±¡é‡Œé¢çš„ã€‚è¿™äº›èµ„æºä¼šåœ¨è¿æ¥æ–­å¼€çš„æ—¶å€™æ‰é‡Šæ”¾ï¼‰å¯¼è‡´ MySQL å¼‚å¸¸é‡å¯ã€‚</p><p><strong>è§£å†³æ–¹æ¡ˆ1</strong> ï¼šå®šæœŸæ–­å¼€é•¿è¿æ¥ã€‚ä½¿ç”¨ä¸€æ®µæ—¶é—´åæˆ–è€…ç¨‹åºé‡Œé¢åˆ¤æ–­æ‰§è¡Œè¿‡ä¸€ä¸ªå ç”¨å†…å­˜çš„å¤§æŸ¥è¯¢åï¼Œå®šæœŸæ–­å¼€è¿æ¥ï¼Œä¹‹åè¦æŸ¥è¯¢æ—¶å†é‡æ–°å»ºç«‹è¿æ¥ï¼›</p><p><strong>è§£å†³æ–¹æ¡ˆ2</strong> ï¼šå¯¹äº MySQL 5.7 åŠåç»­ç‰ˆæœ¬ï¼Œå¯ä»¥åœ¨æ¯æ¬¡æ‰§è¡Œä¸€ä¸ªæ¯”è¾ƒå¤§çš„æ“ä½œåï¼Œé€šè¿‡æ‰§è¡Œ mysql_reset_connection æ¥é‡æ–°åˆå§‹åŒ–è¿æ¥èµ„æºã€‚è¿™ä¸ªè¿‡ç¨‹ä¸éœ€è¦é‡è¿å’Œé‡æ–°åšæƒé™éªŒè¯ï¼Œä½†æ˜¯ä¼šå°†è¿æ¥æ¢å¤åˆ°åˆšåˆšåˆ›å»ºå®Œæ—¶çš„çŠ¶æ€ã€‚</p><h6 id="2-1-2ï¼šThread-Reuseï¼ˆçº¿ç¨‹é‡ç”¨ï¼‰"><a href="#2-1-2ï¼šThread-Reuseï¼ˆçº¿ç¨‹é‡ç”¨ï¼‰" class="headerlink" title="2.1.2ï¼šThread Reuseï¼ˆçº¿ç¨‹é‡ç”¨ï¼‰"></a>2.1.2ï¼šThread Reuseï¼ˆçº¿ç¨‹é‡ç”¨ï¼‰</h6><h6 id="2-1-3ï¼šConnection-Limitsï¼ˆè¿æ¥é™åˆ¶"><a href="#2-1-3ï¼šConnection-Limitsï¼ˆè¿æ¥é™åˆ¶" class="headerlink" title="2.1.3ï¼šConnection Limitsï¼ˆè¿æ¥é™åˆ¶)"></a>2.1.3ï¼šConnection Limitsï¼ˆè¿æ¥é™åˆ¶)</h6><h6 id="2-1-4ï¼šCheck-Memory-å†…å­˜æ£€æµ‹"><a href="#2-1-4ï¼šCheck-Memory-å†…å­˜æ£€æµ‹" class="headerlink" title="2.1.4ï¼šCheck Memory (å†…å­˜æ£€æµ‹)"></a>2.1.4ï¼šCheck Memory (å†…å­˜æ£€æµ‹)</h6><h6 id="2-1-5ï¼šç¼“å­˜"><a href="#2-1-5ï¼šç¼“å­˜" class="headerlink" title="2.1.5ï¼šç¼“å­˜"></a>2.1.5ï¼šç¼“å­˜</h6><p>æ¯ä¸ªå®¢æˆ·ç«¯è¿æ¥éƒ½ä¼šåœ¨æœåŠ¡å™¨è¿›ç¨‹ä¸­æ‹¥æœ‰ä¸€ä¸ªçº¿ç¨‹ï¼Œè¿™ä¸ªè¿æ¥çš„æŸ¥è¯¢åªä¼šåœ¨è¿™ä¸ªå•ç‹¬çš„çº¿ç¨‹ä¸­æ‰§è¡Œï¼Œè¯¥çº¿ç¨‹åªèƒ½è½®æµåœ¨æŸä¸ª <code>cpu</code> ä¸Šè¿è¡Œï¼ŒæœåŠ¡å™¨ä¼šè´Ÿè´£ç¼“å­˜çº¿ç¨‹ã€‚å› æ­¤ï¼Œä¸éœ€è¦ä¸ºæ¯ä¸€ä¸ªæ–°å»ºçš„è¿æ¥åˆ›å»ºæˆ–é”€æ¯çº¿ç¨‹ï¼Œæˆ–è€…ç›´æ¥ä½¿ç”¨çº¿ç¨‹æ± åŠŸèƒ½ï¼Œæ¥ç»´æŠ¤å¤§é‡çš„å¯ç”¨è¿æ¥ã€‚</p><hr><h5 id="2-2ï¼šSQL-Interfaceï¼ˆSQL-æ¥å£ï¼‰"><a href="#2-2ï¼šSQL-Interfaceï¼ˆSQL-æ¥å£ï¼‰" class="headerlink" title="2.2ï¼šSQL Interfaceï¼ˆSQL æ¥å£ï¼‰"></a>2.2ï¼šSQL Interfaceï¼ˆSQL æ¥å£ï¼‰</h5><p>ç”¨äºæ‰§è¡Œ <code>DML</code>, <code>DDL</code>, å­˜å‚¨è¿‡ç¨‹, è§†å›¾, è§¦å‘å™¨ç­‰ã€‚æ¥æ”¶å®¢æˆ·ç«¯å‘æ¥çš„sqlè¯·æ±‚æŸ¥è¯¢ï¼Œå¹¶è¿”å›éœ€è¦æŸ¥è¯¢çš„ç»“æ„ã€‚</p><h5 id="2-3ï¼šParserï¼ˆè§£æå™¨ï¼‰"><a href="#2-3ï¼šParserï¼ˆè§£æå™¨ï¼‰" class="headerlink" title="2.3ï¼šParserï¼ˆè§£æå™¨ï¼‰"></a>2.3ï¼šParserï¼ˆè§£æå™¨ï¼‰</h5><p>è§£æå™¨é€šè¿‡å…³é”®å­—å°†SQLè¯­å¥è¿›è¡Œè§£æï¼ˆ<strong>è¯æ³•åˆ†æ + é¢„å‘åˆ†æ</strong>ï¼‰ï¼Œå¹¶ç”Ÿæˆå¯¹åº”çš„æ•°æ®ç»“æ„ï¼ˆè§£ææ ‘ï¼‰ã€‚ç„¶åå¯¹å…¶è¿›è¡Œå„ç§ä¼˜åŒ–ï¼ŒåŒ…æ‹¬é‡å†™æŸ¥è¯¢ï¼Œå†³å®šæŸ¥è¯¢çš„è¯»å†™é¡ºåºï¼Œä»¥åŠé€‰æ‹©é¡»ä½¿ç”¨çš„ç´¢å¼•ç­‰ã€‚MySQLè§£æå™¨å°†ä½¿ç”¨MySQLè¯­æ³•è§„åˆ™éªŒè¯å’Œè§£ææŸ¥è¯¢ã€‚</p><p>é¢„å¤„ç†å™¨åˆ™æ ¹æ®ä¸€äº›MySQLè§„åˆ™è¿›è¡Œè¿›ä¸€æ­¥æ£€æŸ¥è§£æä¹¦æ˜¯å¦åˆæ³•ï¼Œä¾‹å¦‚æ£€æŸ¥æ•°æ®è¡¨å’Œæ•°æ®åˆ—æ˜¯å¦å­˜åœ¨ï¼Œè¿˜ä¼šè§£æåå­—å’Œåˆ«åï¼Œçœ‹çœ‹å®ƒä»¬æ˜¯å¦æœ‰æ­§ä¹‰ã€‚</p><h5 id="2-4ï¼šOptimizerï¼ˆä¼˜åŒ–å™¨ï¼‰"><a href="#2-4ï¼šOptimizerï¼ˆä¼˜åŒ–å™¨ï¼‰" class="headerlink" title="2.4ï¼šOptimizerï¼ˆä¼˜åŒ–å™¨ï¼‰"></a>2.4ï¼šOptimizerï¼ˆä¼˜åŒ–å™¨ï¼‰</h5><p>ä¼˜åŒ–å™¨ä¼šå°† <code>è§£ææ ‘</code> è½¬åŒ–æˆ <code>æ‰§è¡Œè®¡åˆ’</code>ã€‚ä¸€æ¡æŸ¥è¯¢å¯ä»¥æœ‰å¤šç§æ‰§è¡Œæ–¹æ³•ï¼Œæœ€åéƒ½æ˜¯è¿”å›ç›¸åŒç»“æœã€‚ä¼˜åŒ–å™¨çš„ä½œç”¨å°±æ˜¯ <strong>æ‰¾åˆ°è¿™å…¶ä¸­æœ€å¥½çš„æ‰§è¡Œè®¡åˆ’</strong>ã€‚ç”Ÿæˆæ‰§è¡Œè®¡åˆ’çš„è¿‡ç¨‹ä¼šæ¶ˆè€—è¾ƒå¤šçš„æ—¶é—´ï¼Œç‰¹åˆ«æ˜¯å­˜åœ¨è®¸å¤šå¯é€‰çš„æ‰§è¡Œè®¡åˆ’æ—¶ã€‚</p><p>å¦‚æœåœ¨ä¸€æ¡SQLè¯­å¥æ‰§è¡Œçš„è¿‡ç¨‹ä¸­å°†è¯¥è¯­å¥å¯¹åº”çš„æœ€ç»ˆæ‰§è¡Œè®¡åˆ’è¿›è¡Œç¼“å­˜ï¼Œå½“ç›¸ä¼¼çš„è¯­å¥å†æ¬¡è¢«è¾“å…¥æœåŠ¡å™¨æ—¶ï¼Œå°±å¯ä»¥ç›´æ¥ä½¿ç”¨å·²ç¼“å­˜çš„æ‰§è¡Œè®¡åˆ’ï¼Œä»è€Œè·³è¿‡SQLè¯­å¥ç”Ÿæˆæ‰§è¡Œè®¡åˆ’çš„æ•´ä¸ªè¿‡ç¨‹ï¼Œè¿›è€Œå¯ä»¥æé«˜è¯­å¥çš„æ‰§è¡Œé€Ÿåº¦ã€‚</p><p>egï¼šæ€ä¹ˆä½¿ç”¨ç´¢å¼•ï¼Œæ€ä¹ˆå¤„ç†è¡¨çš„ Join ä¼˜åŒ–å™¨å¤„ç†</p><blockquote><p>ä¾‹å¦‚ä¸€ä¸ªæ•°æ®è¡¨å»ºç«‹çš„ç»„åˆç´¢å¼• idx_table_c1c2c3c4, å½“æŸ¥è¯¢æ¡ä»¶ä¸º <code>where c3=&#39;c3&#39; and c2=&#39;c2&#39;  and c4=&#39;c4&#39; and c1=&#39;c1&#39;;</code> æ—¶æŸ¥è¯¢ä¼˜åŒ–å™¨ä¼šè‡ªåŠ¨è°ƒæ•´å’Œä¼˜åŒ–ï¼Œæ­¤æ—¶ç­‰ä»·äº <code>where c1=&#39;c1&#39; and c2=&#39;c2&#39;  and c4=&#39;c4&#39; and c3=&#39;c3&#39;;</code>ã€‚ä½†æ˜¯æœ€ä½³å®è·µæ˜¯æŒ‰ç…§ç´¢å¼•å»ºç«‹çš„é¡ºåºæ¥ä½¿ç”¨ï¼Œä»¥æ­¤æ¥å‡å°‘åº•å±‚ä¼˜åŒ–å™¨çš„å·¥ä½œé‡ã€‚</p></blockquote><p>è§£æå™¨ï¼Œé¢„å¤„ç†å™¨ï¼Œä¼˜åŒ–å™¨å¤„ç†æµç¨‹ <a href="https://zhuanlan.zhihu.com/p/61546435" target="_blank" rel="noopener">å¦‚ä¸‹å›¾</a></p><p><img src="/images/blog/201908/4-MySQL%E8%A7%A3%E6%9E%90%E5%99%A8%E5%92%8C%E4%BC%98%E5%8C%96%E5%99%A8.jpg" alt></p><p><a href="https://zhuanlan.zhihu.com/p/61546435" target="_blank" rel="noopener">å›¾ç‰‡å¼•ç”¨è‡ª ç¨‹åºå‘˜å†å°å†°</a></p><h5 id="2-5ï¼šExecutorï¼ˆæ‰§è¡Œå™¨ï¼‰"><a href="#2-5ï¼šExecutorï¼ˆæ‰§è¡Œå™¨ï¼‰" class="headerlink" title="2.5ï¼šExecutorï¼ˆæ‰§è¡Œå™¨ï¼‰"></a>2.5ï¼šExecutorï¼ˆæ‰§è¡Œå™¨ï¼‰</h5><p>æ ¹æ® ä¼˜åŒ–å™¨ çš„æ‰§è¡Œè®¡åˆ’å»è°ƒç”¨å­˜å‚¨å¼•æ“ API æ¥å£è·å–æ•°æ®</p><h4 id="3ï¼šManagement-Serveices-amp-Utilitiesï¼ˆç³»ç»Ÿç®¡ç†å’Œæ§åˆ¶å·¥å…·ï¼‰"><a href="#3ï¼šManagement-Serveices-amp-Utilitiesï¼ˆç³»ç»Ÿç®¡ç†å’Œæ§åˆ¶å·¥å…·ï¼‰" class="headerlink" title="3ï¼šManagement Serveices &amp; Utilitiesï¼ˆç³»ç»Ÿç®¡ç†å’Œæ§åˆ¶å·¥å…·ï¼‰"></a>3ï¼šManagement Serveices &amp; Utilitiesï¼ˆç³»ç»Ÿç®¡ç†å’Œæ§åˆ¶å·¥å…·ï¼‰</h4><p>å¤‡ä»½ï¼Œå®‰å…¨æ¢å¤ï¼Œå¤åˆ¶ï¼Œé›†ç¾¤ï¼Œç®¡ç†ï¼Œé…ç½®ï¼Œè¿ç§»å’Œå…ƒæ•°æ®ã€‚</p><h4 id="4ï¼šPluggable-Storage-Enginesï¼ˆå¯æ’æ‹”çš„å­˜å‚¨å¼•æ“ï¼‰"><a href="#4ï¼šPluggable-Storage-Enginesï¼ˆå¯æ’æ‹”çš„å­˜å‚¨å¼•æ“ï¼‰" class="headerlink" title="4ï¼šPluggable Storage Enginesï¼ˆå¯æ’æ‹”çš„å­˜å‚¨å¼•æ“ï¼‰"></a>4ï¼šPluggable Storage Enginesï¼ˆå¯æ’æ‹”çš„å­˜å‚¨å¼•æ“ï¼‰</h4><ul><li>å­˜å‚¨å¼•æ“é’ˆå¯¹æ•°æ®è¡¨</li></ul><h4 id="5ï¼šæ–‡ä»¶ç³»ç»Ÿï¼Œæ–‡ä»¶ï¼Œæ—¥å¿—"><a href="#5ï¼šæ–‡ä»¶ç³»ç»Ÿï¼Œæ–‡ä»¶ï¼Œæ—¥å¿—" class="headerlink" title="5ï¼šæ–‡ä»¶ç³»ç»Ÿï¼Œæ–‡ä»¶ï¼Œæ—¥å¿—"></a>5ï¼šæ–‡ä»¶ç³»ç»Ÿï¼Œæ–‡ä»¶ï¼Œæ—¥å¿—</h4><p><strong>è¡¥å……: ä¸€æ¡ SQL æŸ¥è¯¢è¯­å¥å„ä¸ªå…³é”®å­—è§£æçš„é¡ºåºè¿‡ç¨‹</strong></p><p><img src="/images/blog/201908/5-SQL%E8%A7%A3%E6%9E%90%E6%B5%81%E7%A8%8B.jpg" alt="SQL è¯­å¥è§£æè¿‡ç¨‹"></p><p>å†™ç€å†™ç€å‘ç°æåŠå¾ˆå¤šçŸ¥è¯†ç‚¹è¿˜æ˜¯æœªçŸ¥ï¼Œè·¯æ¼«æ¼«å…¶ä¿®è¿œå…®ï¼Œéœ€è¦å­¦çš„ä¸œè¥¿è¿˜å¤šï¼Œæ„¿æ¯æ—¥éƒ½æ¯”æ˜¨æ—¥è¿›æ­¥ï¼Œå³ä½¿è¿›æ­¥å¾ˆå¾®å°ã€‚é‚£å…ˆåƒé¥­å»äº†ğŸš</p><h4 id="todo"><a href="#todo" class="headerlink" title="todo"></a>todo</h4><ul><li>æ•°æ®åº“å®ä¾‹äº†è§£</li></ul><hr><p><strong>å‚è€ƒ</strong></p><p><a href="https://time.geekbang.org/column/article/68319" target="_blank" rel="noopener">MySQLå®æˆ˜45è®²</a></p><p><a href="https://zhuanlan.zhihu.com/p/61757521" target="_blank" rel="noopener">ä¸€æ¡SQLè¯­å¥åœ¨MySQLä¸­æ˜¯å¦‚ä½•æ‰§è¡Œçš„</a></p><p><a href="https://www.jianshu.com/p/bb6bdedbf9ce" target="_blank" rel="noopener">æœ¬æ¥ä»¥ä¸ºmysqlå³å°†æ¶ˆäº¡ï¼Œæ²¡æƒ³åˆ°å®ƒå´è¶Šæ¥è¶Šå¼ºå¤§</a></p><p><a href="https://www.jianshu.com/p/7d1552883289" target="_blank" rel="noopener">MySQLä½“ç³»æ¶æ„</a></p><p><a href="https://www.jianshu.com/p/1a3a932ccf88" target="_blank" rel="noopener">mysqlä½“ç³»æ¶æ„å›¾ä»¥åŠäºŒè¿›åˆ¶å®‰è£…mariadb</a></p><p><a href="https://blog.csdn.net/u010342038/article/details/52798320" target="_blank" rel="noopener">MySQLä¸­çš„å®ä¾‹ã€æ•°æ®åº“å…³ç³»ç®€ä»‹</a></p>]]></content>
      
      
      <categories>
          
          <category> æ•°æ®åº“ </category>
          
          <category> MySQL </category>
          
      </categories>
      
      
        <tags>
            
            <tag> MySQL </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>MySQL 5.7.21-1é…ç½®æ–‡ä»¶my.cnf</title>
      <link href="/2019/08/15/MySQL-5-7-21-1%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6my-cnf/"/>
      <url>/2019/08/15/MySQL-5-7-21-1%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6my-cnf/</url>
      
        <content type="html"><![CDATA[<p>ç®€è¿°ï¼š<code>MySQL 5.7.21-1</code> åŸå§‹é…ç½®æ–‡ä»¶ <code>my.cnf</code>ï¼Œä¸ºä»¥åæŸ¥è¯¢æ–¹ä¾¿ç‰¹æ­¤è®°å½•</p><p>MySQL å®‰è£…åçš„ä¸€äº›æ³¨æ„ç‚¹</p><p>1ï¼šå®‰è£…åå…ˆè®¾ç½®å­—ç¬¦ç¼–ç ã€‚å¦‚æœä¸€ä¸ªåº“ï¼ˆ<code>eg:DB1</code>ï¼‰åœ¨ä½¿ç”¨æœŸé—´æ”¹å˜äº† <code>my.cnf</code> çš„å­—ç¬¦ç¼–ç é…ç½®ï¼Œæ­¤æ—¶ DB1 çš„åŸæœ‰çš„å­—ç¬¦ä¸²ç¼–ç ä¸å—å½±å“ï¼Œå¦‚æœå†æ–°å»ºä¸€ä¸ª <code>DB</code>2 åº“ï¼Œåˆ™ <code>DB2</code> ä½¿ç”¨å¿ƒå¾—å­—ç¬¦ç¼–ç ã€‚</p> <a id="more"></a><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># The MySQL database server configuration file.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># You can copy this to one of:</span></span><br><span class="line"><span class="comment"># - "/etc/mysql/my.cnf" to set global options,</span></span><br><span class="line"><span class="comment"># - "~/.my.cnf" to set user-specific options.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># One can use all long options that the program supports.</span></span><br><span class="line"><span class="comment"># Run program with --help to get a list of available options and with</span></span><br><span class="line"><span class="comment"># --print-defaults to see which it would actually understand and use.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># For explanations see</span></span><br><span class="line"><span class="comment"># http://dev.mysql.com/doc/mysql/en/server-system-variables.html</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># This will be passed to all mysql clients</span></span><br><span class="line"><span class="comment"># It has been reported that passwords should be enclosed with ticks/quotes</span></span><br><span class="line"><span class="comment"># escpecially if they contain "#" chars...</span></span><br><span class="line"><span class="comment"># Remember to edit /etc/mysql/debian.cnf when changing the socket location.</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Here is entries for some specific programs</span></span><br><span class="line"><span class="comment"># The following values assume you have at least 32M ram</span></span><br><span class="line"></span><br><span class="line">[mysqld_safe]</span><br><span class="line">socket= /var/run/mysqld/mysqld.sock</span><br><span class="line">nice= 0</span><br><span class="line"></span><br><span class="line">[mysqld]</span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># * Basic Settings</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line">user= mysql</span><br><span class="line">pid-file= /var/run/mysqld/mysqld.pid</span><br><span class="line">socket= /var/run/mysqld/mysqld.sock</span><br><span class="line">port= 3306</span><br><span class="line">basedir= /usr</span><br><span class="line">datadir= /var/lib/mysql</span><br><span class="line">tmpdir= /tmp</span><br><span class="line">lc-messages-dir= /usr/share/mysql</span><br><span class="line"></span><br><span class="line"><span class="comment"># set server character</span></span><br><span class="line">character-<span class="keyword">set</span>-<span class="keyword">server</span> = utf8</span><br><span class="line"><span class="keyword">collation</span>-<span class="keyword">server</span>     = utf8_general_ci</span><br><span class="line">init_connect         = <span class="string">'SET NAMES utf8'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">skip</span>-<span class="keyword">external</span>-locking</span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Instead of skip-networking the default is now to listen only on</span></span><br><span class="line"><span class="comment"># localhost which is more compatible and is not less secure.</span></span><br><span class="line">bind-address= <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># * Fine Tuning</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line">key_buffer_size= <span class="number">16</span>M</span><br><span class="line">max_allowed_packet= <span class="number">16</span>M</span><br><span class="line">thread_stack= <span class="number">192</span>K</span><br><span class="line">thread_cache_size       = <span class="number">8</span></span><br><span class="line"><span class="comment"># This replaces the startup script and checks MyISAM tables if needed</span></span><br><span class="line"><span class="comment"># the first time they are touched</span></span><br><span class="line">myisam-<span class="keyword">recover</span>-options  = <span class="keyword">BACKUP</span></span><br><span class="line"><span class="comment">#max_connections        = 100</span></span><br><span class="line"><span class="comment">#table_open_cache       = 64</span></span><br><span class="line"><span class="comment">#thread_concurrency     = 10</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># * Query Cache Configuration</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line">query_cache_limit= <span class="number">1</span>M</span><br><span class="line">query_cache_size        = <span class="number">16</span>M</span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># * Logging and Replication</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Both location gets rotated by the cronjob.</span></span><br><span class="line"><span class="comment"># Be aware that this log type is a performance killer.</span></span><br><span class="line"><span class="comment"># As of 5.1 you can enable the log at runtime!</span></span><br><span class="line"><span class="comment">#general_log_file        = /var/log/mysql/mysql.log</span></span><br><span class="line"><span class="comment">#general_log             = 1</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Error log - should be very few entries.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line">log_error = /<span class="keyword">var</span>/<span class="keyword">log</span>/mysql/error.log</span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Here you can see queries with especially long duration</span></span><br><span class="line"><span class="comment">#slow_query_log= 1</span></span><br><span class="line"><span class="comment">#slow_query_log_file= /var/log/mysql/mysql-slow.log</span></span><br><span class="line"><span class="comment">#long_query_time = 2</span></span><br><span class="line"><span class="comment">#log-queries-not-using-indexes</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># The following can be used as easy to replay backup logs or for replication.</span></span><br><span class="line"><span class="comment"># <span class="doctag">note:</span> if you are setting up a replication slave, see README.Debian about</span></span><br><span class="line"><span class="comment">#       other settings you may need to change.</span></span><br><span class="line"><span class="comment">#server-id= 1</span></span><br><span class="line"><span class="comment">#log_bin= /var/log/mysql/mysql-bin.log</span></span><br><span class="line">expire_logs_days= <span class="number">10</span></span><br><span class="line">max_binlog_size   = <span class="number">100</span>M</span><br><span class="line"><span class="comment">#binlog_do_db= include_database_name</span></span><br><span class="line"><span class="comment">#binlog_ignore_db= include_database_name</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># * InnoDB</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># InnoDB is enabled by default with a 10MB datafile in /var/lib/mysql/.</span></span><br><span class="line"><span class="comment"># Read the manual for more InnoDB related options. There are many!</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># * Security Features</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Read the manual, too, if you want chroot!</span></span><br><span class="line"><span class="comment"># æ•°æ®æ–‡ä»¶çš„å­˜æ”¾è·¯å¾„ã€æ¯ä¸€ä¸ªæ•°æ®åº“æ˜¯ç›®å½•ã€‘</span></span><br><span class="line"><span class="comment"># chroot = /var/lib/mysql/</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># For generating SSL certificates I recommend the OpenSSL GUI "tinyca".</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># ssl-ca=/etc/mysql/cacert.pem</span></span><br><span class="line"><span class="comment"># ssl-cert=/etc/mysql/server-cert.pem</span></span><br><span class="line"><span class="comment"># ssl-key=/etc/mysql/server-key.pem</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> æ•°æ®åº“ </category>
          
          <category> MySQL </category>
          
      </categories>
      
      
        <tags>
            
            <tag> MySQL </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Golangçˆ¬è™«ç³»åˆ—ä¸‰ï¼šä¸‹è½½å»å“ªå„¿æ¸¸è®°å›¾ç‰‡åˆ°æœ¬åœ°</title>
      <link href="/2019/08/14/Golang%E4%B8%8B%E8%BD%BD%E5%8E%BB%E5%93%AA%E5%84%BF%E6%B8%B8%E8%AE%B0%E5%9B%BE%E7%89%87%E5%88%B0%E6%9C%AC%E5%9C%B0/"/>
      <url>/2019/08/14/Golang%E4%B8%8B%E8%BD%BD%E5%8E%BB%E5%93%AA%E5%84%BF%E6%B8%B8%E8%AE%B0%E5%9B%BE%E7%89%87%E5%88%B0%E6%9C%AC%E5%9C%B0/</url>
      
        <content type="html"><![CDATA[<h6 id="å£°æ˜ï¼šä»¥ä¸‹å†…å®¹ä»…ä¾›æŠ€æœ¯å­¦ä¹ "><a href="#å£°æ˜ï¼šä»¥ä¸‹å†…å®¹ä»…ä¾›æŠ€æœ¯å­¦ä¹ " class="headerlink" title="å£°æ˜ï¼šä»¥ä¸‹å†…å®¹ä»…ä¾›æŠ€æœ¯å­¦ä¹ "></a>å£°æ˜ï¼šä»¥ä¸‹å†…å®¹ä»…ä¾›æŠ€æœ¯å­¦ä¹ </h6><p>ç®€è¿°ï¼š è·å–<a href="http://www.qunar.com/" target="_blank" rel="noopener">å»å“ªå„¿ç½‘</a> ä¸­çš„çš„æ¸¸è®°ï¼ˆeg: <a href="https://travel.qunar.com/youji/6961284" target="_blank" rel="noopener">ç¾åœ¨â€œåäºŒèƒŒåâ€</a> ï¼‰é¡µé¢ä¸­çš„å›¾ç‰‡åœ°å€å¹¶å°†å›¾ç‰‡ä¿å­˜åˆ°æœ¬åœ°</p><a id="more"></a><h5 id="æ­¥éª¤å¦‚ä¸‹"><a href="#æ­¥éª¤å¦‚ä¸‹" class="headerlink" title="æ­¥éª¤å¦‚ä¸‹"></a>æ­¥éª¤å¦‚ä¸‹</h5><p>1: ä½¿ç”¨æ­£åˆ™è·å–å›¾ç‰‡çš„é“¾æ¥å¹¶å­˜å‚¨åˆ°ä¸€ä¸ª <code>slice</code> ä¸­</p><p>2: éå† <code>slice</code> ä¸­çš„ å›¾ç‰‡åœ°å€ï¼Œè¯»å–æ•°æ®ä¿å­˜åˆ°æœ¬åœ°</p><p><strong>ä»£ç å¦‚ä¸‹</strong></p><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">"fmt"</span></span><br><span class="line">    <span class="string">"strconv"</span></span><br><span class="line">    <span class="string">"net/http"</span></span><br><span class="line">    <span class="string">"io"</span></span><br><span class="line">    <span class="string">"regexp"</span></span><br><span class="line">    <span class="string">"os"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">var</span> articleId <span class="keyword">int</span></span><br><span class="line">    fmt.Print(<span class="string">"è¯·è¾“å…¥æ¸¸è®°id: "</span>)</span><br><span class="line">    fmt.Scan(&amp;articleId)</span><br><span class="line"></span><br><span class="line">    spiderArticleImageUrls(articleId)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">spiderArticleImageUrls</span><span class="params">(articleId <span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">    <span class="comment">//https://travel.qunar.com/youji/5908435</span></span><br><span class="line">    articleUrl := <span class="string">"https://travel.qunar.com/youji/"</span> + strconv.Itoa(articleId)</span><br><span class="line">    resp, err1 := http.Get(articleUrl)</span><br><span class="line"></span><br><span class="line">    <span class="comment">//fmt.Println(resp.StatusCode)</span></span><br><span class="line">    <span class="comment">//os.Exit(1)</span></span><br><span class="line">    <span class="keyword">if</span> err1 != <span class="literal">nil</span> &#123;</span><br><span class="line">        fmt.Println(<span class="string">"http get err:"</span>, <span class="literal">nil</span>)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> resp.StatusCode != <span class="number">200</span> &#123;</span><br><span class="line">        fmt.Println(<span class="string">"404 not found"</span>)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">defer</span> resp.Body.Close()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> pageContent <span class="keyword">string</span></span><br><span class="line">    buffer := <span class="built_in">make</span>([]<span class="keyword">byte</span>, <span class="number">8192</span>)</span><br><span class="line">    <span class="keyword">for</span> &#123;</span><br><span class="line">        n, err2 := resp.Body.Read(buffer)</span><br><span class="line">        <span class="keyword">if</span> n == <span class="number">0</span> &#123;</span><br><span class="line">            fmt.Println(<span class="string">"è¯»å–ç½‘é¡µå®Œæˆ"</span>)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> err2 != <span class="literal">nil</span> &amp;&amp; err2 != io.EOF &#123;</span><br><span class="line">            fmt.Println(<span class="string">"err2:"</span>, err2)</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        pageContent += <span class="keyword">string</span>(buffer[:n])</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    osDir, _ := os.Getwd()</span><br><span class="line">    dir := osDir + <span class="string">"/qunar/"</span></span><br><span class="line">    os.Mkdir(dir, os.ModePerm)</span><br><span class="line">    fileName := dir + strconv.Itoa(articleId) + <span class="string">".txt"</span></span><br><span class="line"></span><br><span class="line">    file, err3 := os.Create(fileName)</span><br><span class="line">    <span class="keyword">if</span> err3 != <span class="literal">nil</span> &#123;</span><br><span class="line">        fmt.Println(<span class="string">"æ–‡ä»¶åˆ›å»ºå¤±è´¥: "</span>, err3)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* å†™å…¥å†…å®¹åˆ°æ–‡ä»¶*/</span></span><br><span class="line">    image_pat := regexp.MustCompile(<span class="string">`data-retina="(.*?)" class="box_img js_box_img js_lazyimg ajaxloading"`</span>)</span><br><span class="line">    image_urls := image_pat.FindAllStringSubmatch(pageContent, <span class="number">-1</span>)</span><br><span class="line">    <span class="comment">//var saveImages []string</span></span><br><span class="line">    imgDir := osDir + <span class="string">"/qunar/"</span> + strconv.Itoa(articleId) + <span class="string">"/"</span></span><br><span class="line">    os.Mkdir(imgDir, os.ModePerm)</span><br><span class="line">    fileSaveChan := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">int</span>)</span><br><span class="line">    <span class="keyword">for</span> key, image := <span class="keyword">range</span> image_urls &#123;</span><br><span class="line">        key++</span><br><span class="line">        <span class="keyword">go</span> saveImageUrlToFile(key, image[<span class="number">1</span>], imgDir, fileSaveChan)</span><br><span class="line">        file.WriteString(<span class="keyword">string</span>(key) + <span class="string">"--"</span> + image[<span class="number">1</span>] + <span class="string">"\n"</span>)</span><br><span class="line">        <span class="comment">//saveImages = append(saveImages, image[1])</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    imgCount := (<span class="built_in">len</span>(image_urls))</span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; imgCount; i++ &#123;</span><br><span class="line">        fmt.Printf(<span class="string">"å›¾ç‰‡%d.jpg ä¿å­˜æˆåŠŸ\n"</span>, &lt;-fileSaveChan)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//ä¿å­˜æ–‡ä»¶ä»¶</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">saveImageUrlToFile</span><span class="params">(i <span class="keyword">int</span>, imgUrl, dir <span class="keyword">string</span>, fileSaveChan <span class="keyword">chan</span> <span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">    fileName := dir + strconv.Itoa(i) + <span class="string">".jpg"</span></span><br><span class="line">    file, _ := os.Create(fileName)</span><br><span class="line">    resp, err1 := http.Get(imgUrl)</span><br><span class="line">    <span class="keyword">if</span> err1 != <span class="literal">nil</span> &#123;</span><br><span class="line">        fmt.Println(<span class="string">"saveImageUrlToFile err:"</span>, err1)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">defer</span> resp.Body.Close()</span><br><span class="line"></span><br><span class="line">    buffer := <span class="built_in">make</span>([]<span class="keyword">byte</span>, <span class="number">8192</span>)</span><br><span class="line">    <span class="keyword">for</span> &#123;</span><br><span class="line">        n, err2 := resp.Body.Read(buffer)</span><br><span class="line">        <span class="keyword">if</span> n == <span class="number">0</span> &#123;</span><br><span class="line">            <span class="comment">//fmt.Println("saveImageUrlToFile è¯»å–ç½‘é¡µå®Œæˆ:", i)</span></span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> err2 != <span class="literal">nil</span> &amp;&amp; err2 != io.EOF &#123;</span><br><span class="line">            fmt.Println(<span class="string">"err2:"</span>, err2)</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//æ•°æ®å†™å…¥æ–‡ä»¶</span></span><br><span class="line">        file.Write(buffer[:n])</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    fileSaveChan &lt;- i</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Golang </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Go </tag>
            
            <tag> çˆ¬è™« </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Golangçˆ¬è™«ç³»åˆ—äºŒï¼šçˆ¬å–æ§è…¹ç½‘æ®µå­åŠå…¶ç¬‘è¯è¯¦æƒ…</title>
      <link href="/2019/08/12/golang%E7%88%AC%E5%8F%96%E5%86%85%E6%B6%B5%E6%AE%B5%E5%AD%90%E7%AC%91%E8%AF%9D%E5%8F%8A%E4%BA%8C%E7%BA%A7%E9%A1%B5%E9%9D%A2/"/>
      <url>/2019/08/12/golang%E7%88%AC%E5%8F%96%E5%86%85%E6%B6%B5%E6%AE%B5%E5%AD%90%E7%AC%91%E8%AF%9D%E5%8F%8A%E4%BA%8C%E7%BA%A7%E9%A1%B5%E9%9D%A2/</url>
      
        <content type="html"><![CDATA[<h6 id="å£°æ˜ï¼šä»¥ä¸‹å†…å®¹ä»…ä¾›æŠ€æœ¯å­¦ä¹ "><a href="#å£°æ˜ï¼šä»¥ä¸‹å†…å®¹ä»…ä¾›æŠ€æœ¯å­¦ä¹ " class="headerlink" title="å£°æ˜ï¼šä»¥ä¸‹å†…å®¹ä»…ä¾›æŠ€æœ¯å­¦ä¹ "></a>å£°æ˜ï¼šä»¥ä¸‹å†…å®¹ä»…ä¾›æŠ€æœ¯å­¦ä¹ </h6><p>ç®€è¿°ï¼šçˆ¬å– <a href="https://www.pengfu.com" target="_blank" rel="noopener">æ§è…¹ç½‘ </a> ä¸­çš„ <a href="https://www.pengfu.com/xiaohua_1.html" target="_blank" rel="noopener">æ®µå­</a>é¡µé¢æ•°æ®åŠæ¯ä¸€æ¡æ•°æ®æ‰€é“¾æ¥çš„ <a href="https://www.pengfu.com/content_1857807_1.html" target="_blank" rel="noopener">ç¬‘è¯è¯¦æƒ…é¡µ</a>ã€‚</p><a id="more"></a><h5 id="æ­¥éª¤å¦‚ä¸‹"><a href="#æ­¥éª¤å¦‚ä¸‹" class="headerlink" title="æ­¥éª¤å¦‚ä¸‹"></a>æ­¥éª¤å¦‚ä¸‹</h5><p>ä»¥ç¬¬ä¸€é¡µï¼ˆ<a href="https://www.pengfu.com/xiaohua_1.htmlï¼‰" target="_blank" rel="noopener">https://www.pengfu.com/xiaohua_1.htmlï¼‰</a> ä¸¾ä¾‹</p><p>1: çˆ¬å–ç¬¬ä¸€é¡µçš„å†…å®¹ï¼Œè·å–é‡Œé¢æ¯ä¸€ä¸ªç¬‘è¯çš„é“¾æ¥;</p><p>2: çˆ¬å–æ­¥éª¤1è·å–åˆ°çš„ç¬‘è¯é“¾æ¥çš„å†…å®¹ï¼Œè§£æç¬‘è¯æ ‡é¢˜å’Œå†…å®¹</p><p>3: å°†æ¯ä¸€é¡µçˆ¬å–åˆ°çš„æ ‡é¢˜å’Œå†…å®¹å†™å…¥åˆ°æ–‡ä»¶ä¸­</p><p><code>ä»£ä¹°ç¤ºä¾‹å¦‚ä¸‹</code></p><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">"fmt"</span></span><br><span class="line">    <span class="string">"strconv"</span></span><br><span class="line">    <span class="string">"net/http"</span></span><br><span class="line">    <span class="string">"io"</span></span><br><span class="line">    <span class="string">"regexp"</span></span><br><span class="line">    <span class="string">"strings"</span></span><br><span class="line">    <span class="string">"os"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">var</span> start <span class="keyword">int</span></span><br><span class="line">    <span class="keyword">var</span> end <span class="keyword">int</span></span><br><span class="line">    fmt.Print(<span class="string">"è¯·è¾“å…¥çˆ¬å–çš„èµ·å§‹é¡µ: "</span>)</span><br><span class="line">    fmt.Scan(&amp;start)</span><br><span class="line">    fmt.Print(<span class="string">"è¯·è¾“å…¥çˆ¬å–çš„ç»“æŸé¡µ: "</span>)</span><br><span class="line">    fmt.Scan(&amp;end)</span><br><span class="line"></span><br><span class="line">    <span class="comment">//çˆ¬å–ä¸šåŠ¡é€»è¾‘</span></span><br><span class="line">    pengfuWorking(start, end)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">pengfuWorking</span><span class="params">(start, end <span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">    fmt.Println(start, <span class="string">":"</span>, end)</span><br><span class="line"></span><br><span class="line">    pageChan := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">int</span>)</span><br><span class="line">    <span class="keyword">for</span> i := start; i &lt;= end; i++ &#123;</span><br><span class="line">        <span class="comment">//å¼€å¯åç¨‹</span></span><br><span class="line">        <span class="keyword">go</span> pengfuSpider(i, pageChan)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i := start; i &lt;= end; i++ &#123;</span><br><span class="line">        <span class="comment">//è¯»å–ç®¡é“æ ‡è¯†</span></span><br><span class="line">        fmt.Printf(<span class="string">"ç¬¬ %d é¡µ çˆ¬å–å®Œæˆ\n"</span>, &lt;-pageChan)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//æŠ“å–å¸¦æœ‰10ä¸ªæ®µå­çš„url</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">pengfuSpider</span><span class="params">(i <span class="keyword">int</span>, pageChan <span class="keyword">chan</span> <span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">    <span class="comment">//https://www.pengfu.com/xiaohua_1.html</span></span><br><span class="line">    url := <span class="string">"https://www.pengfu.com/xiaohua_"</span> + strconv.Itoa(i) + <span class="string">".html"</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//æŠ“å–urlä¸­çš„å†…å®¹</span></span><br><span class="line">    result, err := spiderUrlContent(url)</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        fmt.Println(<span class="string">"err messageï¼š"</span>, err)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//çˆ¬å–æ¯ä¸€é¡µçš„æ®µå­</span></span><br><span class="line">    urlPat := regexp.MustCompile(<span class="string">`&lt;h1 class="dp-b"&gt;&lt;a href="(?s:(.*?))"`</span>)</span><br><span class="line">    urls := urlPat.FindAllStringSubmatch(result, <span class="number">-1</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">//åˆ›å»ºå­˜å‚¨title,content çš„åˆ‡ç‰‡</span></span><br><span class="line">    titleSlice := <span class="built_in">make</span>([]<span class="keyword">string</span>, <span class="number">0</span>)</span><br><span class="line">    contentSlice := <span class="built_in">make</span>([]<span class="keyword">string</span>, <span class="number">0</span>)</span><br><span class="line">    <span class="keyword">for</span> _, value := <span class="keyword">range</span> urls &#123;</span><br><span class="line">        url := value[<span class="number">1</span>]</span><br><span class="line">        title, content, err := spiderDetailContent(url)</span><br><span class="line">        <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">            fmt.Println(<span class="string">"spiderDetailContent error:"</span>, err)</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        &#125;</span><br><span class="line">        titleSlice = <span class="built_in">append</span>(titleSlice, title)</span><br><span class="line">        contentSlice = <span class="built_in">append</span>(contentSlice, content)</span><br><span class="line">    &#125;</span><br><span class="line">    saveJokeToFile(i, titleSlice, contentSlice)</span><br><span class="line">    pageChan &lt;- i</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">spiderUrlContent</span><span class="params">(url <span class="keyword">string</span>)</span> <span class="params">(result <span class="keyword">string</span>, err error)</span></span> &#123;</span><br><span class="line">    resp, err1 := http.Get(url)</span><br><span class="line">    <span class="keyword">if</span> err1 != <span class="literal">nil</span> &#123;</span><br><span class="line">        err = err1</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">defer</span> resp.Body.Close()</span><br><span class="line"></span><br><span class="line">    buffer := <span class="built_in">make</span>([]<span class="keyword">byte</span>, <span class="number">8196</span>)</span><br><span class="line">    <span class="keyword">for</span> &#123;</span><br><span class="line">        n, err2 := resp.Body.Read(buffer)</span><br><span class="line">        <span class="keyword">if</span> n == <span class="number">0</span> &#123;</span><br><span class="line">            fmt.Println(<span class="string">"è¯»å–ç½‘é¡µå®Œæˆ:"</span>, url)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> err2 != <span class="literal">nil</span> &amp;&amp; err2 != io.EOF &#123;</span><br><span class="line">            err = err2</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        &#125;</span><br><span class="line">        result += <span class="keyword">string</span>(buffer[:n])</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//çˆ¬å–ä¸€ä¸ªç¬‘è¯è¯¦æƒ…é¡µçš„æ ‡é¢˜å’Œå†…å®¹</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">spiderDetailContent</span><span class="params">(url <span class="keyword">string</span>)</span> <span class="params">(title, content <span class="keyword">string</span>, err error)</span></span> &#123;</span><br><span class="line">    result, err1 := spiderUrlContent(url)</span><br><span class="line">    <span class="keyword">if</span> err1 != <span class="literal">nil</span> &#123;</span><br><span class="line">        err = err1</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//åŒ¹é…æ ‡é¢˜</span></span><br><span class="line">    titlePat := regexp.MustCompile(<span class="string">`&lt;h1&gt;(?s:(.*?))\t*&lt;/h1&gt;`</span>)</span><br><span class="line">    titles := titlePat.FindAllStringSubmatch(result, <span class="number">1</span>)</span><br><span class="line">    title = titles[<span class="number">0</span>][<span class="number">1</span>]</span><br><span class="line">    title = strings.Trim(title, <span class="string">""</span>)</span><br><span class="line">    title = strings.Replace(title, <span class="string">"&amp;nbsp; "</span>, <span class="string">""</span>, <span class="number">-1</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">//åŒ¹é…å†…å®¹</span></span><br><span class="line">    contentPat := regexp.MustCompile(<span class="string">`&lt;div class="content-txt pt10"&gt;\n*\t*(?s:(.*?))&lt;a`</span>)</span><br><span class="line">    contents := contentPat.FindAllStringSubmatch(result, <span class="number">1</span>)</span><br><span class="line">    content = contents[<span class="number">0</span>][<span class="number">1</span>]</span><br><span class="line">    content = strings.Trim(content, <span class="string">"\t"</span>)</span><br><span class="line">    content = strings.Replace(content, <span class="string">"\t"</span>, <span class="string">""</span>, <span class="number">-1</span>)</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">saveJokeToFile</span><span class="params">(idx <span class="keyword">int</span>, titleSlice, contentSlice []<span class="keyword">string</span>)</span></span> &#123;</span><br><span class="line">    <span class="comment">//å°†è¯»å–åˆ°çš„æ•°æ®å­˜å‚¨å­˜å‚¨ä¸ºæ–‡ä»¶</span></span><br><span class="line">    dir, _ := os.Getwd()</span><br><span class="line">    filePath := dir + <span class="string">"/pengfu_"</span> + strconv.Itoa(idx) + <span class="string">".txt"</span></span><br><span class="line"></span><br><span class="line">    file, err := os.Create(filePath)</span><br><span class="line">    <span class="keyword">if</span> err != err &#123;</span><br><span class="line">        fmt.Println(<span class="string">"os Create errï¼š"</span>, err.Error())</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">defer</span> file.Close() <span class="comment">//ä¿å­˜å¥½ä¸€ä¸ªæ–‡ä»¶å°±å…³é—­ä¸€ä¸ªæ–‡ä»¶</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="built_in">len</span>(titleSlice); i++ &#123;</span><br><span class="line">        file.WriteString(titleSlice[i] + <span class="string">":\t\t"</span> + contentSlice[i] + <span class="string">"\n"</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>çˆ¬å–åˆ°çš„æ–‡æœ¬æ–‡ä»¶ç¤ºä¾‹</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">ä¼šæ”¾å:å¥³ï¼šâ€œæˆ‘è´­ç‰©è½¦é‡Œçš„é‚£äº›æ°´æœç‰›å¥¶é¥®æ–™é›¶é£Ÿä½ èµ¶ç´§ç»™æˆ‘ä¹°ï¼â€ ç”·ï¼šâ€œç€ä»€ä¹ˆæ€¥å‘€ï¼Ÿâ€ å¥³ï¼šâ€œå¤©è¶Šæ¥è¶Šçƒ­äº†ï¼Œä¼šæ”¾åçš„ã€‚â€</span><br><span class="line">è‚‰å¤šèˆ’æœ:æ¥¼ä¸»å¤§å››å¥³ç”Ÿï¼Œè¿™å‡ å¤©å’ŒåŒä¸€å®¿èˆçš„å¥³ç”Ÿä¸€èµ·å»æ‰¾å·¥ä½œï¼Œåœ¨ç«è½¦ç«™ï¼Œç¢°åˆ°ä¸€ä¸ªå¤§å§ï¼Œå¸¦ç€ä¸€ä¸ªå››äº”å²çš„å°ç”·å­©ä¾¯è½¦ï¼Œå°ç”·å­©æ€»æ˜¯ç²˜ç€æˆ‘ï¼Œè¦åæˆ‘è…¿ä¸Šï¼ŒåŒå®¿èˆçš„å¥³ç”Ÿå¾ˆæ˜¯ç¾¡æ…•æˆ‘æœ‰äººç¼˜ï¼Œæˆ‘å¾—æ„çš„é—®å°ç”·å­©ï¼šâ€œä½ ä¸ºä»€ä¹ˆè€æ˜¯å–œæ¬¢åå§å§è…¿ä¸Šï¼Ÿâ€ å°ç”·å­©ç”¨ç¨šå«©çš„å£æ°”å›ç­”ï¼šâ€œå§å§è…¿ä¸Šè‚‰å¤šï¼Œåç€èˆ’æœâ€ æˆ‘ï¼šâ€œå°¼ç›ï¼Œè¿™æ˜¯è°å®¶å°å“”å´½å­ï¼Œå¿«ç‚¹é¢†èµ°ï¼â€</span><br><span class="line">å¸å¦†:ä¸€å¥³äººé—®å¤§å¸ˆï¼šå¤§å¸ˆï¼Œåœ¨è¿™ä¹ˆå¤æ‚é™©æ¶çš„ä¸–ç•Œï¼Œæˆ‘ä¸€ä¸ªå¼±å¥³å­å¦‚ä½•ä¿æŠ¤è‡ªå·±ï¼Ÿå¤§å¸ˆè¯´ï¼šä½ æŠŠå¦†å¸äº†ï¼</span><br><span class="line">åˆºåå­—ç»£:å®¶é•¿å¯¹å­©å­çš„æ•™è‚²çœŸçš„éå¸¸é‡è¦ã€‚æœ‰äº›ç”·å­©ï¼Œå°æ—¶å€™è°ƒçš®çš„å¾ˆï¼Œå·äº†é‚»å±…å®¶ä¸€æ ¹é’ˆï¼Œå®¶é•¿ä¹Ÿä¸ç®¡ï¼Œä¸€æ ¹é’ˆå˜›ï¼Œæ²¡äº‹ã€‚ç»“æœå­©å­é•¿å¤§äº†ï¼Œä¸å¥½å¥½å­¦ä¹ æ¯å¤©å‘†åœ¨å®¶é‡Œåˆºåå­—ç»£ã€‚</span><br><span class="line">çº¦ä¼š:ç½‘ä¸ŠèŠäº†ä¸€å¦¹å­ï¼Œä»Šå¤©è§é¢ã€‚é—®è€å¦ˆè¦äº†äºŒç™¾å—é’±ï¼Œè€å¦ˆé—®æˆ‘å¹²å˜›ç”¨ï¼Œæˆ‘è¯´çº¦ä¼šï¼Œå¥¹é«˜é«˜å…´å…´çš„å°±ç»™äº†ã€‚åˆšå‡ºå®¶é—¨ï¼Œè€çˆ¸å°±æŠŠæˆ‘æ‹½åˆ°ä¸€è¾¹è¯´â€œå°å­ï¼ŒäºŒç™¾å—é’±ç»™æˆ‘ä¸€ç™¾ï¼ŒåŠä¸ªæœˆä¸çŸ¥é“çƒŸçš„æ»‹å‘³äº†ã€‚â€æˆ‘è¯´â€œçˆ¸ï¼Œè¿™æ˜¯æˆ‘å’Œå¥³æœ‹å‹çš„çº¦ä¼šé’±ï¼Œä¸èƒ½ç»™ä½ ã€‚â€è€çˆ¸è¯´äº†ã€‚â€œä½ çº¦ä»€ä¹ˆä¼šï¼Œé‚£æ˜¯æˆ‘åˆšå»ºçš„å°å·ï¼Œä¸ºäº†æŠ½é¢—çƒŸæˆ‘å’Œä½ èŠäº†åŠä¸ªæœˆäº†ï¼Œå¿«æ‹¿æ¥ã€‚â€˜â€™</span><br><span class="line">æ”¹é…æ–¹äº†:70å¹´ä»£æ—¶ï¼Œæœ‰ä¸€é•¿è¾ˆç»ƒé“æ²™æŒï¼ŒåŠŸå¤«æˆäº†ä¹‹åï¼Œå¯ä»¥æŒæ–­äº”ç –ï¼Œå‡Œç©ºç¢ç –ï¼Œå¨é£çš„ä¸å¾—äº†ã€‚ åˆ°80å¹´ä»£ï¼Œåªèƒ½æŒæ–­ä¸‰ç –ã€‚ åˆ°90å¹´ä»£åªèƒ½ä¸€ç –ä¸€ç –çš„æ–­äº†ã€‚ ä»–è¯´ï¼Œä¸€ç›´ä»¥ä¸ºåŠŸåŠ›é€€æ­¥äº†ï¼Œåæ¥æ‰çŸ¥é“çƒ§ç –çš„é…æ–¹æ”¹äº†ã€‚ã€‚ã€‚</span><br><span class="line">æŠ¥æ©:ä¸ºä»€ä¹ˆå¤è£…å‰§é‡Œæ€»æ˜¯æœ‰å¥³äººä¼šå¯¹æ©äººè¯´ï¼šå°å¥³å­æ— ä»¥ä¸ºæŠ¥ï¼Œå”¯æœ‰ä»¥èº«ç›¸è®¸ï¼Œå¤ä»£çœŸçš„å­˜åœ¨è¿™ç§ç°è±¡å—ï¼Ÿ æ‰¯æ·¡ï¼Œé‚£æ˜¯å› ä¸ºå¥¹å–œæ¬¢ä»–ï¼Œè¦æ˜¯ä¸å–œæ¬¢ï¼Œå¥¹å°±ä¼šè¯´ï¼šå°å¥³å­æ— ä»¥ä¸ºæŠ¥ï¼Œå”¯æœ‰æ¥ç”Ÿå†æŠ¥äº†ã€‚</span><br><span class="line">é—®è·¯:æ˜¥èŠ‚å›è€å®¶æ—¶ï¼Œçœ‹åˆ°ä¸€ä¸ªè€å¤–åœ¨å‘ä¸€ä¸ªå†œæ°‘ä¼¯ä¼¯é—®è·¯ã€‚åªè§é‚£ä¸ªè€å¤–ä¸€è¾¹è¯´ç€ç”Ÿç¡¬çš„ä¸­æ–‡ï¼Œä¸€è¾¹ç”¨æ‰‹ç¬”åˆ’ï¼Œä½†é‚£ä¸ªå†œæ°‘ä¼¯ä¼¯å´è¿˜æ˜¯ä¸æ˜ç™½ã€‚æœ€åï¼Œé‚£ä¸ªå†œæ°‘ä¼¯ä¼¯è¯´äº†ä¸€å¥è®©æˆ‘è‡³ä»Šéš¾å¿˜çš„è¯ï¼šâ€œCan you speak English?â€</span><br><span class="line">è€ç‹:é—ºèœœæ˜¯ä¸ªéŸ©å‰§è¿·ï¼Œå¥¹è€å…¬æ˜¯ä¸ªçƒè¿·ã€‚æŸå¤©æ™šä¸Šæœ‰çƒèµ›ï¼Œä»–ä¿©å› ä¸ºæŠ¢ç”µè§†æœºé¥æ§å™¨æ‰“äº†èµ·æ¥ã€‚å¥¹ä¸€æ°”ä¹‹ä¸‹æ‰¾æˆ‘å“­è¯‰ï¼Œæˆ‘é—®å¥¹ï¼šâ€œç”µè§†é¥æ§å™¨æœ€åå½’è°äº†?â€å¥¹è¾¹å“­è¾¹è¯´ï¼šâ€œè€ç‹ã€‚â€æˆ‘ç–‘æƒ‘é“ï¼šâ€œè¿™ä¸ªè€ç‹æ˜¯è°å‘€?æˆ‘æ€ä¹ˆæ²¡å¬è¯´è¿‡ã€‚â€å¥¹å“­çš„å£°éŸ³æ›´å¤§äº†ï¼šâ€œä¸€ä¸ªä¿®ç”µè§†æœºçš„â€¦â€¦â€</span><br><span class="line">ä¸‘çš„å…ˆè¯´:ä¸¤ä¸ªå¥³äººåœ¨å¤§è¡—ä¸Šåµæ¶ï¼Œé‚£ä¸ªéª‚çš„åæ²«æ¨ªé£å•Šã€‚ä¸€å¤§å¦ˆçœ‹ä¸ä¸‹å»äº†ï¼Œå¯è°ä¹Ÿä¸å¬ï¼Œéƒ½è¯´è‡ªå·±å¯¹ï¼Œå¯¹æ–¹é”™ã€‚å¤§å¦ˆæ·¡æ·¡åœ°æ¥äº†ä¸€å¥ï¼šâ€œé‚£ä¹ˆè¿™æ ·ï¼Œä¸‘çš„å…ˆè¯´!â€ç¬é—´ï¼Œæ•´ä¸ªä¸–ç•Œéƒ½å®‰é™äº†ã€‚ã€‚ã€‚</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Golang </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Go </tag>
            
            <tag> çˆ¬è™« </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Golangçˆ¬è™«ç³»åˆ—ä¸€ï¼šçˆ¬å–è±†ç“£ç”µå½±top250æ•°æ®ä¿¡æ¯</title>
      <link href="/2019/08/10/%E8%B1%86%E7%93%A3%E7%94%B5%E5%BD%B1top250%E6%95%B0%E6%8D%AE%E7%88%AC%E5%8F%96/"/>
      <url>/2019/08/10/%E8%B1%86%E7%93%A3%E7%94%B5%E5%BD%B1top250%E6%95%B0%E6%8D%AE%E7%88%AC%E5%8F%96/</url>
      
        <content type="html"><![CDATA[<h6 id="å£°æ˜ï¼šä»¥ä¸‹å†…å®¹ä»…ä¾›æŠ€æœ¯å­¦ä¹ "><a href="#å£°æ˜ï¼šä»¥ä¸‹å†…å®¹ä»…ä¾›æŠ€æœ¯å­¦ä¹ " class="headerlink" title="å£°æ˜ï¼šä»¥ä¸‹å†…å®¹ä»…ä¾›æŠ€æœ¯å­¦ä¹ "></a>å£°æ˜ï¼šä»¥ä¸‹å†…å®¹ä»…ä¾›æŠ€æœ¯å­¦ä¹ </h6><p>ç®€è¿°ï¼šçˆ¬å–è±†ç“£ç”µå½± <code>top 250</code> çš„åŸºç¡€ä¿¡æ¯ï¼ŒåŒ…æ‹¬ç”µå½±ğŸ¬åï¼Œè¯„åˆ†ï¼Œè¯„ä»·äººæ•°ï¼Œç”µå½±é“¾æ¥ã€‚</p><a id="more"></a><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">     <span class="string">"fmt"</span></span><br><span class="line">     <span class="string">"strconv"</span></span><br><span class="line">     <span class="string">"net/http"</span></span><br><span class="line">     <span class="string">"io"</span></span><br><span class="line">     <span class="string">"regexp"</span></span><br><span class="line">     <span class="string">"os"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">     <span class="keyword">var</span> start <span class="keyword">int</span> <span class="comment">//èµ·å§‹é¡µ</span></span><br><span class="line">     <span class="keyword">var</span> end <span class="keyword">int</span>    <span class="comment">//ç»“æŸé¡µ</span></span><br><span class="line">     fmt.Print(<span class="string">"è¯·è¾“å…¥çˆ¬å–çš„èµ·å§‹é¡µ:"</span>)</span><br><span class="line">     fmt.Scanln(&amp;start)</span><br><span class="line">     fmt.Print(<span class="string">"è¯·è¾“å…¥çˆ¬å–çš„ç»“æŸé¡µ:"</span>)</span><br><span class="line">     fmt.Scanln(&amp;end)</span><br><span class="line">     toWorking(start, end)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">toWorking</span><span class="params">(start, end <span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">     fmt.Printf(<span class="string">"èµ·å§‹ç»“æŸé¡µæ˜¯%d : %d\n"</span>, start, end)</span><br><span class="line"></span><br><span class="line">     pageChan := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">int</span>)</span><br><span class="line">     <span class="keyword">for</span> i := start; i &lt;= end; i++ &#123;</span><br><span class="line">          <span class="keyword">go</span> SpiderDoubanPage(i, pageChan)</span><br><span class="line">     &#125;</span><br><span class="line"></span><br><span class="line">     <span class="keyword">for</span> i := start; i &lt;= end; i++ &#123;</span><br><span class="line">          <span class="comment">//å¼€å¯åç¨‹</span></span><br><span class="line">          fmt.Printf(<span class="string">"ç¬¬ %d é¡µ çˆ¬å–å®Œæˆ\n"</span>, &lt;-pageChan)</span><br><span class="line">     &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">SpiderDoubanPage</span><span class="params">(i <span class="keyword">int</span>, pageChan <span class="keyword">chan</span> <span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">     <span class="comment">//https://movie.douban.com/top250?start=0&amp;filter=</span></span><br><span class="line">     <span class="comment">//https://movie.douban.com/top250?start=25&amp;filter=</span></span><br><span class="line">     <span class="comment">//https://movie.douban.com/top250?start=50&amp;filter=</span></span><br><span class="line">     url := <span class="string">"https://movie.douban.com/top250?start="</span> + strconv.Itoa((i<span class="number">-1</span>)*<span class="number">25</span>)</span><br><span class="line"></span><br><span class="line">     <span class="comment">//çˆ¬å–urlé¡µé¢å†…å®¹ã€æ¨ªå‘çˆ¬å–ã€‘</span></span><br><span class="line">     result, err := httpGetDoubanUrlContent(url)</span><br><span class="line">     <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">          fmt.Println(<span class="string">"err messageï¼š"</span>, err)</span><br><span class="line">          <span class="keyword">return</span></span><br><span class="line">     &#125;</span><br><span class="line"></span><br><span class="line">     <span class="comment">//fmt.Println(result)</span></span><br><span class="line">     <span class="comment">//ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼è§£æå†…å®¹---ç”µå½±åç§°</span></span><br><span class="line">     film_pat := regexp.MustCompile(<span class="string">`width="100" alt="(.*?)"`</span>)</span><br><span class="line">     FilmNames := film_pat.FindAllStringSubmatch(result, <span class="number">-1</span>)</span><br><span class="line"></span><br><span class="line">     <span class="comment">//ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼è§£æå†…å®¹---ç”µå½±åˆ†æ•°</span></span><br><span class="line">     score_pat := regexp.MustCompile(<span class="string">`v:average"&gt;(?s:(.*?))&lt;`</span>)</span><br><span class="line">     filmScores := score_pat.FindAllStringSubmatch(result, <span class="number">-1</span>)</span><br><span class="line"></span><br><span class="line">     <span class="comment">//ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼è§£æå†…å®¹---è¯„ä»·äººæ•°</span></span><br><span class="line">     people_pat := regexp.MustCompile(<span class="string">`&lt;span&gt;(?s:(\d*?))äººè¯„ä»·&lt;/span&gt;`</span>)</span><br><span class="line">     peopleNum := people_pat.FindAllStringSubmatch(result, <span class="number">-1</span>)</span><br><span class="line"></span><br><span class="line">     <span class="comment">//ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼è§£æå†…å®¹---ç”µå½±è¯¦æƒ…é¡µurl</span></span><br><span class="line">     film_url_pat := regexp.MustCompile(<span class="string">`&lt;a href="(.*?)" class=""&gt;`</span>)</span><br><span class="line">     filmUrls := film_url_pat.FindAllStringSubmatch(result, <span class="number">-1</span>)</span><br><span class="line"></span><br><span class="line">     <span class="comment">//ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼è§£æå†…å®¹---ç”µå½±åºå·</span></span><br><span class="line">     film_order_pat := regexp.MustCompile(<span class="string">`&lt;em class=""&gt;(\d*)&lt;/em&gt;`</span>)</span><br><span class="line">     filmOrders := film_order_pat.FindAllStringSubmatch(result, <span class="number">-1</span>)</span><br><span class="line"></span><br><span class="line">     saveToFile(i, filmOrders, FilmNames, filmScores, peopleNum, filmUrls)</span><br><span class="line"></span><br><span class="line">     pageChan &lt;- i</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">httpGetDoubanUrlContent</span><span class="params">(url <span class="keyword">string</span>)</span> <span class="params">(result <span class="keyword">string</span>, err error)</span></span> &#123;</span><br><span class="line">     resp, err1 := http.Get(url)</span><br><span class="line">     <span class="keyword">if</span> err1 != <span class="literal">nil</span> &#123;</span><br><span class="line">          err = err1</span><br><span class="line">          <span class="keyword">return</span></span><br><span class="line">     &#125;</span><br><span class="line"></span><br><span class="line">     <span class="keyword">defer</span> resp.Body.Close()</span><br><span class="line"></span><br><span class="line">     buffer := <span class="built_in">make</span>([]<span class="keyword">byte</span>, <span class="number">8192</span>)</span><br><span class="line">     <span class="keyword">for</span> &#123;</span><br><span class="line">          n, err2 := resp.Body.Read(buffer)</span><br><span class="line">          <span class="keyword">if</span> n == <span class="number">0</span> &#123;</span><br><span class="line">                fmt.Println(<span class="string">"è¯»å–ç½‘é¡µå®Œæˆ"</span>)</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">          &#125;</span><br><span class="line"></span><br><span class="line">          <span class="keyword">if</span> err2 != <span class="literal">nil</span> &amp;&amp; err2 != io.EOF &#123;</span><br><span class="line">                err = err2</span><br><span class="line">                <span class="keyword">return</span></span><br><span class="line">          &#125;</span><br><span class="line">          result += <span class="keyword">string</span>(buffer[:n])</span><br><span class="line">     &#125;</span><br><span class="line">     <span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">saveToFile</span><span class="params">(idx <span class="keyword">int</span>, filmOrders, filmNames, filmScores, peopleNum, filmUrls [][]<span class="keyword">string</span>)</span></span> &#123;</span><br><span class="line">     <span class="comment">//å°†è¯»å–åˆ°çš„æ•°æ®å­˜å‚¨å­˜å‚¨ä¸ºæ–‡ä»¶</span></span><br><span class="line">     dir, _ := os.Getwd()</span><br><span class="line">     filePath := dir + <span class="string">"douban_top_"</span> + strconv.Itoa(idx) + <span class="string">".txt"</span></span><br><span class="line"></span><br><span class="line">     file, err := os.Create(filePath)</span><br><span class="line">     <span class="keyword">if</span> err != err &#123;</span><br><span class="line">          fmt.Println(<span class="string">"os Create errï¼š"</span>, err.Error())</span><br><span class="line">          <span class="keyword">return</span></span><br><span class="line">     &#125;</span><br><span class="line"></span><br><span class="line">     <span class="keyword">defer</span> file.Close() <span class="comment">//ä¿å­˜å¥½ä¸€ä¸ªæ–‡ä»¶å°±å…³é—­ä¸€ä¸ªæ–‡ä»¶</span></span><br><span class="line"></span><br><span class="line">     file.WriteString(</span><br><span class="line">          <span class="string">"åºå·"</span> +</span><br><span class="line">                <span class="string">"\t"</span> + <span class="string">"ç”µå½±åç§°"</span> +</span><br><span class="line">                <span class="string">"\t"</span> + <span class="string">"ç”µå½±è¯„åˆ†"</span> +</span><br><span class="line">                <span class="string">"\t"</span> + <span class="string">"è¯„ä»·äººæ•°"</span> +</span><br><span class="line">                <span class="string">"\t"</span> + <span class="string">"é“¾æ¥åœ°å€"</span> +</span><br><span class="line">                <span class="string">"\n"</span>)</span><br><span class="line">     <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="built_in">len</span>(filmNames); i++ &#123;</span><br><span class="line">          file.WriteString(</span><br><span class="line">                filmOrders[i][<span class="number">1</span>] +</span><br><span class="line">                     <span class="string">"\t"</span> + filmNames[i][<span class="number">1</span>] +</span><br><span class="line">                     <span class="string">"\t"</span> + filmScores[i][<span class="number">1</span>] +</span><br><span class="line">                     <span class="string">"\t"</span> + peopleNum[i][<span class="number">1</span>] +</span><br><span class="line">                     <span class="string">"\t"</span> + filmUrls[i][<span class="number">1</span>] +</span><br><span class="line">                     <span class="string">"\n"</span>)</span><br><span class="line">     &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="ä½¿ç”¨-linux-å‘½ä»¤åˆå¹¶çˆ¬å–çš„æ–‡ä»¶"><a href="#ä½¿ç”¨-linux-å‘½ä»¤åˆå¹¶çˆ¬å–çš„æ–‡ä»¶" class="headerlink" title="ä½¿ç”¨ linux å‘½ä»¤åˆå¹¶çˆ¬å–çš„æ–‡ä»¶"></a>ä½¿ç”¨ <code>linux</code> å‘½ä»¤åˆå¹¶çˆ¬å–çš„æ–‡ä»¶</h5><ul><li><p><code>cat crawlerdouban_top_*.txt&gt;top250.txt</code> //æ–‡ä»¶åˆå¹¶</p></li><li><p><code>cat top250.txt |grep -v &#39;åºå·&#39;&gt;douban_top250_movie_list.txt</code> //å»å–æŒ‡å®šå†…å®¹</p></li><li><p><code>sort -k 1 -n douban_top250_movie_list.txt&gt;douban_top250_movie_list_ordered.txt</code> //æ’åº</p></li><li><p>çœ‹å¿ƒæƒ…åœ¨æ–‡ä»¶å¤´éƒ¨åŠ ä¸Š <code>åºå·     ç”µå½±åç§°     ç”µå½±è¯„åˆ†     è¯„ä»·äººæ•°     é“¾æ¥åœ°å€</code></p></li><li><p>ç»“æœå¦‚ä¸‹</p></li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br></pre></td><td class="code"><pre><span class="line">åºå·     ç”µå½±åç§°     ç”µå½±è¯„åˆ†     è¯„ä»·äººæ•°     é“¾æ¥åœ°å€</span><br><span class="line">1    è‚–ç”³å…‹çš„æ•‘èµ    9.7    1535695    https://movie.douban.com/subject/1292052/</span><br><span class="line">2    éœ¸ç‹åˆ«å§¬    9.6    1136522    https://movie.douban.com/subject/1291546/</span><br><span class="line">3    è¿™ä¸ªæ€æ‰‹ä¸å¤ªå†·    9.4    1388824    https://movie.douban.com/subject/1295644/</span><br><span class="line">4    é˜¿ç”˜æ­£ä¼     9.4    1199279    https://movie.douban.com/subject/1292720/</span><br><span class="line">5    ç¾ä¸½äººç”Ÿ    9.5    702825    https://movie.douban.com/subject/1292063/</span><br><span class="line">6    åƒä¸åƒå¯»    9.3    1231099    https://movie.douban.com/subject/1291561/</span><br><span class="line">7    æ³°å¦å°¼å…‹å·    9.4    1140842    https://movie.douban.com/subject/1292722/</span><br><span class="line">8    è¾›å¾·å‹’çš„åå•    9.5    623915    https://movie.douban.com/subject/1295124/</span><br><span class="line">9    ç›—æ¢¦ç©ºé—´    9.3    1189561    https://movie.douban.com/subject/3541415/</span><br><span class="line">10    å¿ çŠ¬å…«å…¬çš„æ•…äº‹    9.3    795328    https://movie.douban.com/subject/3011091/</span><br><span class="line">11    æœºå™¨äººæ€»åŠ¨å‘˜    9.3    788458    https://movie.douban.com/subject/2131459/</span><br><span class="line">12    ä¸‰å‚»å¤§é—¹å®è±å    9.2    1075170    https://movie.douban.com/subject/3793023/</span><br><span class="line">13    æ”¾ç‰›ç­çš„æ˜¥å¤©    9.3    748223    https://movie.douban.com/subject/1291549/</span><br><span class="line">14    æµ·ä¸Šé’¢ç´å¸ˆ    9.2    872907    https://movie.douban.com/subject/1292001/</span><br><span class="line">15    æ¥šé—¨çš„ä¸–ç•Œ    9.2    832134    https://movie.douban.com/subject/1292064/</span><br><span class="line">16    å¤§è¯è¥¿æ¸¸ä¹‹å¤§åœ£å¨¶äº²    9.2    835440    https://movie.douban.com/subject/1292213/</span><br><span class="line">17    æ˜Ÿé™…ç©¿è¶Š    9.3    854952    https://movie.douban.com/subject/1889243/</span><br><span class="line">18    é¾™çŒ«    9.2    739493    https://movie.douban.com/subject/1291560/</span><br><span class="line">19    ç†”ç‚‰    9.3    492270    https://movie.douban.com/subject/5912992/</span><br><span class="line">20    æ•™çˆ¶    9.3    536821    https://movie.douban.com/subject/1291841/</span><br><span class="line">21    æ— é—´é“    9.2    686756    https://movie.douban.com/subject/1307914/</span><br><span class="line">22    ç–¯ç‹‚åŠ¨ç‰©åŸ    9.2    961506    https://movie.douban.com/subject/25662329/</span><br><span class="line">23    å½“å¹¸ç¦æ¥æ•²é—¨    9.1    870538    https://movie.douban.com/subject/1849031/</span><br><span class="line">24    æ€¦ç„¶å¿ƒåŠ¨    9.0    971877    https://movie.douban.com/subject/3319755/</span><br><span class="line">25    è§¦ä¸å¯åŠ    9.2    569502    https://movie.douban.com/subject/6786002/</span><br><span class="line">26    è™è ä¾ ï¼šé»‘æš—éª‘å£«    9.1    561534    https://movie.douban.com/subject/1851857/</span><br><span class="line">27    ä¹±ä¸–ä½³äºº    9.3    394279    https://movie.douban.com/subject/1300267/</span><br><span class="line">28    æ´»ç€    9.2    444310    https://movie.douban.com/subject/1292365/</span><br><span class="line">29    æ§æ–¹è¯äºº    9.6    199996    https://movie.douban.com/subject/1296141/</span><br><span class="line">30    å°‘å¹´æ´¾çš„å¥‡å¹»æ¼‚æµ    9.0    854147    https://movie.douban.com/subject/1929463/</span><br><span class="line">31    æŒ‡ç¯ç‹3ï¼šç‹è€…æ— æ•Œ    9.2    432241    https://movie.douban.com/subject/1291552/</span><br><span class="line">32    æ‘”è·¤å§ï¼çˆ¸çˆ¸    9.0    848439    https://movie.douban.com/subject/26387939/</span><br><span class="line">33    å¤©ç©ºä¹‹åŸ    9.1    507243    https://movie.douban.com/subject/1291583/</span><br><span class="line">34    é¬¼å­æ¥äº†    9.2    361061    https://movie.douban.com/subject/1291858/</span><br><span class="line">35    åäºŒæ€’æ±‰    9.4    257052    https://movie.douban.com/subject/1293182/</span><br><span class="line">36    å¤©å ‚ç”µå½±é™¢    9.2    416891    https://movie.douban.com/subject/1291828/</span><br><span class="line">37    é£å±‹ç¯æ¸¸è®°    9.0    773645    https://movie.douban.com/subject/2129039/</span><br><span class="line">38    å¤§è¯è¥¿æ¸¸ä¹‹æœˆå…‰å®ç›’    9.0    675104    https://movie.douban.com/subject/1299398/</span><br><span class="line">39    å“ˆå°”çš„ç§»åŠ¨åŸå ¡    9.0    570115    https://movie.douban.com/subject/1308807/</span><br><span class="line">40    æå‡»ä¿±ä¹éƒ¨    9.0    543030    https://movie.douban.com/subject/1292000/</span><br><span class="line">41    ç½—é©¬å‡æ—¥    9.0    576438    https://movie.douban.com/subject/1293839/</span><br><span class="line">42    æœ«ä»£çš‡å¸    9.2    354693    https://movie.douban.com/subject/1293172/</span><br><span class="line">43    å¯»æ¢¦ç¯æ¸¸è®°    9.0    811262    https://movie.douban.com/subject/20495023/</span><br><span class="line">44    é—»é¦™è¯†å¥³äºº    9.0    493633    https://movie.douban.com/subject/1298624/</span><br><span class="line">45    è¾©æŠ¤äºº    9.2    340911    https://movie.douban.com/subject/21937445/</span><br><span class="line">46    ç´ åª›    9.2    322715    https://movie.douban.com/subject/21937452/</span><br><span class="line">47    çªƒå¬é£æš´    9.1    340301    https://movie.douban.com/subject/1900841/</span><br><span class="line">48    æ­»äº¡è¯—ç¤¾    9.0    414748    https://movie.douban.com/subject/1291548/</span><br><span class="line">49    ä¸¤æ†å¤§çƒŸæª    9.1    369786    https://movie.douban.com/subject/1293350/</span><br><span class="line">50    é£è¶Šç–¯äººé™¢    9.1    373765    https://movie.douban.com/subject/1292224/</span><br><span class="line">51    æŒ‡ç¯ç‹2ï¼šåŒå¡”å¥‡å…µ    9.0    405233    https://movie.douban.com/subject/1291572/</span><br><span class="line">52    æ•™çˆ¶2    9.2    291589    https://movie.douban.com/subject/1299131/</span><br><span class="line">53    æŒ‡ç¯ç‹1ï¼šé­”æˆ’å†ç°    9.0    454776    https://movie.douban.com/subject/1291571/</span><br><span class="line">54    ç‹®å­ç‹    9.0    441123    https://movie.douban.com/subject/1301753/</span><br><span class="line">55    Vå­—ä»‡æ€é˜Ÿ    8.9    634942    https://movie.douban.com/subject/1309046/</span><br><span class="line">56    ç¾ä¸½å¿ƒçµ    9.0    442940    https://movie.douban.com/subject/1306029/</span><br><span class="line">57    é¥®é£Ÿç”·å¥³    9.1    312944    https://movie.douban.com/subject/1291818/</span><br><span class="line">58    æµ·è±šæ¹¾    9.3    246512    https://movie.douban.com/subject/3442220/</span><br><span class="line">59    æƒ…ä¹¦    8.9    544709    https://movie.douban.com/subject/1292220/</span><br><span class="line">60    ä½•ä»¥ä¸ºå®¶    9.1    353458    https://movie.douban.com/subject/30170448/</span><br><span class="line">61    é’¢ç´å®¶    9.1    293055    https://movie.douban.com/subject/1296736/</span><br><span class="line">62    å¤§é—¹å¤©å®«    9.3    190080    https://movie.douban.com/subject/1418019/</span><br><span class="line">63    æœ¬æ°æ˜Â·å·´é¡¿å¥‡äº‹    8.9    577017    https://movie.douban.com/subject/1485260/</span><br><span class="line">64    å“ˆåˆ©Â·æ³¢ç‰¹ä¸é­”æ³•çŸ³    8.9    466720    https://movie.douban.com/subject/1295038/</span><br><span class="line">65    çœ‹ä¸è§çš„å®¢äºº    8.8    635451    https://movie.douban.com/subject/26580232/</span><br><span class="line">66    é»‘å®¢å¸å›½    8.9    434713    https://movie.douban.com/subject/1291843/</span><br><span class="line">67    è¥¿è¥¿é‡Œçš„ç¾ä¸½ä¼ è¯´    8.8    552815    https://movie.douban.com/subject/1292402/</span><br><span class="line">68    å°é‹å­    9.2    218270    https://movie.douban.com/subject/1303021/</span><br><span class="line">69    ç¾å›½å¾€äº‹    9.2    248262    https://movie.douban.com/subject/1292262/</span><br><span class="line">70    æ‹¯æ•‘å¤§å…µç‘æ©    9.0    370031    https://movie.douban.com/subject/1292849/</span><br><span class="line">71    è®©å­å¼¹é£    8.8    937467    https://movie.douban.com/subject/3742360/</span><br><span class="line">72    éŸ³ä¹ä¹‹å£°    9.0    340645    https://movie.douban.com/subject/1294408/</span><br><span class="line">73    è‡´å‘½é­”æœ¯    8.8    497893    https://movie.douban.com/subject/1780330/</span><br><span class="line">74    çŒ«é¼ æ¸¸æˆ    8.9    404409    https://movie.douban.com/subject/1305487/</span><br><span class="line">75    ä¸ƒå®—ç½ª    8.8    593674    https://movie.douban.com/subject/1292223/</span><br><span class="line">76    è¢«å«Œå¼ƒçš„æ¾å­çš„ä¸€ç”Ÿ    8.9    445775    https://movie.douban.com/subject/1787291/</span><br><span class="line">77    ä½ä¿—å°è¯´    8.8    494334    https://movie.douban.com/subject/1291832/</span><br><span class="line">78    æ²‰é»˜çš„ç¾”ç¾Š    8.8    497708    https://movie.douban.com/subject/1293544/</span><br><span class="line">79    è´è¶æ•ˆåº”    8.8    548478    https://movie.douban.com/subject/1292343/</span><br><span class="line">80    æ˜¥å…‰ä¹æ³„    8.9    367593    https://movie.douban.com/subject/1292679/</span><br><span class="line">81    å‹‡æ•¢çš„å¿ƒ    8.9    388081    https://movie.douban.com/subject/1294639/</span><br><span class="line">82    å¤©ä½¿çˆ±ç¾ä¸½    8.7    657882    https://movie.douban.com/subject/1292215/</span><br><span class="line">83    ç©¿æ¡çº¹ç¡è¡£çš„ç”·å­©    9.0    256883    https://movie.douban.com/subject/3008247/</span><br><span class="line">84    å‰ªåˆ€æ‰‹çˆ±å¾·å    8.7    675841    https://movie.douban.com/subject/1292370/</span><br><span class="line">85    å¿ƒçµæ•æ‰‹    8.8    402941    https://movie.douban.com/subject/1292656/</span><br><span class="line">86    ç¦é—­å²›    8.8    537386    https://movie.douban.com/subject/2334904/</span><br><span class="line">87    å¸ƒè¾¾ä½©æ–¯å¤§é¥­åº—    8.8    500379    https://movie.douban.com/subject/11525673/</span><br><span class="line">88    é˜¿å‡¡è¾¾    8.7    787025    https://movie.douban.com/subject/1652587/</span><br><span class="line">89    å…¥æ®“å¸ˆ    8.8    401708    https://movie.douban.com/subject/2149806/</span><br><span class="line">90    å¹½çµå…¬ä¸»    8.9    336781    https://movie.douban.com/subject/1297359/</span><br><span class="line">91    åŠ å‹’æ¯”æµ·ç›—    8.7    519035    https://movie.douban.com/subject/1298070/</span><br><span class="line">92    æ‘©ç™»æ—¶ä»£    9.3    148862    https://movie.douban.com/subject/1294371/</span><br><span class="line">93    è‡´å‘½ID    8.7    455343    https://movie.douban.com/subject/1297192/</span><br><span class="line">94    æ–­èƒŒå±±    8.7    448806    https://movie.douban.com/subject/1418834/</span><br><span class="line">95    é˜³å…‰ç¿çƒ‚çš„æ—¥å­    8.8    379539    https://movie.douban.com/subject/1291875/</span><br><span class="line">96    é‡åº†æ£®æ—    8.7    471704    https://movie.douban.com/subject/1291999/</span><br><span class="line">97    ç¬¬å…­æ„Ÿ    8.8    326415    https://movie.douban.com/subject/1297630/</span><br><span class="line">98    ç‹©çŒ    9.1    196797    https://movie.douban.com/subject/6985810/</span><br><span class="line">99    å–œå‰§ä¹‹ç‹    8.7    513460    https://movie.douban.com/subject/1302425/</span><br><span class="line">100    ç›ä¸½å’Œé©¬å…‹æ€    8.9    290154    https://movie.douban.com/subject/3072124/</span><br><span class="line">101    æ¶ˆå¤±çš„çˆ±äºº    8.7    525034    https://movie.douban.com/subject/21318488/</span><br><span class="line">102    å‘Šç™½    8.7    467513    https://movie.douban.com/subject/4268598/</span><br><span class="line">103    å°æ£®æ— å¤ç§‹ç¯‡    9.0    226137    https://movie.douban.com/subject/25814705/</span><br><span class="line">104    å¤§é±¼    8.8    347484    https://movie.douban.com/subject/1291545/</span><br><span class="line">105    ä¸€ä¸€    9.0    210191    https://movie.douban.com/subject/1292434/</span><br><span class="line">106    é˜³å…‰å§å¦¹æ·˜    8.8    378032    https://movie.douban.com/subject/4917726/</span><br><span class="line">107    çˆ±åœ¨é»æ˜ç ´æ™“å‰    8.8    326958    https://movie.douban.com/subject/1296339/</span><br><span class="line">108    è¯·ä»¥ä½ çš„åå­—å‘¼å”¤æˆ‘    8.8    327024    https://movie.douban.com/subject/26799731/</span><br><span class="line">109    å°„é›•è‹±é›„ä¼ ä¹‹ä¸œæˆè¥¿å°±    8.7    384745    https://movie.douban.com/subject/1316510/</span><br><span class="line">110    ç”œèœœèœœ    8.8    307227    https://movie.douban.com/subject/1305164/</span><br><span class="line">111    ä¾§è€³å€¾å¬    8.9    256439    https://movie.douban.com/subject/1297052/</span><br><span class="line">112    çº¢è¾£æ¤’    8.9    210659    https://movie.douban.com/subject/1865703/</span><br><span class="line">113    é©¯é¾™é«˜æ‰‹    8.7    438648    https://movie.douban.com/subject/2353023/</span><br><span class="line">114    å€©å¥³å¹½é­‚    8.7    399855    https://movie.douban.com/subject/1297447/</span><br><span class="line">115    è¶…è„±    8.8    256836    https://movie.douban.com/subject/5322596/</span><br><span class="line">116    æ€äººå›å¿†    8.8    314334    https://movie.douban.com/subject/1300299/</span><br><span class="line">117    æµ·è’‚å’Œçˆ·çˆ·    9.1    142601    https://movie.douban.com/subject/25958717/</span><br><span class="line">118    ææ€–ç›´æ’­    8.7    349058    https://movie.douban.com/subject/21360417/</span><br><span class="line">119    èŠæ¬¡éƒçš„å¤å¤©    8.8    284490    https://movie.douban.com/subject/1293359/</span><br><span class="line">120    çˆ±åœ¨æ—¥è½é»„æ˜æ—¶    8.8    285141    https://movie.douban.com/subject/1291990/</span><br><span class="line">121    7å·æˆ¿çš„ç¤¼ç‰©    8.8    276596    https://movie.douban.com/subject/10777687/</span><br><span class="line">122    å°æ£®æ— å†¬æ˜¥ç¯‡    9.0    196346    https://movie.douban.com/subject/25814707/</span><br><span class="line">123    é£ä¹‹è°·    8.8    246043    https://movie.douban.com/subject/1291585/</span><br><span class="line">124    å“ˆåˆ©Â·æ³¢ç‰¹ä¸æ­»äº¡åœ£å™¨(ä¸‹)    8.7    408422    https://movie.douban.com/subject/3011235/</span><br><span class="line">125    æˆ‘ä¸æ˜¯è¯ç¥    9.0    1181641    https://movie.douban.com/subject/26752088/</span><br><span class="line">126    å¹¸ç¦ç»ˆç‚¹ç«™    8.7    310524    https://movie.douban.com/subject/1292274/</span><br><span class="line">127    è™è ä¾ ï¼šé»‘æš—éª‘å£«å´›èµ·    8.7    415939    https://movie.douban.com/subject/3395373/</span><br><span class="line">128    ä¸Šå¸ä¹‹åŸ    8.9    200345    https://movie.douban.com/subject/1292208/</span><br><span class="line">129    è¤ç«ä¹‹æ£®    8.8    261708    https://movie.douban.com/subject/5989818/</span><br><span class="line">130    å€Ÿä¸œè¥¿çš„å°äººé˜¿è‰åŸƒè’‚    8.8    308863    https://movie.douban.com/subject/4202302/</span><br><span class="line">131    è¶…èƒ½é™†æˆ˜é˜Ÿ    8.6    565299    https://movie.douban.com/subject/11026735/</span><br><span class="line">132    å”ä¼¯è™ç‚¹ç§‹é¦™    8.5    545655    https://movie.douban.com/subject/1306249/</span><br><span class="line">133    ç¥å·å¥¶çˆ¸    8.5    572719    https://movie.douban.com/subject/3287562/</span><br><span class="line">134    æ— äººçŸ¥æ™“    9.1    133082    https://movie.douban.com/subject/1292337/</span><br><span class="line">135    æ€ªå…½ç”µåŠ›å…¬å¸    8.7    363701    https://movie.douban.com/subject/1291579/</span><br><span class="line">136    ç”µé”¯æƒŠé­‚    8.7    287704    https://movie.douban.com/subject/1417598/</span><br><span class="line">137    å²æœˆç¥å·    8.7    394423    https://movie.douban.com/subject/3792799/</span><br><span class="line">138    ç©å…·æ€»åŠ¨å‘˜3    8.8    278994    https://movie.douban.com/subject/1858711/</span><br><span class="line">139    è¡€æˆ˜é’¢é”¯å²­    8.7    472814    https://movie.douban.com/subject/26325320/</span><br><span class="line">140    è°å½±é‡é‡3    8.8    254835    https://movie.douban.com/subject/1578507/</span><br><span class="line">141    ç–¯ç‹‚åŸå§‹äºº    8.7    518689    https://movie.douban.com/subject/1907966/</span><br><span class="line">142    ä¸ƒæ­¦å£«    9.2    108944    https://movie.douban.com/subject/1295399/</span><br><span class="line">143    è‹±é›„æœ¬è‰²    8.7    276917    https://movie.douban.com/subject/1297574/</span><br><span class="line">144    å–œå®´    8.9    195228    https://movie.douban.com/subject/1303037/</span><br><span class="line">145    çœŸçˆ±è‡³ä¸Š    8.6    430547    https://movie.douban.com/subject/1292401/</span><br><span class="line">146    è¤ç«è™«ä¹‹å¢“    8.7    272296    https://movie.douban.com/subject/1293318/</span><br><span class="line">147    ä¸œé‚ªè¥¿æ¯’    8.6    362487    https://movie.douban.com/subject/1292328/</span><br><span class="line">148    å‚²æ…¢ä¸åè§    8.5    430151    https://movie.douban.com/subject/1418200/</span><br><span class="line">149    æ—¶ç©ºæ‹æ—…äºº    8.7    302907    https://movie.douban.com/subject/10577869/</span><br><span class="line">150    è´«æ°‘çªŸçš„ç™¾ä¸‡å¯Œç¿    8.6    497991    https://movie.douban.com/subject/2209573/</span><br><span class="line">151    é»‘å¤©é¹…    8.5    549429    https://movie.douban.com/subject/1978709/</span><br><span class="line">152    è®°å¿†ç¢ç‰‡    8.6    373474    https://movie.douban.com/subject/1304447/</span><br><span class="line">153    å¿ƒè¿·å®«    8.7    274327    https://movie.douban.com/subject/25917973/</span><br><span class="line">154    çºµæ¨ªå››æµ·    8.8    226602    https://movie.douban.com/subject/1295409/</span><br><span class="line">155    æ•™çˆ¶3    8.8    191865    https://movie.douban.com/subject/1294240/</span><br><span class="line">156    è’è›®æ•…äº‹    8.8    223635    https://movie.douban.com/subject/24750126/</span><br><span class="line">157    å®Œç¾çš„ä¸–ç•Œ    9.1    123076    https://movie.douban.com/subject/1300992/</span><br><span class="line">158    è¾¾æ‹‰æ–¯ä¹°å®¶ä¿±ä¹éƒ¨    8.7    264828    https://movie.douban.com/subject/1793929/</span><br><span class="line">159    é›¨äºº    8.7    267637    https://movie.douban.com/subject/1291870/</span><br><span class="line">160    ä¸‰å—å¹¿å‘Šç‰Œ    8.7    493952    https://movie.douban.com/subject/26611804/</span><br><span class="line">161    èŠ±æ ·å¹´å    8.6    337477    https://movie.douban.com/subject/1291557/</span><br><span class="line">162    è¢«è§£æ•‘çš„å§œæˆˆ    8.7    357721    https://movie.douban.com/subject/6307447/</span><br><span class="line">163    å¢æ—ºè¾¾é¥­åº—    8.9    161524    https://movie.douban.com/subject/1291822/</span><br><span class="line">164    ä½ çš„åå­—ã€‚    8.4    757251    https://movie.douban.com/subject/26683290/</span><br><span class="line">165    æµ·è¾¹çš„æ›¼å½»æ–¯ç‰¹    8.6    294826    https://movie.douban.com/subject/25980443/</span><br><span class="line">166    æˆ‘æ˜¯å±±å§†    8.9    155512    https://movie.douban.com/subject/1306861/</span><br><span class="line">167    å¤´è„‘ç‰¹å·¥é˜Ÿ    8.7    340013    https://movie.douban.com/subject/10533913/</span><br><span class="line">168    ä½ çœ‹èµ·æ¥å¥½åƒå¾ˆå¥½åƒ    8.8    202385    https://movie.douban.com/subject/4848115/</span><br><span class="line">169    æ‹æ‹ç¬”è®°æœ¬    8.5    385616    https://movie.douban.com/subject/1309163/</span><br><span class="line">170    å“ªå’é—¹æµ·    9.0    129640    https://movie.douban.com/subject/1307315/</span><br><span class="line">171    æ— æ•Œç ´åç‹    8.7    306834    https://movie.douban.com/subject/6534248/</span><br><span class="line">172    è™å£è„±é™©    8.9    141090    https://movie.douban.com/subject/1296909/</span><br><span class="line">173    å†°å·æ—¶ä»£    8.5    379209    https://movie.douban.com/subject/1291578/</span><br><span class="line">174    äºŒåäºŒ    8.7    168873    https://movie.douban.com/subject/26430107/</span><br><span class="line">175    æµ·æ´‹    9.0    116507    https://movie.douban.com/subject/3443389/</span><br><span class="line">176    é›¨ä¸­æ›²    9.0    125013    https://movie.douban.com/subject/1293460/</span><br><span class="line">177    çˆ†è£‚é¼“æ‰‹    8.7    324492    https://movie.douban.com/subject/25773932/</span><br><span class="line">178    æœªéº»çš„éƒ¨å±‹    8.9    147477    https://movie.douban.com/subject/1395091/</span><br><span class="line">179    æ¨¡ä»¿æ¸¸æˆ    8.6    355368    https://movie.douban.com/subject/10463953/</span><br><span class="line">180    ä¸€ä¸ªå«æ¬§ç»´çš„ç”·äººå†³å®šå»æ­»    8.8    195643    https://movie.douban.com/subject/26628357/</span><br><span class="line">181    å¿ çŠ¬å…«å…¬ç‰©è¯­    9.1    96747    https://movie.douban.com/subject/1959195/</span><br><span class="line">182    ç‡ƒæƒ…å²æœˆ    8.8    185142    https://movie.douban.com/subject/1295865/</span><br><span class="line">183    äººå·¥æ™ºèƒ½    8.6    258634    https://movie.douban.com/subject/1302827/</span><br><span class="line">184    é­”å¥³å®…æ€¥ä¾¿    8.6    281054    https://movie.douban.com/subject/1307811/</span><br><span class="line">185    æˆ¿é—´    8.8    229618    https://movie.douban.com/subject/25724855/</span><br><span class="line">186    ç©¿è¶Šæ—¶ç©ºçš„å°‘å¥³    8.6    250139    https://movie.douban.com/subject/1937946/</span><br><span class="line">187    å¤©ä¹¦å¥‡è°­    9.1    91667    https://movie.douban.com/subject/1428581/</span><br><span class="line">188    ææ€–æ¸¸è½®    8.4    459129    https://movie.douban.com/subject/3011051/</span><br><span class="line">189    é­‚æ–­è“æ¡¥    8.8    164770    https://movie.douban.com/subject/1293964/</span><br><span class="line">190    é»‘å®¢å¸å›½3ï¼šçŸ©é˜µé©å‘½    8.7    225709    https://movie.douban.com/subject/1302467/</span><br><span class="line">191    æµ·è¡—æ—¥è®°    8.7    214152    https://movie.douban.com/subject/25895901/</span><br><span class="line">192    çŒœç«è½¦    8.5    306564    https://movie.douban.com/subject/1292528/</span><br><span class="line">193    ç½—ç”Ÿé—¨    8.8    175470    https://movie.douban.com/subject/1291879/</span><br><span class="line">194    å®Œç¾é™Œç”Ÿäºº    8.5    333893    https://movie.douban.com/subject/26614893/</span><br><span class="line">195    é˜¿é£æ­£ä¼     8.5    295833    https://movie.douban.com/subject/1305690/</span><br><span class="line">196    å¤´å·ç©å®¶    8.7    823877    https://movie.douban.com/subject/4920389/</span><br><span class="line">197    é¦™æ°´    8.5    362383    https://movie.douban.com/subject/1760622/</span><br><span class="line">198    åŠŸå¤«    8.4    465611    https://movie.douban.com/subject/1291543/</span><br><span class="line">199    å¯å¯è¥¿é‡Œ    8.7    171199    https://movie.douban.com/subject/1308857/</span><br><span class="line">200    æœ—è¯»è€…    8.5    333438    https://movie.douban.com/subject/2213597/</span><br><span class="line">201    è°å½±é‡é‡2    8.6    219036    https://movie.douban.com/subject/1308767/</span><br><span class="line">202    æµªæ½®    8.7    173378    https://movie.douban.com/subject/2297265/</span><br><span class="line">203    ç‰¯å²­è¡—å°‘å¹´æ€äººäº‹ä»¶    8.8    149429    https://movie.douban.com/subject/1292329/</span><br><span class="line">204    è°å½±é‡é‡    8.6    261073    https://movie.douban.com/subject/1304102/</span><br><span class="line">205    æˆ˜äº‰ä¹‹ç‹    8.6    224942    https://movie.douban.com/subject/1419936/</span><br><span class="line">206    åœ°çƒä¸Šçš„æ˜Ÿæ˜Ÿ    8.9    120790    https://movie.douban.com/subject/2363506/</span><br><span class="line">207    ç–¯ç‹‚çš„çŸ³å¤´    8.4    452026    https://movie.douban.com/subject/1862151/</span><br><span class="line">208    åˆæ‹è¿™ä»¶å°äº‹    8.3    633902    https://movie.douban.com/subject/4739952/</span><br><span class="line">209    é’è›‡    8.5    303900    https://movie.douban.com/subject/1303394/</span><br><span class="line">210    æƒŠé­‚è®°    8.9    120359    https://movie.douban.com/subject/1293181/</span><br><span class="line">211    ç»ˆç»“è€…2ï¼šå®¡åˆ¤æ—¥    8.6    198690    https://movie.douban.com/subject/1291844/</span><br><span class="line">212    æºä»£ç     8.4    520617    https://movie.douban.com/subject/3075287/</span><br><span class="line">213    çˆ±åœ¨åˆå¤œé™ä¸´å‰    8.8    167120    https://movie.douban.com/subject/10808442/</span><br><span class="line">214    æ­¥å±¥ä¸åœ    8.8    139427    https://movie.douban.com/subject/2222996/</span><br><span class="line">215    æ–°é¾™é—¨å®¢æ ˆ    8.5    258004    https://movie.douban.com/subject/1292287/</span><br><span class="line">216    å¥‡è¿¹ç”·å­©    8.6    323039    https://movie.douban.com/subject/26787574/</span><br><span class="line">217    å°èè‰çš„çŒ´ç¥å¤§å”    8.5    271364    https://movie.douban.com/subject/26393561/</span><br><span class="line">218    è¿½éš    8.9    108391    https://movie.douban.com/subject/1397546/</span><br><span class="line">219    ä¸€æ¬¡åˆ«ç¦»    8.7    168140    https://movie.douban.com/subject/5964718/</span><br><span class="line">220    æ— è€»æ··è›‹    8.5    294062    https://movie.douban.com/subject/1438652/</span><br><span class="line">221    å†æ¬¡å‡ºå‘ä¹‹çº½çº¦é‡è§ä½     8.5    245335    https://movie.douban.com/subject/6874403/</span><br><span class="line">222    é‡œå±±è¡Œ    8.4    561902    https://movie.douban.com/subject/25986180/</span><br><span class="line">223    è¡€é’»    8.6    196331    https://movie.douban.com/subject/1428175/</span><br><span class="line">224    ä¸œäº¬ç‰©è¯­    9.2    72955    https://movie.douban.com/subject/1291568/</span><br><span class="line">225    æ’è½¦    8.6    219372    https://movie.douban.com/subject/1388216/</span><br><span class="line">226    å½—æ˜Ÿæ¥çš„é‚£ä¸€å¤œ    8.5    276087    https://movie.douban.com/subject/25807345/</span><br><span class="line">227    åŸå¸‚ä¹‹å…‰    9.3    65047    https://movie.douban.com/subject/1293908/</span><br><span class="line">228    2001å¤ªç©ºæ¼«æ¸¸    8.7    149476    https://movie.douban.com/subject/1292226/</span><br><span class="line">229    æ¢¦ä¹‹å®‰é­‚æ›²    8.7    144757    https://movie.douban.com/subject/1292270/</span><br><span class="line">230    æ–°ä¸–ç•Œ    8.7    149430    https://movie.douban.com/subject/10437779/</span><br><span class="line">231    ç»¿é‡Œå¥‡è¿¹    8.7    145109    https://movie.douban.com/subject/1300374/</span><br><span class="line">232    ç–¯ç‹‚çš„éº¦å…‹æ–¯4ï¼šç‹‚æš´ä¹‹è·¯    8.6    296326    https://movie.douban.com/subject/3592854/</span><br><span class="line">233    èšç„¦    8.8    172697    https://movie.douban.com/subject/25954475/</span><br><span class="line">234    E.T. å¤–æ˜Ÿäºº    8.5    211210    https://movie.douban.com/subject/1294638/</span><br><span class="line">235    è¿™ä¸ªç”·äººæ¥è‡ªåœ°çƒ    8.5    244977    https://movie.douban.com/subject/2300586/</span><br><span class="line">236    æœ«è·¯ç‹‚èŠ±    8.7    138086    https://movie.douban.com/subject/1291992/</span><br><span class="line">237    é»‘é¹°å è½    8.6    169479    https://movie.douban.com/subject/1291824/</span><br><span class="line">238    å‘æ¡æ©™    8.5    237973    https://movie.douban.com/subject/1292233/</span><br><span class="line">239    é—æ„¿æ¸…å•    8.6    191251    https://movie.douban.com/subject/1867345/</span><br><span class="line">240    å˜è„¸    8.4    272586    https://movie.douban.com/subject/1292659/</span><br><span class="line">241    å‹‡é—¯å¤ºå‘½å²›    8.6    182137    https://movie.douban.com/subject/1292728/</span><br><span class="line">242    å›½ç‹çš„æ¼”è®²    8.4    435891    https://movie.douban.com/subject/4023638/</span><br><span class="line">243    æˆ‘çˆ±ä½     9.0    84663    https://movie.douban.com/subject/5908478/</span><br><span class="line">244    é»„é‡‘ä¸‰é•–å®¢    9.1    71082    https://movie.douban.com/subject/1401118/</span><br><span class="line">245    åƒé’§ä¸€å‘    8.7    131207    https://movie.douban.com/subject/1300117/</span><br><span class="line">246    éå¸¸å«Œç–‘çŠ¯    8.6    163295    https://movie.douban.com/subject/1292214/</span><br><span class="line">247    ç§’é€Ÿ5å˜ç±³    8.3    412652    https://movie.douban.com/subject/2043546/</span><br><span class="line">248    é©´å¾—æ°´    8.3    502838    https://movie.douban.com/subject/25921812/</span><br><span class="line">249    å¡è¨å¸ƒå…°å¡    8.6    160541    https://movie.douban.com/subject/1296753/</span><br><span class="line">250    å››ä¸ªæ˜¥å¤©    8.9    87331    https://movie.douban.com/subject/27191492/</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Golang </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Go </tag>
            
            <tag> çˆ¬è™« </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>PHP foreachå¾ªç¯ä½¿ç”¨&amp;å¼•ç”¨çš„å°å‘</title>
      <link href="/2019/08/07/PHP-foreach%E5%BE%AA%E7%8E%AF%E4%BD%BF%E7%94%A8-%E5%BC%95%E7%94%A8%E7%9A%84%E5%B0%8F%E5%9D%91/"/>
      <url>/2019/08/07/PHP-foreach%E5%BE%AA%E7%8E%AF%E4%BD%BF%E7%94%A8-%E5%BC%95%E7%94%A8%E7%9A%84%E5%B0%8F%E5%9D%91/</url>
      
        <content type="html"><![CDATA[<p>æºèµ·ï¼šä»Šå¤©æœ‰å°ğŸ”¥ä¼´å‘äº†ä¸€æ®µ <code>PHP</code> ä»£ç é—®æ‰§è¡Œç»“æœå’Œå¸¸è§„é€»è¾‘æ€è€ƒğŸ¤”ç»“æœä¸ºå•¥ä¹ˆä¸ä¸€æ ·ã€‚ä»£ç å¦‚ä¸‹ï¼Œå½“æ—¶åªæ˜¯è¯´å’Œ <code>foreach</code> ä½¿ç”¨ <code>&amp;</code> æœ‰å…³ã€‚ä¹Ÿæ²¡æ·±å…¥æ€è€ƒåˆ°åº•æ˜¯ä»€ä¹ˆå…³ç³»ï¼Œåˆç¡è¿‡åï¼Œå¿ƒè¡€æ¥æ½®çš„æƒ³ææè¿™ä¸ªé—®é¢˜ï¼Œæ•…åšå¦‚ä¸‹è®°å½•ã€‚<a id="more"></a></p><p><strong>å°ä¼™ä¼´ç»™çš„åŸå§‹ä»£ç å¦‚ä¸‹</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line">    $arr = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">8</span>];</span><br><span class="line">    <span class="keyword">foreach</span> ($arr <span class="keyword">as</span> &amp;$val) &#123;</span><br><span class="line">        <span class="comment">//å››æ¬¡å¾ªç¯è¿­ä»£åä¾æ¬¡è¾“å‡º 1, 2, 4, 8; æ²¡ä»»ä½•æ¯›ç—…</span></span><br><span class="line">        <span class="keyword">echo</span> $val . PHP_EOL;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    print_r($arr);</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">"************************"</span> . PHP_EOL;</span><br><span class="line">    <span class="keyword">foreach</span> ($arr <span class="keyword">as</span> $val) &#123;</span><br><span class="line">        print_r($arr);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">echo</span> $val . PHP_EOL;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"###################"</span> . PHP_EOL;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//echo ä¾æ¬¡æ‰“å°çš„æ˜¯ï¼š 1ï¼Œ2ï¼Œ4ï¼Œ4 [(O_O)]?</span></span><br></pre></td></tr></table></figure><p><strong>ä»£ç æ‰§è¡Œç»“æœå¦‚ä¸‹å›¾</strong></p><p><img src="/images/blog/201908/0-PHP-foreach%E5%BE%AA%E7%8E%AF%E4%BD%BF%E7%94%A8-%E5%BC%95%E7%94%A8%E7%9A%84%E5%B0%8F%E5%9D%91.jpeg" alt></p><p>é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œç¬¬ä¸€æ¬¡è¾“å‡º <code>1ï¼Œ2ï¼Œ4ï¼Œ8</code> æ²¡æœ‰ä»»ä½•é—®é¢˜ã€‚ä½†æ˜¯ï¼Œä½†æ˜¯ï¼Œä½†æ˜¯ä¸ºä»€ä¹ˆç¬¬äºŒæ¬¡è¾“å‡ºçš„æ˜¯ <code>1, 2, 4, 4</code> è€Œä¸æ˜¯ <code>1ã€2 4ã€8</code> å‘¢ï¼ŸæŸ¥è¯¢ <a href="https://www.php.net/manual/zh/control-structures.foreach.php" target="_blank" rel="noopener">PHP foreach æ–‡æ¡£</a> æœ‰è¾£ä¹ˆä¸€å¥ç‰¹åˆ«æé†’</p><h6 id="Warning-æ•°ç»„æœ€åä¸€ä¸ªå…ƒç´ çš„-value-å¼•ç”¨åœ¨-foreach-å¾ªç¯ä¹‹åä»ä¼šä¿ç•™ã€‚å»ºè®®ä½¿ç”¨-unset-æ¥å°†å…¶é”€æ¯ã€‚"><a href="#Warning-æ•°ç»„æœ€åä¸€ä¸ªå…ƒç´ çš„-value-å¼•ç”¨åœ¨-foreach-å¾ªç¯ä¹‹åä»ä¼šä¿ç•™ã€‚å»ºè®®ä½¿ç”¨-unset-æ¥å°†å…¶é”€æ¯ã€‚" class="headerlink" title="Warning æ•°ç»„æœ€åä¸€ä¸ªå…ƒç´ çš„ $value å¼•ç”¨åœ¨ foreach å¾ªç¯ä¹‹åä»ä¼šä¿ç•™ã€‚å»ºè®®ä½¿ç”¨ unset() æ¥å°†å…¶é”€æ¯ã€‚"></a><code>Warning æ•°ç»„æœ€åä¸€ä¸ªå…ƒç´ çš„ $value å¼•ç”¨åœ¨ foreach å¾ªç¯ä¹‹åä»ä¼šä¿ç•™ã€‚å»ºè®®ä½¿ç”¨ unset() æ¥å°†å…¶é”€æ¯ã€‚</code></h6><p>çœ‹æ­¤æç¤ºï¼Œå†¥å†¥ä¹‹ä¸­å¥½åƒçŸ¥é“äº†ç­”æ¡ˆã€‚</p><ul><li>ç¬¬ä¸€æ¬¡ <code>foreach</code> ç”±äºä½¿ç”¨çš„æ˜¯ <code>&amp; å¼•ç”¨èµ‹å€¼</code>ï¼Œåœ¨å¾ªç¯å®Œæˆåå¦‚æœæ²¡æœ‰ <code>unset($val)</code> ä¼šä¿ç•™æœ€åä¸€ä¸ªå…ƒç´ çš„ <code>$valå¼•ç”¨</code></li></ul><ul><li>ç¬¬äºŒæ¬¡ <code>foreach</code> ç”±äºä½¿ç”¨çš„å’Œç¬¬ä¸€æ¬¡åŒæ ·çš„è¿­ä»£å˜é‡ <code>$val</code>,  æ•°ç»„çš„æœ€åä¸€ä¸ªå…ƒç´  <code>$arr[3]</code> å’Œå½“å‰å¾ªç¯è¿­ä»£å€¼ <code>$val</code> æŒ‡å‘åŒä¸€ä¸ªå˜é‡åœ°å€ï¼Œæ­¤æ—¶ <code>$val</code> å€¼æ”¹å˜æ—¶ <code>$arr[3]</code> çš„å€¼ä¹Ÿè·Ÿç€æ”¹å˜äº†ã€‚</li></ul><p><strong>ç”¨ä¸Šå›¾è¯´æ˜</strong></p><ul><li><p>åŸå§‹æ•°ç»„ä¸ºå›¾ä¸­ <code>AåŒºåŸŸ</code> æ•°ç»„</p></li><li><p>ç¬¬ <code>0</code> æ¬¡å¾ªç¯è¿­ä»£ï¼šæœ€åä¸€ä¸ªå…ƒç´  <code>$arr[3]</code> å’Œ <code>$val å³($arr[0])</code> å€¼ç›¸åŒã€‚<code>$arr[3] = $val = 1</code>ï¼Œå¦‚å›¾ä¸­ <code>0åŒºåŸŸ</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Array</span><br><span class="line">(</span><br><span class="line">    [0] =&gt; 1</span><br><span class="line">    [1] =&gt; 2</span><br><span class="line">    [2] =&gt; 4</span><br><span class="line">    [3] =&gt; 1</span><br><span class="line">)</span><br><span class="line">ç¬¬0æ¬¡å¾ªç¯ç»“æœï¼š1</span><br></pre></td></tr></table></figure></li><li><p>ç¬¬ <code>1</code> æ¬¡å¾ªç¯è¿­ä»£ï¼šæœ€åä¸€ä¸ªå…ƒç´  <code>$arr[3]</code> å’Œ <code>$val å³($arr[1])</code> å€¼ç›¸åŒã€‚<code>$arr[3] = $val = 2</code>ï¼Œå¦‚å›¾ä¸­ <code>1åŒºåŸŸ</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Array</span><br><span class="line">(</span><br><span class="line">    [0] =&gt; 1</span><br><span class="line">    [1] =&gt; 2</span><br><span class="line">    [2] =&gt; 4</span><br><span class="line">    [3] =&gt; 2</span><br><span class="line">)</span><br><span class="line">ç¬¬1æ¬¡å¾ªç¯ç»“æœï¼š2</span><br></pre></td></tr></table></figure></li><li><p>ç¬¬ <code>2</code> æ¬¡å¾ªç¯è¿­ä»£ï¼šæœ€åä¸€ä¸ªå…ƒç´  <code>$arr[3]</code> å’Œ <code>$val å³($arr[2])</code> å€¼ç›¸åŒã€‚<code>$arr[3] = $val = 4</code>ï¼Œå¦‚å›¾ä¸­ <code>2åŒºåŸŸ</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Array</span><br><span class="line">(</span><br><span class="line">    [0] =&gt; 1</span><br><span class="line">    [1] =&gt; 2</span><br><span class="line">    [2] =&gt; 4</span><br><span class="line">    [3] =&gt; 4</span><br><span class="line">)</span><br><span class="line">ç¬¬2æ¬¡å¾ªç¯ç»“æœï¼š4</span><br></pre></td></tr></table></figure></li><li><p>ç¬¬ <code>3</code> æ¬¡å¾ªç¯è¿­ä»£ï¼šæœ€åä¸€ä¸ªå…ƒç´  <code>$arr[3]</code> å’Œ <code>$val å³($arr[3])</code> å€¼ç›¸åŒã€‚<code>$arr[3] = $val = 4</code>ï¼Œå¦‚å›¾ä¸­ <code>3åŒºåŸŸ</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Array</span><br><span class="line">(</span><br><span class="line">    [0] =&gt; 1</span><br><span class="line">    [1] =&gt; 2</span><br><span class="line">    [2] =&gt; 4</span><br><span class="line">    [3] =&gt; 4</span><br><span class="line">)</span><br><span class="line">ç¬¬2æ¬¡å¾ªç¯ç»“æœï¼š4</span><br></pre></td></tr></table></figure></li><li><p>ç»¼ä¸Šï¼Œç¬¬äºŒæ¬¡å¾ªç¯ <code>1, 2, 4, 4</code> å°±æ˜¯è¿™ä¹ˆæ¥çš„ ğŸ˜œ</p></li></ul>]]></content>
      
      
      <categories>
          
          <category> PHP </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç¼–ç¨‹ </tag>
            
            <tag> PHP </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Golangçˆ¬è™«ç³»åˆ—é›¶ï¼šçˆ¬å–ç™¾åº¦è´´å§å†…å®¹</title>
      <link href="/2019/08/04/golang%E7%88%AC%E5%8F%96%E7%99%BE%E5%BA%A6%E8%B4%B4%E5%90%A7%E5%86%85%E5%AE%B9/"/>
      <url>/2019/08/04/golang%E7%88%AC%E5%8F%96%E7%99%BE%E5%BA%A6%E8%B4%B4%E5%90%A7%E5%86%85%E5%AE%B9/</url>
      
        <content type="html"><![CDATA[<h6 id="å£°æ˜ï¼šä»¥ä¸‹å†…å®¹ä»…ä¾›æŠ€æœ¯å­¦ä¹ "><a href="#å£°æ˜ï¼šä»¥ä¸‹å†…å®¹ä»…ä¾›æŠ€æœ¯å­¦ä¹ " class="headerlink" title="å£°æ˜ï¼šä»¥ä¸‹å†…å®¹ä»…ä¾›æŠ€æœ¯å­¦ä¹ "></a>å£°æ˜ï¼šä»¥ä¸‹å†…å®¹ä»…ä¾›æŠ€æœ¯å­¦ä¹ </h6><h5 id="çˆ¬è™«å®ç°æ­¥éª¤"><a href="#çˆ¬è™«å®ç°æ­¥éª¤" class="headerlink" title="çˆ¬è™«å®ç°æ­¥éª¤"></a>çˆ¬è™«å®ç°æ­¥éª¤</h5><p>1ï¼šè·å–éœ€è¦çˆ¬å–URLçš„åœ°å€ï¼ˆä»¥ <a href="http://tieba.baidu.com/f?kw=javascript&ie=utf-8" target="_blank" rel="noopener"><code>JavaScriptå§</code></a> ä¸¾ä¾‹ï¼‰</p><a id="more"></a><pre><code>http://tieba.baidu.com/f?kw=javascript&amp;ie=utf-8&amp;pn=0http://tieba.baidu.com/f?kw=javascript&amp;ie=utf-8&amp;pn=50http://tieba.baidu.com/f?kw=javascript&amp;ie=utf-8&amp;pn=150</code></pre><p>2ï¼šä½¿ç”¨ http.Get(url) è·å–åˆ°æ¯ä¸€ä¸ªURLçš„å†…å®¹</p><p>3ï¼šå°†æˆ–å¾—åˆ°URLçš„å†…å®¹å†™å…¥æ–‡ä»¶</p><p><strong>æ³¨æ„æ–‡ä»¶å‘½å</strong></p><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">"fmt"</span></span><br><span class="line">    <span class="string">"net/http"</span></span><br><span class="line">    <span class="string">"io"</span></span><br><span class="line">    <span class="string">"strconv"</span></span><br><span class="line">    <span class="string">"os"</span></span><br><span class="line">    <span class="string">"time"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">//è´´å§çš„URL</span></span><br><span class="line"><span class="comment">//http://tieba.baidu.com/f?kw=javascript&amp;ie=utf-8&amp;pn=0</span></span><br><span class="line"><span class="comment">//http://tieba.baidu.com/f?kw=javascript&amp;ie=utf-8&amp;pn=50</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    start := time.Now()</span><br><span class="line">    <span class="comment">//ç¡®è®¤èµ·å§‹é¡µå’Œç»ˆæ­¢é¡µ</span></span><br><span class="line">    <span class="keyword">var</span> startPage <span class="keyword">int</span></span><br><span class="line">    <span class="keyword">var</span> endPage <span class="keyword">int</span></span><br><span class="line">    fmt.Print(<span class="string">"è¯·è¾“å…¥èµ·å§‹é¡µ:"</span>)</span><br><span class="line">    fmt.Scanln(&amp;startPage)</span><br><span class="line">    <span class="keyword">if</span> startPage &lt;= <span class="number">1</span> &#123;</span><br><span class="line">        startPage = <span class="number">1</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    fmt.Print(<span class="string">"è¯·è¾“å…¥ç»ˆæ­¢é¡µ:"</span>)</span><br><span class="line">    fmt.Scanln(&amp;endPage)</span><br><span class="line">    <span class="keyword">if</span> endPage &lt;= <span class="number">1</span> &#123;</span><br><span class="line">        endPage = <span class="number">1</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    working(startPage, endPage)</span><br><span class="line">    cost := time.Since(start)</span><br><span class="line">    fmt.Printf(<span class="string">"è€—æ—¶ = [%s] "</span>, cost)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">working</span><span class="params">(startPage, endPage <span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">    fmt.Printf(<span class="string">"æ­£åœ¨çˆ¬å–ç¬¬%dé¡µåˆ°%dé¡µçš„ä¿¡æ¯...\n"</span>, startPage, endPage)</span><br><span class="line"></span><br><span class="line">    pageChan := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">int</span>)</span><br><span class="line">    <span class="comment">//å¾ªç¯çˆ¬å–æ¯ä¸€é¡µ</span></span><br><span class="line">    <span class="keyword">for</span> i := startPage; i &lt;= endPage; i++ &#123;</span><br><span class="line">        <span class="comment">//å¼€å¯åç¨‹</span></span><br><span class="line">        <span class="keyword">go</span> SpiderPage(i, pageChan)</span><br><span class="line">        <span class="comment">//SpiderPage(i, pageChan)</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i := startPage; i &lt;= endPage; i++ &#123;</span><br><span class="line">        <span class="comment">//å¼€å¯åç¨‹</span></span><br><span class="line">        fmt.Printf(<span class="string">"ç¬¬ %d é¡µ çˆ¬å–å®Œæˆ\n"</span>, &lt;-pageChan)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//çˆ¬å–å•ä¸ªé¡µé¢çš„å‡½æ•°</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">SpiderPage</span><span class="params">(i <span class="keyword">int</span>, pageChan <span class="keyword">chan</span> <span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">    baseUrl := <span class="string">"http://tieba.baidu.com/f?kw=javascript&amp;ie=utf-8&amp;pn="</span> + strconv.Itoa((i<span class="number">-1</span>)*<span class="number">50</span>)</span><br><span class="line">    fmt.Println(<span class="string">"æ­£åœ¨è·å–ç¬¬"</span>, i, <span class="string">"é¡µçš„å†…å®¹"</span>)</span><br><span class="line">    result, err := httpGetUrl(baseUrl)</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        fmt.Println(<span class="string">"http get error, Msg"</span>, err.Error())</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//å°†è¯»å–åˆ°çš„æ•°æ®å­˜å‚¨å­˜å‚¨ä¸ºæ–‡ä»¶</span></span><br><span class="line">    file, err := os.Create(<span class="string">"JavaScript_"</span> + strconv.Itoa(i) + <span class="string">".html"</span>)</span><br><span class="line">    <span class="keyword">if</span> err != err &#123;</span><br><span class="line">        fmt.Println(<span class="string">"os Create errï¼š"</span>, err.Error())</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    file.WriteString(result)</span><br><span class="line">    file.Close() <span class="comment">//ä¿å­˜å¥½ä¸€ä¸ªæ–‡ä»¶å°±å…³é—­ä¸€ä¸ªæ–‡ä»¶</span></span><br><span class="line">    pageChan &lt;- i</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//çˆ¬å–å†…å®¹</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">httpGetUrl</span><span class="params">(url <span class="keyword">string</span>)</span> <span class="params">(result <span class="keyword">string</span>, err error)</span></span> &#123;</span><br><span class="line">    resp, err1 := http.Get(url)</span><br><span class="line">    <span class="keyword">if</span> err1 != <span class="literal">nil</span> &#123;</span><br><span class="line">        err = err1</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//å…³é—­</span></span><br><span class="line">    <span class="keyword">defer</span> resp.Body.Close()</span><br><span class="line"></span><br><span class="line">    <span class="comment">//è¯»å–æ•°æ®</span></span><br><span class="line">    buffer := <span class="built_in">make</span>([]<span class="keyword">byte</span>, <span class="number">8196</span>)</span><br><span class="line">    <span class="keyword">for</span> &#123;</span><br><span class="line">        <span class="comment">//è¯»å–çš„å†…å®¹è‡³äºbufferå®¹å™¨</span></span><br><span class="line">        n, err2 := resp.Body.Read(buffer)</span><br><span class="line">        <span class="keyword">if</span> n == <span class="number">0</span> &#123;</span><br><span class="line">            fmt.Println(<span class="string">"è¯»å–ç½‘é¡µå®Œæˆ"</span>)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> err2 != <span class="literal">nil</span> &amp;&amp; err2 != io.EOF &#123;</span><br><span class="line">            err = err2</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//ç´¯æ¬¡ç›¸åŠ æ¯ä¸€æ¬¡è¯»åˆ°çš„Bufferæ•°æ®ï¼Œå­˜å…¥result, ä¸€æ¬¡æ€§è¿”å›</span></span><br><span class="line">        result += <span class="keyword">string</span>(buffer[:n])</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line"><span class="string">`</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Golang </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Go </tag>
            
            <tag> çˆ¬è™« </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ç¨‹åºå‘˜æ•°å­¦åŸºç¡€ ä¹‹ çŸ©é˜µ</title>
      <link href="/2019/08/03/%E7%A8%8B%E5%BA%8F%E5%91%98%E6%95%B0%E5%AD%A6%E4%B9%8B%E7%9F%A9%E9%98%B5/"/>
      <url>/2019/08/03/%E7%A8%8B%E5%BA%8F%E5%91%98%E6%95%B0%E5%AD%A6%E4%B9%8B%E7%9F%A9%E9%98%B5/</url>
      
        <content type="html"><![CDATA[<h6 id="1ï¼šçŸ©é˜µç›¸åŠ "><a href="#1ï¼šçŸ©é˜µç›¸åŠ " class="headerlink" title="1ï¼šçŸ©é˜µç›¸åŠ "></a>1ï¼šçŸ©é˜µç›¸åŠ </h6><a id="more"></a><p><img src="/images/blog/201908/1-%E7%9F%A9%E9%98%B5%E7%9B%B8%E5%8A%A0.jpg" alt></p><h6 id="2ï¼šçŸ©é˜µç›¸ä¹˜ï¼ˆä¸ç¬¦åˆäº¤æ¢å¾‹ï¼‰"><a href="#2ï¼šçŸ©é˜µç›¸ä¹˜ï¼ˆä¸ç¬¦åˆäº¤æ¢å¾‹ï¼‰" class="headerlink" title="2ï¼šçŸ©é˜µç›¸ä¹˜ï¼ˆä¸ç¬¦åˆäº¤æ¢å¾‹ï¼‰"></a>2ï¼šçŸ©é˜µç›¸ä¹˜ï¼ˆä¸ç¬¦åˆäº¤æ¢å¾‹ï¼‰</h6><ul><li><p>æ ‡é‡ * çŸ©é˜µ</p><ul><li>å˜é‡ * çŸ©é˜µçš„æ¯ä¸€ä¸ªå…ƒç´ ï¼Œå¾—åˆ°ä¸€ä¸ªæ–°çŸ©é˜µ</li></ul></li><li><p>çŸ©é˜µ * çŸ©é˜µ</p><ul><li><p>ç”¨çŸ©é˜µçš„ ç¬¬1è¡Œ åˆ†åˆ«å» ä¹˜ä»¥ çŸ©é˜µçš„æ¯ä¸€åˆ—</p></li><li><p>ç”¨çŸ©é˜µçš„ ç¬¬Nè¡Œ åˆ†åˆ«å» ä¹˜ä»¥ çŸ©é˜µçš„æ¯ä¸€åˆ—</p></li></ul></li></ul><p><img src="/images/blog/201908/2-%E7%9F%A9%E9%98%B5%E4%B9%98%E4%B8%8A%E7%9F%A9%E9%98%B5.jpg" alt></p><ul><li><p>çŸ©é˜µA * çŸ©é˜µB != çŸ©é˜µB * çŸ©é˜µA</p></li><li><p>çŸ©é˜µç›¸ä¹˜çš„æ¡ä»¶ï¼šå‰é¢çŸ©é˜µçš„åˆ—æ•° ç­‰äº åé¢çŸ©é˜µçš„è¡Œæ•°</p></li></ul>]]></content>
      
      
      <categories>
          
          <category> æ•°å­¦ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ•°å­¦ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Hexo éƒ¨ç½²æµ‹è¯•</title>
      <link href="/2019/08/02/hexo-test-deploy/"/>
      <url>/2019/08/02/hexo-test-deploy/</url>
      
        <content type="html"><![CDATA[<h4 id="Hexo-éƒ¨ç½²æµ‹è¯•"><a href="#Hexo-éƒ¨ç½²æµ‹è¯•" class="headerlink" title="Hexo éƒ¨ç½²æµ‹è¯•"></a>Hexo éƒ¨ç½²æµ‹è¯•</h4><h5 id="1ï¼šé€šè¿‡æ—¥å¿—æ–¹å¼ç»Ÿè®¡"><a href="#1ï¼šé€šè¿‡æ—¥å¿—æ–¹å¼ç»Ÿè®¡" class="headerlink" title="1ï¼šé€šè¿‡æ—¥å¿—æ–¹å¼ç»Ÿè®¡"></a>1ï¼šé€šè¿‡æ—¥å¿—æ–¹å¼ç»Ÿè®¡</h5><a id="more"></a><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">file_put_contents(<span class="string">"loc.log"</span>, microtime(<span class="keyword">true</span>).<span class="string">'_end'</span>.<span class="string">"-----$lat@2"</span>.PHP_EOL, FILE_APPEND);</span><br><span class="line"></span><br><span class="line">file_put_contents(<span class="string">'exelog/'</span>.time().<span class="string">'.log'</span>, var_export(Yii::$app-&gt;request-&gt;post(), <span class="keyword">true</span>));</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">$postdata = file_get_contents(<span class="string">"php://input"</span>);</span><br><span class="line">$postdata = json_decode($postdata,<span class="keyword">true</span>);</span><br></pre></td></tr></table></figure><h5 id="2ï¼šäºŒç»´æ•°ç»„æŒ‡å®šå­—æ®µæ’åº"><a href="#2ï¼šäºŒç»´æ•°ç»„æŒ‡å®šå­—æ®µæ’åº" class="headerlink" title="2ï¼šäºŒç»´æ•°ç»„æŒ‡å®šå­—æ®µæ’åº"></a>2ï¼šäºŒç»´æ•°ç»„æŒ‡å®šå­—æ®µæ’åº</h5><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">array_multisort (array_column($citiesMddBaseInfo, â€˜hotâ€™), SORT_DESC, $citiesMddBaseInfo);</span><br><span class="line"></span><br><span class="line">array_multisort(array_column($hotelList, <span class="string">'price'</span>), SORT_ASC, $hotelList);</span><br><span class="line"></span><br><span class="line">array_multisort($hotelList,SORT_ASC, array_column($hotelList, <span class="string">'price'</span>));</span><br></pre></td></tr></table></figure><p><img src="/images/blog/201908/tom.jpg" alt></p>]]></content>
      
      
      <categories>
          
          <category> æµ‹è¯• </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Hexo </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
